###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         24/Nov/2016  14:17:56 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\work\zigbee\ZStack-Smart-2.5.2b\Components\stac #
#                          k\zdo\ZDApp.c                                      #
#    Command line       =  -f E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zst #
#                          ack\Applications\SmartApp\CC2530DB\Devices\..\..\. #
#                          .\..\Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ       #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK     #
#                          -DSSA_CONNECTOR) -f E:\work\zigbee\ZStack-Smart-2. #
#                          5.2b\Projects\zstack\Applications\SmartApp\CC2530D #
#                          B\Devices\..\..\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                           (-DZIGBEEPRO -DSECURE=1 -DZG_SECURE_DYNAMIC=1     #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=600         #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 E:\work\zigbee\ZStack-Smart #
#                          -2.5.2b\Components\stack\zdo\ZDApp.c -D SECURE=1   #
#                          -D ZTOOL_P1 -D DEVICE_TYPE_ID=0xFE -D              #
#                          SIGNAL_AMPLIFIER_SETTING -D                        #
#                          xPOWER_AMPLIFIER_POSITION_1 -D xNWK_AUTO_POLL -D   #
#                          xHAL_UART_DMA=2 -D xHAL_UART_DMA_ALT1 -D           #
#                          xJIAJU_BUILDIN -D MT_TASK -D MT_SYS_FUNC -D        #
#                          MT_ZDO_FUNC -D NV_INIT -D NV_RESTORE -lC           #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\bin\DemoBaseZC\Lis #
#                          t\ -lA E:\work\zigbee\ZStack-Smart-2.5.2b\Projects #
#                          \zstack\Applications\SmartApp\CC2530DB\bin\DemoBas #
#                          eZC\List\ --diag_suppress Pe001,Pa010 -o           #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\bin\DemoBaseZC\Obj #
#                          \ -e --debug --core=plain --dptr=16,1              #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zst #
#                          ack\Applications\SmartApp\CC2530DB\Devices\ -I     #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\Sour #
#                          ce\Common\ -I E:\work\zigbee\ZStack-Smart-2.5.2b\P #
#                          rojects\zstack\Applications\SmartApp\CC2530DB\Devi #
#                          ces\..\..\Source\Connector\ -I                     #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\Sour #
#                          ce\\EndNode\ -I E:\work\zigbee\ZStack-Smart-2.5.2b #
#                          \Projects\zstack\Applications\SmartApp\CC2530DB\De #
#                          vices\..\..\Source\Board\ -I                       #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\Sour #
#                          ce\Manage\ -I E:\work\zigbee\ZStack-Smart-2.5.2b\P #
#                          rojects\zstack\Applications\SmartApp\CC2530DB\Devi #
#                          ces\..\..\Source\Manage\Callbacks\ -I              #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\Sour #
#                          ce\Manage\debug\ -I E:\work\zigbee\ZStack-Smart-2. #
#                          5.2b\Projects\zstack\Applications\SmartApp\CC2530D #
#                          B\Devices\..\..\Source\Manage\HeartBeat\ -I        #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\Sour #
#                          ce\Manage\incode\ -I E:\work\zigbee\ZStack-Smart-2 #
#                          .5.2b\Projects\zstack\Applications\SmartApp\CC2530 #
#                          DB\Devices\..\..\..\..\ZMain\TI2530DB\ -I          #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\hal\include\ -I                 #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\ -I         #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\mac\include\ -I                 #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\mac\high_level\ -I              #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\ -I         #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \ -I E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\z #
#                          stack\Applications\SmartApp\CC2530DB\Devices\..\.. #
#                          \..\..\..\..\Components\mt\ -I                     #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\osal\include\ -I                #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\services\saddr\ -I              #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\services\sdata\ -I              #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\af\ -I                    #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\nwk\ -I                   #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\sapi\ -I                  #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\sec\ -I                   #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\sys\ -I                   #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\stack\zdo\ -I                   #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\zmac\ -I                        #
#                          E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\Devices\..\..\..\. #
#                          .\..\..\Components\zmac\f8w\ -Oh                   #
#                          --require_prototypes                               #
#    List file          =  E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\bin\DemoBaseZC\Lis #
#                          t\ZDApp.lst                                        #
#    Object file        =  E:\work\zigbee\ZStack-Smart-2.5.2b\Projects\zstack #
#                          \Applications\SmartApp\CC2530DB\bin\DemoBaseZC\Obj #
#                          \ZDApp.r51                                         #
#                                                                             #
#                                                                             #
###############################################################################

E:\work\zigbee\ZStack-Smart-2.5.2b\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2012-02-16 16:04:32 -0800 (Thu, 16 Feb 2012) $
      4            Revision:       $Revision: 29348 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the user can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #include "ZComDef.h"
     46          #include "ZMac.h"
     47          #include "OSAL.h"
     48          #include "OSAL_Tasks.h"
     49          #include "OSAL_PwrMgr.h"
     50          #include "OSAL_Nv.h"
     51          #include "AF.h"
     52          #include "APSMEDE.h"
     53          #include "NLMEDE.h"
     54          #include "AddrMgr.h"
     55          #include "ZDProfile.h"
     56          #include "ZDObject.h"
     57          #include "ZDConfig.h"
     58          #include "ZDSecMgr.h"
     59          #include "ZDApp.h"
     60          #include "DebugTrace.h"
     61          #include "nwk_util.h"
     62          #include "OnBoard.h"
     63          #include "ZGlobals.h"
     64          #include "ZDNwkMgr.h"
     65          #include "rtg.h"
     66          
     67          #include "ssp.h"
     68          
     69          /* HAL */
     70          #include "hal_led.h"
     71          #include "hal_lcd.h"
     72          #include "hal_key.h"
     73          
     74          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     75            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     76          #endif
     77          
     78          /*********************************************************************
     79           * CONSTANTS
     80           */
     81          
     82          #if !defined( NWK_START_DELAY )
     83            #define NWK_START_DELAY             100   // in milliseconds
     84          #endif
     85          
     86          #if !defined( LEAVE_RESET_DELAY )
     87            #define LEAVE_RESET_DELAY           5000  // in milliseconds
     88          #endif
     89          
     90          // Init ZDO, but hold and wait for application to start the joining or
     91          // forming network
     92          #define ZDO_INIT_HOLD_NWK_START       0xFFFF
     93          
     94          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     95            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     96          #endif
     97          
     98          #if !defined( BEACON_REQUEST_DELAY )
     99            #define BEACON_REQUEST_DELAY        100   // in milliseconds
    100          #endif
    101          
    102          #if !defined( BEACON_REQ_DELAY_MASK )
    103            #define BEACON_REQ_DELAY_MASK       0x007F
    104          #endif
    105          
    106          #define MAX_RESUME_RETRY            3
    107          
    108          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    109          
    110          // Beacon Order Settings (see NLMEDE.h)
    111          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    112          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    113          
    114          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    115            // The number of times the frame counter can change before
    116            // saving to NV
    117            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    118          #endif
    119          
    120          // Leave control bits
    121          #define ZDAPP_LEAVE_CTRL_INIT 0
    122          #define ZDAPP_LEAVE_CTRL_SET  1
    123          #define ZDAPP_LEAVE_CTRL_RA   2
    124          
    125          // Address Manager Stub Implementation
    126          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    127          
    128          
    129          #if !defined ZDO_NV_SAVE_RFDs
    130          #define ZDO_NV_SAVE_RFDs  TRUE
    131          #endif
    132          
    133          // Delay time before updating NWK NV data to force fewer writes during high activity.
    134          #if ZDO_NV_SAVE_RFDs
    135          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    136          #else
    137          #define ZDAPP_UPDATE_NWK_NV_TIME 65000
    138          #endif
    139          
    140          /*********************************************************************
    141           * GLOBAL VARIABLES
    142           */
    143          
    144          #if defined( LCD_SUPPORTED )
    145            uint8 MatchRsps = 0;
    146          #endif
    147          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    148          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    151          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    157          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    159          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    160          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    162          
    163          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    164          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    165          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    166          pfnZdoCb zdoCBFunc[MAX_ZDO_CB_FUNC];
   \                     zdoCBFunc:
   \   000000                DS 14
   \   00000E                REQUIRE __INIT_XDATA_Z
    167          
    168          /*********************************************************************
    169           * EXTERNAL VARIABLES
    170           */
    171          
    172          /*********************************************************************
    173           * EXTERNAL FUNCTIONS
    174           */
    175          
    176          /*********************************************************************
    177           * LOCAL FUNCTIONS
    178           */
    179          
    180          void ZDApp_NetworkStartEvt( void );
    181          void ZDApp_DeviceAuthEvt( void );
    182          void ZDApp_SaveNetworkStateEvt( void );
    183          
    184          uint8 ZDApp_ReadNetworkRestoreState( void );
    185          uint8 ZDApp_RestoreNetworkState( void );
    186          void ZDAppDetermineDeviceType( void );
    187          void ZDApp_InitUserDesc( void );
    188          void ZDAppCheckForHoldKey( void );
    189          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    190          void ZDApp_ProcessNetworkJoin( void );
    191          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    192          uint8 ZDApp_RestoreNwkKey( void );
    193          networkDesc_t* ZDApp_NwkDescListProcessing(void);
    194          
    195          void ZDApp_SecInit( uint8 state );
    196          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    197          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    198          
    199          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    200          
    201          void ZDApp_ResetTimerStart( uint16 delay );
    202          void ZDApp_ResetTimerCancel( void );
    203          void ZDApp_LeaveCtrlInit( void );
    204          void ZDApp_LeaveCtrlSet( uint8 ra );
    205          uint8 ZDApp_LeaveCtrlBypass( void );
    206          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    207          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    208                                  uint8 removeChildren );
    209          void ZDApp_NodeProfileSync( uint8 stackProfile );
    210          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    211          void ZDApp_RegisterCBs( void );
    212          void ZDApp_InitZdoCBFunc(void);
    213          
    214          /*********************************************************************
    215           * LOCAL VARIABLES
    216           */
    217          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    218          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    219          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    220          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    221          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    222          
    223          #if defined(HOLD_INIT_AUTHENTICATION)
    224          #define HOLD_AUTO_START
    225          #endif
    226          
    227          #if defined( HOLD_AUTO_START )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    228            devStates_t devState = DEV_HOLD;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    229          #else
    230            devStates_t devState = DEV_INIT;
    231          #endif
    232          
    233          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )
    234            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
    235            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    236                                  // to parent. Set to make the device do an Orphan scan.
    237          #else
    238            // Set the default to coodinator

   \                                 In  segment XDATA_I, align 1, keep-with-next
    239            devStartModes_t devStartMode = MODE_HARD;
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devStartMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    240          #endif
    241          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    242          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    243          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    244          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    245          {
    246            ZDO_EP,
    247            &ZDAppTaskID,
    248            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    249            (afNetworkLatencyReq_t)0            // No Network Latency req
    250          };
    251          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    252          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    253          
    254          /*********************************************************************
    255           * @fn      ZDApp_Init
    256           *
    257           * @brief   ZDApp Initialization function.
    258           *
    259           * @param   task_id - ZDApp Task ID
    260           *
    261           * @return  None
    262           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    263          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    264          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    265            // Save the task ID
    266            ZDAppTaskID = task_id;
   \   000006   90....       MOV     DPTR,#ZDAppTaskID
   \   000009   F0           MOVX    @DPTR,A
    267          
    268            // Initialize the ZDO global device short address storage
    269            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   00000A   90....       MOV     DPTR,#ZDAppNwkAddr + 8
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    270            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   000010   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000013   74FE         MOV     A,#-0x2
   \   000015   F0           MOVX    @DPTR,A
   \   000016   A3           INC     DPTR
   \   000017   04           INC     A
   \   000018   F0           MOVX    @DPTR,A
    271            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    272          
    273            // Check for manual "Hold Auto Start"
    274            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    275          
    276            // Initialize ZDO items and setup the device - type of device to create.
    277            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    278          
    279            // Register the endpoint description with the AF
    280            // This task doesn't have a Simple description, but we still need
    281            // to register the endpoint.
    282            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#ZDApp_epDesc & 0xff
   \   000024   7B..         MOV     R3,#(ZDApp_epDesc >> 8) & 0xff
   \   000026   12....       LCALL   ??afRegister?relay
    283          
    284          #if defined( ZDO_USERDESC_RESPONSE )
    285            ZDApp_InitUserDesc();
   \   000029                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000029   12....       LCALL   ??ZDApp_InitUserDesc?relay
    286          #endif // ZDO_USERDESC_RESPONSE
    287          
    288            // Start the device?
    289            if ( devState != DEV_HOLD )
   \   00002C   90....       MOV     DPTR,#devState
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6009         JZ      ??ZDApp_Init_0
    290            {
    291              ZDOInitDevice( 0 );
   \   000032                ; Setup parameters for call to function ZDOInitDevice
   \   000032   7A00         MOV     R2,#0x0
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??ZDOInitDevice?relay
   \   000039   8014         SJMP    ??ZDApp_Init_1
    292            }
    293            else
    294            {
    295              ZDOInitDevice( ZDO_INIT_HOLD_NWK_START );
   \                     ??ZDApp_Init_0:
   \   00003B                ; Setup parameters for call to function ZDOInitDevice
   \   00003B   7AFF         MOV     R2,#-0x1
   \   00003D   7BFF         MOV     R3,#-0x1
   \   00003F   12....       LCALL   ??ZDOInitDevice?relay
    296              // Blink LED to indicate HOLD_START
    297              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \   000042                ; Setup parameters for call to function HalLedBlink
   \   000042   7CF4         MOV     R4,#-0xc
   \   000044   7D01         MOV     R5,#0x1
   \   000046   7B32         MOV     R3,#0x32
   \   000048   7A00         MOV     R2,#0x0
   \   00004A   7908         MOV     R1,#0x8
   \   00004C   12....       LCALL   ??HalLedBlink?relay
    298            }
    299          
    300            // Initialize the ZDO callback function pointers zdoCBFunc[]
    301            ZDApp_InitZdoCBFunc();
   \                     ??ZDApp_Init_1:
   \   00004F                ; Setup parameters for call to function ZDApp_InitZdoCBFunc
   \   00004F   12....       LCALL   ??ZDApp_InitZdoCBFunc?relay
    302          
    303            ZDApp_RegisterCBs();
   \   000052                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000052   12....       LCALL   ??ZDApp_RegisterCBs?relay
    304          } /* ZDApp_Init() */
   \   000055   02....       LJMP    ??Subroutine51_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine51_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    305          
    306          /*********************************************************************
    307           * @fn          ZDApp_SecInit
    308           *
    309           * @brief       ZDApp initialize security.
    310           *
    311           * @param       state - device initialization state
    312           *
    313           * @return      none
    314           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    315          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    316          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    317            uint8 zgPreConfigKey[SEC_KEY_LEN];
    318          
    319            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   \   00000C   90....       MOV     DPTR,#zgSecurityMode
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6016         JZ      ??ZDApp_SecInit_0
    320            {
    321              // Set the Trust Center bit
    322              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
   \   000012   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 8
   \   000015   E0           MOVX    A,@DPTR
   \   000016   4401         ORL     A,#0x1
   \   000018   F0           MOVX    @DPTR,A
    323            }
    324          
    325            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   \   000019   90....       MOV     DPTR,#zgSecurityMode
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6403         XRL     A,#0x3
   \   00001F   7007         JNZ     ??ZDApp_SecInit_0
    326            {
    327              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000024   E0           MOVX    A,@DPTR
   \   000025   D2E6         SETB    0xE0 /* A   */.6
   \   000027   F0           MOVX    @DPTR,A
    328            }
    329          
    330            // Initialize ZigBee Device Security Manager
    331            ZDSecMgrInit(state);
   \                     ??ZDApp_SecInit_0:
   \   000028                ; Setup parameters for call to function ZDSecMgrInit
   \   000028   12....       LCALL   ??ZDSecMgrInit?relay
    332          
    333            if ( ZG_SECURE_ENABLED )
   \   00002B   90....       MOV     DPTR,#zgSecurityMode
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   604D         JZ      ??ZDApp_SecInit_1
    334            {
    335              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
   \   000031   EE           MOV     A,R6
   \   000032   604A         JZ      ??ZDApp_SecInit_1
    336              {
    337                nwkFrameCounter = 0;
   \   000034   90....       MOV     DPTR,#__Constant_0
   \   000037   12....       LCALL   ?XLOAD_R2345
   \   00003A   90....       MOV     DPTR,#nwkFrameCounter
   \   00003D   12....       LCALL   ?XSTORE_R2345
    338          
    339                if( _NIB.nwkKeyLoaded == FALSE )
   \   000040   90....       MOV     DPTR,#_NIB + 61
   \   000043   E0           MOVX    A,@DPTR
   \   000044   7038         JNZ     ??ZDApp_SecInit_1
    340                {
    341                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    342                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    343                  {
    344                      ZDSecMgrReadKeyFromNv(ZCD_NV_PRECFGKEY, zgPreConfigKey);
   \   000046                ; Setup parameters for call to function ZDSecMgrReadKeyFromNv
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   AC82         MOV     R4,DPL
   \   00004E   AD83         MOV     R5,DPH
   \   000050   7A62         MOV     R2,#0x62
   \   000052   7B00         MOV     R3,#0x0
   \   000054   12....       LCALL   ??ZDSecMgrReadKeyFromNv?relay
    345                      SSP_UpdateNwkKey( zgPreConfigKey, 0);
   \   000057                ; Setup parameters for call to function SSP_UpdateNwkKey
   \   000057   7900         MOV     R1,#0x0
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   AA82         MOV     R2,DPL
   \   000061   AB83         MOV     R3,DPH
   \   000063   12....       LCALL   ??SSP_UpdateNwkKey?relay
    346                      SSP_SwitchNwkKey( 0 );
   \   000066                ; Setup parameters for call to function SSP_SwitchNwkKey
   \   000066   7900         MOV     R1,#0x0
   \   000068   12....       LCALL   ??SSP_SwitchNwkKey?relay
    347          
    348                      // clear local copy of key
    349                      osal_memset(zgPreConfigKey, 0x00, SEC_KEY_LEN);
   \   00006B                ; Setup parameters for call to function osal_memset
   \   00006B   7C10         MOV     R4,#0x10
   \   00006D   7D00         MOV     R5,#0x0
   \   00006F   7900         MOV     R1,#0x0
   \   000071   85..82       MOV     DPL,?XSP + 0
   \   000074   85..83       MOV     DPH,?XSP + 1
   \   000077   AA82         MOV     R2,DPL
   \   000079   AB83         MOV     R3,DPH
   \   00007B   12....       LCALL   ??osal_memset?relay
    350                  }
    351                }
    352              }
    353            }
    354          }
   \                     ??ZDApp_SecInit_1:
   \   00007E   7410         MOV     A,#0x10
   \   000080   02....       LJMP    ??Subroutine57_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine57_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   02....       LJMP    ??Subroutine51_0 & 0xFFFF
    355          
    356          /*********************************************************************
    357           * @fn      ZDApp_event_loop()
    358           *
    359           * @brief   Main event loop for Zigbee device objects task. This function
    360           *          should be called at periodic intervals.
    361           *
    362           * @param   task_id - Task ID
    363           * @param   events  - Bitmap of events
    364           *
    365           * @return  none
    366           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    367          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    368          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    369            uint8 *msg_ptr;
    370          
    371            if ( events & SYS_EVENT_MSG )
   \   00000B   5480         ANL     A,#0x80
   \   00000D   7033         JNZ     ??ZDApp_event_loop_0
    372            {
    373              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    374              {
    375                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    376          
    377                // Release the memory
    378                osal_msg_deallocate( msg_ptr );
    379              }
    380          
    381              // Return unprocessed events
    382              return (events ^ SYS_EVENT_MSG);
    383            }
    384          
    385            if ( events & ZDO_NETWORK_INIT )
   \   00000F   EE           MOV     A,R6
   \   000010   A2E0         MOV     C,0xE0 /* A   */.0
   \   000012   5047         JNC     ??ZDApp_event_loop_1
    386            {
    387              // Initialize apps and start the network
    388              devState = DEV_INIT;
   \   000014   90....       MOV     DPTR,#devState
   \   000017   7401         MOV     A,#0x1
   \   000019   12....       LCALL   ??Subroutine39_0 & 0xFFFF
    389              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    390          
    391              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    392                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \                     ??CrossCallReturnLabel_68:
   \   00001C                ; Setup parameters for call to function ZDO_StartDevice
   \   00001C   7C0F         MOV     R4,#0xf
   \   00001E   7B0F         MOV     R3,#0xf
   \   000020   90....       MOV     DPTR,#devStartMode
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000028   E0           MOVX    A,@DPTR
   \   000029   5407         ANL     A,#0x7
   \   00002B   F9           MOV     R1,A
   \   00002C   12....       LCALL   ??ZDO_StartDevice?relay
    393          
    394              // Return unprocessed events
    395              return (events ^ ZDO_NETWORK_INIT);
   \   00002F   EE           MOV     A,R6
   \   000030   6401         XRL     A,#0x1
   \                     ??ZDApp_event_loop_2:
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_3:
   \   000034   FB           MOV     R3,A
   \   000035   02....       LJMP    ??ZDApp_event_loop_4 & 0xFFFF
    396            }
   \                     ??ZDApp_event_loop_5:
   \   000038                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   000038   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003B                ; Setup parameters for call to function osal_msg_deallocate
   \   00003B   AA..         MOV     R2,?V0 + 0
   \   00003D   AB..         MOV     R3,?V0 + 1
   \   00003F   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_0:
   \   000042                ; Setup parameters for call to function osal_msg_receive
   \   000042   90....       MOV     DPTR,#ZDAppTaskID
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F9           MOV     R1,A
   \   000047   12....       LCALL   ??osal_msg_receive?relay
   \   00004A   8A..         MOV     ?V0 + 0,R2
   \   00004C   8B..         MOV     ?V0 + 1,R3
   \   00004E   A9..         MOV     R1,?V0 + 1
   \   000050   EA           MOV     A,R2
   \   000051   49           ORL     A,R1
   \   000052   70E4         JNZ     ??ZDApp_event_loop_5
   \   000054   EE           MOV     A,R6
   \   000055   FA           MOV     R2,A
   \   000056   EF           MOV     A,R7
   \   000057   6480         XRL     A,#0x80
   \   000059   80D9         SJMP    ??ZDApp_event_loop_3
    397          
    398            if ( ZSTACK_ROUTER_BUILD )
    399            {
    400              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_1:
   \   00005B   5402         ANL     A,#0x2
   \   00005D   6008         JZ      ??ZDApp_event_loop_6
    401              {
    402                ZDApp_NetworkStartEvt();
   \   00005F                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   00005F   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    403          
    404                // Return unprocessed events
    405                return (events ^ ZDO_NETWORK_START);
   \   000062   EE           MOV     A,R6
   \   000063   6402         XRL     A,#0x2
   \                     ??ZDApp_event_loop_7:
   \   000065   80CB         SJMP    ??ZDApp_event_loop_2
    406              }
    407          
    408              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_6:
   \   000067   EE           MOV     A,R6
   \   000068   5420         ANL     A,#0x20
   \   00006A   601E         JZ      ??ZDApp_event_loop_8
    409              {
    410                if ( nwkStatus == ZSuccess )
   \   00006C   90....       MOV     DPTR,#nwkStatus
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   7010         JNZ     ??ZDApp_event_loop_9
    411                {
    412                  if ( devState == DEV_END_DEVICE )
   \   000072   90....       MOV     DPTR,#devState
   \   000075   E0           MOVX    A,@DPTR
   \   000076   6406         XRL     A,#0x6
   \   000078   7003         JNZ     ??ZDApp_event_loop_10
    413                    devState = DEV_ROUTER;
   \   00007A   7407         MOV     A,#0x7
   \   00007C   F0           MOVX    @DPTR,A
    414          
    415                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_10:
   \   00007D                ; Setup parameters for call to function osal_pwrmgr_device
   \   00007D   7900         MOV     R1,#0x0
   \   00007F   12....       LCALL   ??osal_pwrmgr_device?relay
    416                }
    417                else
    418                {
    419                  // remain as end device!!
    420                }
    421                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_9:
   \   000082                ; Setup parameters for call to function osal_set_event
   \   000082   12....       LCALL   ?Subroutine15 & 0xFFFF
    422          
    423                // Return unprocessed events
    424                return (events ^ ZDO_ROUTER_START);
   \                     ??CrossCallReturnLabel_58:
   \   000085   EE           MOV     A,R6
   \   000086   6420         XRL     A,#0x20
   \   000088   80A8         SJMP    ??ZDApp_event_loop_2
    425              }
    426            }
    427          
    428            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_8:
   \   00008A   EE           MOV     A,R6
   \   00008B   5410         ANL     A,#0x10
   \   00008D   6023         JZ      ??ZDApp_event_loop_11
    429            {
    430          #if defined(HOLD_INIT_AUTHENTICATION) && !defined(ZDO_COORDINATOR)
    431            	if ( devState == DEV_END_DEVICE ||
    432            		 devState == DEV_ROUTER)
    433            	{
    434          		devStates_t tStates;
    435          		
    436          		if (ZSUCCESS == osal_nv_read( 
    437            	  		  ZCD_NV_NWK_HOLD_STARTUP, 0, sizeof(tStates),  &tStates) 
    438            	  		  && tStates != DEV_INIT )
    439          		{
    440          			//ÅäÖÃ³É¹¦ºó, ÉèÖÃÎªÄ¬ÈÏ»¯×ÔÆô
    441          			tStates = DEV_INIT;
    442          			osal_nv_write( ZCD_NV_NWK_HOLD_STARTUP, 
    443          					0, sizeof(tStates),  &tStates);
    444          		}
    445            	}
    446          #endif
    447          	
    448              ZDO_UpdateNwkStatus( devState );
   \   00008F                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   00008F   90....       MOV     DPTR,#devState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F9           MOV     R1,A
   \   000094   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    449          
    450              // At start up, do one MTO route discovery if the device is a concentrator
    451              if ( zgConcentratorEnable == TRUE )
   \   000097   90....       MOV     DPTR,#zgConcentratorEnable
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   6401         XRL     A,#0x1
   \   00009D   700E         JNZ     ??CrossCallReturnLabel_85
    452              {
    453                // Start next event
    454                osal_start_timerEx( NWK_TaskID, NWK_MTO_RTG_REQ_EVT, 100 );
   \   00009F                ; Setup parameters for call to function osal_start_timerEx
   \   00009F   7C64         MOV     R4,#0x64
   \   0000A1   7D00         MOV     R5,#0x0
   \   0000A3   7A00         MOV     R2,#0x0
   \   0000A5   7B08         MOV     R3,#0x8
   \   0000A7   90....       MOV     DPTR,#NWK_TaskID
   \   0000AA   12....       LCALL   ??Subroutine47_0 & 0xFFFF
    455              }
    456          
    457              // Return unprocessed events
    458              return (events ^ ZDO_STATE_CHANGE_EVT);
   \                     ??CrossCallReturnLabel_85:
   \   0000AD   EE           MOV     A,R6
   \   0000AE   6410         XRL     A,#0x10
   \   0000B0   8080         SJMP    ??ZDApp_event_loop_2
    459            }
    460          
    461            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_11:
   \   0000B2   EE           MOV     A,R6
   \   0000B3   5408         ANL     A,#0x8
   \   0000B5   6006         JZ      ??ZDApp_event_loop_12
    462            {
    463              // User defined logic
    464          
    465              // Return unprocessed events
    466              return (events ^ ZDO_COMMAND_CNF);
   \   0000B7   EE           MOV     A,R6
   \   0000B8   6408         XRL     A,#0x8
   \   0000BA   FA           MOV     R2,A
   \   0000BB   8034         SJMP    ??ZDApp_event_loop_4
    467            }
    468          
    469            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_12:
   \   0000BD   EF           MOV     A,R7
   \   0000BE   5402         ANL     A,#0x2
   \   0000C0   600B         JZ      ??ZDApp_event_loop_13
    470            {
    471              ZDApp_SaveNetworkStateEvt();
   \   0000C2                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   0000C2   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    472          
    473              // Return unprocessed events
    474              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000C5   EE           MOV     A,R6
   \   0000C6   FA           MOV     R2,A
   \   0000C7   EF           MOV     A,R7
   \   0000C8   6402         XRL     A,#0x2
   \   0000CA   02....       LJMP    ??ZDApp_event_loop_3 & 0xFFFF
    475            }
    476          
    477            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_13:
   \   0000CD   EE           MOV     A,R6
   \   0000CE   5404         ANL     A,#0x4
   \   0000D0   600A         JZ      ??ZDApp_event_loop_14
    478            {
    479          #ifdef ZBA_FALLBACK_NWKKEY
    480              if ( devState == DEV_END_DEVICE_UNAUTH )
    481              {
    482                ZDSecMgrFallbackNwkKey();
    483              }
    484              else
    485          #endif
    486              {
    487                // Set the NV startup option to force a "new" join.
    488                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   0000D2                ; Setup parameters for call to function zgWriteStartupOptions
   \   0000D2   7A02         MOV     R2,#0x2
   \   0000D4   79FF         MOV     R1,#-0x1
   \   0000D6   12....       LCALL   ??zgWriteStartupOptions?relay
    489          
    490                // The device has been in the UNAUTH state, so reset
    491                // Note: there will be no return from this call
    492                SystemResetSoft();
   \   0000D9                ; Setup parameters for call to function Onboard_soft_reset
   \   0000D9   12....       LCALL   Onboard_soft_reset & 0xFFFF
    493              }
    494            }
    495          
    496            if ( ZG_SECURE_ENABLED )
   \                     ??ZDApp_event_loop_14:
   \   0000DC   90....       MOV     DPTR,#zgSecurityMode
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   600B         JZ      ??ZDApp_event_loop_15
    497            {
    498              return ( ZDApp_ProcessSecEvent( task_id, events ) );
   \   0000E2                ; Setup parameters for call to function ZDApp_ProcessSecEvent
   \   0000E2   EE           MOV     A,R6
   \   0000E3   FA           MOV     R2,A
   \   0000E4   EF           MOV     A,R7
   \   0000E5   FB           MOV     R3,A
   \   0000E6   A9..         MOV     R1,?V0 + 2
   \   0000E8   12....       LCALL   ??ZDApp_ProcessSecEvent?relay
   \   0000EB   8004         SJMP    ??ZDApp_event_loop_4
    499            }
    500            else
    501            {
    502              // Discard or make more handlers
    503              return 0;
   \                     ??ZDApp_event_loop_15:
   \   0000ED   7A00         MOV     R2,#0x0
   \   0000EF   7B00         MOV     R3,#0x0
   \                     ??ZDApp_event_loop_4:
   \   0000F1   7F03         MOV     R7,#0x3
   \   0000F3   02....       LJMP    ?BANKED_LEAVE_XDATA
    504            }
    505          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7A10         MOV     R2,#0x10
   \   000002                REQUIRE ??Subroutine38_0
   \   000002                ; // Fall through to label ??Subroutine38_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine38_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#ZDAppTaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine39_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_set_event
   \   000001                ; Setup parameters for call to function osal_set_event
   \   000001                ; Setup parameters for call to function osal_set_event
   \   000001   7A10         MOV     R2,#0x10
   \   000003   7B00         MOV     R3,#0x0
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F9           MOV     R1,A
   \   00000A   12....       LCALL   ??osal_set_event?relay
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine47_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F9           MOV     R1,A
   \   000002   12....       LCALL   ??osal_start_timerEx?relay
   \   000005   22           RET
    506          
    507          /*********************************************************************
    508           * @fn      ZDApp_ProcessSecEvent()
    509           *
    510           * @brief   Process incoming security events.
    511           *
    512           * @param   task_id - Task ID
    513           * @param   events  - Bitmap of events
    514           *
    515           * @return  none
    516           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    517          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    518          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    519            (void)task_id;  // Intentionally unreferenced parameter
    520          
    521            if ( ZSTACK_ROUTER_BUILD )
    522            {
    523              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6017         JZ      ??ZDApp_ProcessSecEvent_0
    524              {
    525                // process the new device event
    526                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7007         JNZ     ??CrossCallReturnLabel_79
    527                {
    528                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   12....       LCALL   ?Subroutine16 & 0xFFFF
    529                }
    530          
    531                // Return unprocessed events
    532                return (events ^ ZDO_NEW_DEVICE);
   \                     ??CrossCallReturnLabel_79:
   \   00001D   EE           MOV     A,R6
   \   00001E   6440         XRL     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000020   FA           MOV     R2,A
   \   000021   EF           MOV     A,R7
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000022   FB           MOV     R3,A
   \   000023   8077         SJMP    ??ZDApp_ProcessSecEvent_3
    533              }
    534            }
    535          
    536            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    537                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   000025   90....       MOV     DPTR,#zgSecurityMode
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6403         XRL     A,#0x3
   \   00002B   6005         JZ      ??ZDApp_ProcessSecEvent_4
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   6404         XRL     A,#0x4
   \   000030   700F         JNZ     ??ZDApp_ProcessSecEvent_5
    538            {
    539              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    540              {
    541                if ( events & ZDO_SECMGR_EVENT )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   000032   EF           MOV     A,R7
   \   000033   5401         ANL     A,#0x1
   \   000035   600A         JZ      ??ZDApp_ProcessSecEvent_5
    542                {
    543                  ZDSecMgrEvent();
   \   000037                ; Setup parameters for call to function ZDSecMgrEvent
   \   000037   12....       LCALL   ??ZDSecMgrEvent?relay
    544          
    545                  // Return unprocessed events
    546                  return (events ^ ZDO_SECMGR_EVENT);
   \   00003A   EE           MOV     A,R6
   \   00003B   FA           MOV     R2,A
   \   00003C   EF           MOV     A,R7
   \   00003D   6401         XRL     A,#0x1
   \   00003F   80E1         SJMP    ??ZDApp_ProcessSecEvent_2
    547                }
    548              }
    549            }
    550          
    551            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000041   EE           MOV     A,R6
   \   000042   5480         ANL     A,#0x80
   \   000044   6008         JZ      ??ZDApp_ProcessSecEvent_6
    552            {
    553              ZDApp_DeviceAuthEvt();
   \   000046                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   000046   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    554          
    555              // Return unprocessed events
    556              return (events ^ ZDO_DEVICE_AUTH);
   \   000049   EE           MOV     A,R6
   \   00004A   6480         XRL     A,#0x80
   \   00004C   80D2         SJMP    ??ZDApp_ProcessSecEvent_1
    557            }
    558          
    559            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_6:
   \   00004E   EF           MOV     A,R7
   \   00004F   5404         ANL     A,#0x4
   \   000051   6027         JZ      ??ZDApp_ProcessSecEvent_7
    560            {
    561              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000053   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000056   12....       LCALL   ?Subroutine35 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000059   E8           MOV     A,R0
   \   00005A   2401         ADD     A,#0x1
   \   00005C   FA           MOV     R2,A
   \   00005D   E9           MOV     A,R1
   \   00005E   3400         ADDC    A,#0x0
   \   000060   FB           MOV     R3,A
   \   000061   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000064   12....       LCALL   ??Subroutine58_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_120:
   \   000067   C3           CLR     C
   \   000068   E8           MOV     A,R0
   \   000069   94E9         SUBB    A,#-0x17
   \   00006B   E9           MOV     A,R1
   \   00006C   9403         SUBB    A,#0x3
   \   00006E   4003         JC      ??ZDApp_ProcessSecEvent_8
    562              {
    563                ZDApp_SaveNwkKey();
   \   000070                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000070   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    564              }
    565          
    566              // Return unprocessed events
    567              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_8:
   \   000073   EE           MOV     A,R6
   \   000074   FA           MOV     R2,A
   \   000075   EF           MOV     A,R7
   \   000076   6404         XRL     A,#0x4
   \   000078   80A8         SJMP    ??ZDApp_ProcessSecEvent_2
    568            }
    569          
    570            if ( events & ZDO_APS_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_7:
   \   00007A   EF           MOV     A,R7
   \   00007B   5410         ANL     A,#0x10
   \   00007D   600A         JZ      ??ZDApp_ProcessSecEvent_9
    571            {
    572          #if defined (NV_RESTORE)
    573              ZDSecMgrSaveApsLinkKey();
   \   00007F                ; Setup parameters for call to function ZDSecMgrSaveApsLinkKey
   \   00007F   12....       LCALL   ??ZDSecMgrSaveApsLinkKey?relay
    574          #endif // (NV_RESTORE)
    575          
    576              // Return unprocessed events
    577              return (events ^ ZDO_APS_FRAMECOUNTER_CHANGE);
   \   000082   EE           MOV     A,R6
   \   000083   FA           MOV     R2,A
   \   000084   EF           MOV     A,R7
   \   000085   6410         XRL     A,#0x10
   \   000087   8099         SJMP    ??ZDApp_ProcessSecEvent_2
    578            }
    579          
    580            if ( events & ZDO_TCLK_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_9:
   \   000089   EF           MOV     A,R7
   \   00008A   5408         ANL     A,#0x8
   \   00008C   600A         JZ      ??ZDApp_ProcessSecEvent_10
    581            {
    582              ZDSecMgrSaveTCLinkKey();
   \   00008E                ; Setup parameters for call to function ZDSecMgrSaveTCLinkKey
   \   00008E   12....       LCALL   ??ZDSecMgrSaveTCLinkKey?relay
    583          
    584              // Return unprocessed events
    585              return (events ^ ZDO_TCLK_FRAMECOUNTER_CHANGE);
   \   000091   EE           MOV     A,R6
   \   000092   FA           MOV     R2,A
   \   000093   EF           MOV     A,R7
   \   000094   6408         XRL     A,#0x8
   \   000096   808A         SJMP    ??ZDApp_ProcessSecEvent_2
    586            }
    587          
    588            // Discard or make more handlers
    589            return 0;
   \                     ??ZDApp_ProcessSecEvent_10:
   \   000098   7A00         MOV     R2,#0x0
   \   00009A   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_3:
   \   00009C   02....       LJMP    ??Subroutine51_0 & 0xFFFF
    590          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7A40         MOV     R2,#0x40
   \   000002                REQUIRE ??Subroutine45_0
   \   000002                ; // Fall through to label ??Subroutine45_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine45_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002                REQUIRE ??Subroutine46_0
   \   000002                ; // Fall through to label ??Subroutine46_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine46_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003                REQUIRE ??Subroutine47_0
   \   000003                ; // Fall through to label ??Subroutine47_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine35:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine58_0:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   22           RET
    591          
    592          /*********************************************************************
    593           * Application Functions
    594           */
    595          
    596          /*********************************************************************
    597           * @fn      ZDOInitDevice
    598           *
    599           * @brief   Start the device in the network.  This function will read
    600           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    601           *   restore the network state of the device.
    602           *
    603           * @param   startDelay - timeDelay to start device (in milliseconds).
    604           *                       There is a jitter added to this delay:
    605           *                       ((NWK_START_DELAY + startDelay)
    606           *                       + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    607           *                       When startDelay is set to ZDO_INIT_HOLD_NWK_START
    608           *                       this function will hold the network init. Application
    609           *                       can start the device.
    610           *
    611           * NOTE:    If the application would like to force a "new" join, the
    612           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    613           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    614           *          this function. "new" join means to not restore the network
    615           *          state of the device. Use zgWriteStartupOptions() to set these
    616           *          options.
    617           *
    618           * @return
    619           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    620           *          restored.
    621           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    622           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    623           *          it could mean that there was no network state to restore.
    624           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    625           *          with the rejoin option set to TRUE.  So, the device was not
    626           *          started in the network (one time only).  The next time this
    627           *          function is called it will start.
    628           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    629          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    630          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
    631            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    632            uint16 extendedDelay = 0;
   \                     ??CrossCallReturnLabel_126:
   \   00000D   7E00         MOV     R6,#0x0
   \   00000F   7F00         MOV     R7,#0x0
    633          
    634            if ( devState == DEV_HOLD )
   \   000011   90....       MOV     DPTR,#devState
   \   000014   E0           MOVX    A,@DPTR
   \   000015   7005         JNZ     ??ZDOInitDevice_0
    635            {
    636              // Initialize the RAM items table, in case an NV item has been updated.
    637              zgInitItems( FALSE );
   \   000017                ; Setup parameters for call to function zgInitItems
   \   000017   7900         MOV     R1,#0x0
   \   000019   12....       LCALL   ??zgInitItems?relay
    638            }
    639          
    640            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   00001C                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   00001C   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    641            //devtag.071807.todo - fix this temporary solution
    642            _NIB.CapabilityFlags = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   00001F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000022   E0           MOVX    A,@DPTR
   \   000023   90....       MOV     DPTR,#_NIB + 14
   \   000026   F0           MOVX    @DPTR,A
    643          
    644          #if defined ( NV_RESTORE )
    645            // Get Keypad directly to see if a reset nv is needed.
    646            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    647            // while booting to skip past NV Restore.
    648            if ( HalKeyRead() == SW_BYPASS_NV )
   \   000027                ; Setup parameters for call to function HalKeyRead
   \   000027   12....       LCALL   ??HalKeyRead?relay
   \   00002A   E9           MOV     A,R1
   \   00002B   6404         XRL     A,#0x4
   \   00002D   7074         JNZ     ??ZDOInitDevice_1
    649              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00002F   75..01       MOV     ?V0 + 0,#0x1
    650            else
    651            {
    652              // Determine if NV should be restored
    653              networkStateNV = ZDApp_ReadNetworkRestoreState();
    654            }
    655          
    656            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    657            {
    658              networkStateNV = ZDApp_RestoreNetworkState();
    659            }
    660            else
    661            {
    662              // Wipe out the network state in NV
    663              NLME_InitNV();
   \                     ??ZDOInitDevice_2:
   \   000032                ; Setup parameters for call to function NLME_InitNV
   \   000032   12....       LCALL   ??NLME_InitNV?relay
    664              NLME_SetDefaultNV();
   \   000035                ; Setup parameters for call to function NLME_SetDefaultNV
   \   000035   12....       LCALL   ??NLME_SetDefaultNV?relay
    665              // clear NWK key values
    666              ZDSecMgrClearNVKeyValues();
   \   000038                ; Setup parameters for call to function ZDSecMgrClearNVKeyValues
   \   000038   12....       LCALL   ??ZDSecMgrClearNVKeyValues?relay
    667            }
    668          #endif
    669          
    670            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
   \                     ??ZDOInitDevice_3:
   \   00003B   7401         MOV     A,#0x1
   \   00003D   65..         XRL     A,?V0 + 0
   \   00003F   7020         JNZ     ??ZDOInitDevice_4
    671            {
    672              ZDAppDetermineDeviceType();
   \   000041                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   000041   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    673          
    674              // Only delay if joining network - not restoring network state
    675              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    676                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000044                ; Setup parameters for call to function osal_rand
   \   000044   12....       LCALL   ??osal_rand?relay
   \   000047   85..82       MOV     DPL,?XSP + 0
   \   00004A   85..83       MOV     DPH,?XSP + 1
   \   00004D   EA           MOV     A,R2
   \   00004E   547F         ANL     A,#0x7f
   \   000050   F8           MOV     R0,A
   \   000051   E0           MOVX    A,@DPTR
   \   000052   28           ADD     A,R0
   \   000053   F8           MOV     R0,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   3400         ADDC    A,#0x0
   \   000058   F9           MOV     R1,A
   \   000059   E8           MOV     A,R0
   \   00005A   2464         ADD     A,#0x64
   \   00005C   FE           MOV     R6,A
   \   00005D   E9           MOV     A,R1
   \   00005E   3400         ADDC    A,#0x0
   \   000060   FF           MOV     R7,A
    677            }
    678          
    679            // Initialize the security for type of device
    680            ZDApp_SecInit( networkStateNV );
   \                     ??ZDOInitDevice_4:
   \   000061                ; Setup parameters for call to function ZDApp_SecInit
   \   000061   A9..         MOV     R1,?V0 + 0
   \   000063   12....       LCALL   ??ZDApp_SecInit?relay
    681          
    682            if( ZDO_INIT_HOLD_NWK_START != startDelay )
   \   000066   85..82       MOV     DPL,?XSP + 0
   \   000069   85..83       MOV     DPH,?XSP + 1
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F4           CPL     A
   \   00006E   7003         JNZ     ??ZDOInitDevice_5
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F4           CPL     A
   \                     ??ZDOInitDevice_5:
   \   000073   6045         JZ      ??ZDOInitDevice_6
    683            {
    684              devState = DEV_INIT;    // Remove the Hold state
   \   000075   90....       MOV     DPTR,#devState
   \   000078   7401         MOV     A,#0x1
   \   00007A   F0           MOVX    @DPTR,A
    685          
    686              // Initialize leave control logic
    687              ZDApp_LeaveCtrlInit();
   \   00007B                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   00007B   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    688          
    689              // Check leave control reset settings
    690              ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   00007E                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   00007E   85..82       MOV     DPL,?XSP + 0
   \   000081   85..83       MOV     DPH,?XSP + 1
   \   000084   AC82         MOV     R4,DPL
   \   000086   AD83         MOV     R5,DPH
   \   000088   7A..         MOV     R2,#devState & 0xff
   \   00008A   7B..         MOV     R3,#(devState >> 8) & 0xff
   \   00008C   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    691          
    692              // Leave may make the hold state come back
    693              if ( devState == DEV_HOLD )
   \   00008F   90....       MOV     DPTR,#devState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   701E         JNZ     ??ZDOInitDevice_7
    694              {
    695                // Set the NV startup option to force a "new" join.
    696                zgWriteStartupOptions( ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000095                ; Setup parameters for call to function zgWriteStartupOptions
   \   000095   7A02         MOV     R2,#0x2
   \   000097   79FF         MOV     R1,#-0x1
   \   000099   12....       LCALL   ??zgWriteStartupOptions?relay
    697          
    698                // Notify the applications
    699                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00009C                ; Setup parameters for call to function osal_set_event
   \   00009C   12....       LCALL   ?Subroutine15 & 0xFFFF
    700          
    701                return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \                     ??CrossCallReturnLabel_59:
   \   00009F   7902         MOV     R1,#0x2
   \   0000A1   8021         SJMP    ??ZDOInitDevice_8
    702              }
   \                     ??ZDOInitDevice_1:
   \   0000A3                ; Setup parameters for call to function ZDApp_ReadNetworkRestoreState
   \   0000A3   12....       LCALL   ??ZDApp_ReadNetworkRestoreState?relay
   \   0000A6   E9           MOV     A,R1
   \   0000A7   F5..         MOV     ?V0 + 0,A
   \   0000A9   7087         JNZ     ??ZDOInitDevice_2
   \   0000AB                ; Setup parameters for call to function ZDApp_RestoreNetworkState
   \   0000AB   12....       LCALL   ??ZDApp_RestoreNetworkState?relay
   \   0000AE   E9           MOV     A,R1
   \   0000AF   F5..         MOV     ?V0 + 0,A
   \   0000B1   8088         SJMP    ??ZDOInitDevice_3
    703          
    704              // Trigger the network start
    705              ZDApp_NetworkInit( extendedDelay );
   \                     ??ZDOInitDevice_7:
   \   0000B3                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0000B3   EE           MOV     A,R6
   \   0000B4   FA           MOV     R2,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   FB           MOV     R3,A
   \   0000B7   12....       LCALL   ??ZDApp_NetworkInit?relay
    706            }
    707          
    708            // set broadcast address mask to support broadcast filtering
    709            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \                     ??ZDOInitDevice_6:
   \   0000BA                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   0000BA   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   F9           MOV     R1,A
   \   0000BF   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    710          
    711            return ( networkStateNV );
   \   0000C2   A9..         MOV     R1,?V0 + 0
   \                     ??ZDOInitDevice_8:
   \   0000C4   02....       LJMP    ?Subroutine1 & 0xFFFF
    712          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7402         MOV     A,#0x2
   \   000002                REQUIRE ??Subroutine42_0
   \   000002                ; // Fall through to label ??Subroutine42_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine42_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine43_0
   \   000003                ; // Fall through to label ??Subroutine43_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine43_0:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine58_0
   \   000006                ; // Fall through to label ??Subroutine58_0
    713          
    714          /*********************************************************************
    715           * @fn      ZDApp_ReadNetworkRestoreState
    716           *
    717           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    718           *          or not to restore the network state.
    719           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    720           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    721           *
    722           * @param   none
    723           *
    724           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    725           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    726           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    727           *          ZCD_NV_STARTUP_OPTION
    728           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    729          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    730          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    731            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    732          
    733            // Look for the New Network State option.
    734            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    735            {
    736              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    737            }
    738          
    739            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   02....       LJMP    ??Subroutine51_0 & 0xFFFF
    740          }
    741          
    742          /*********************************************************************
    743           * @fn      ZDAppDetermineDeviceType()
    744           *
    745           * @brief   Determines the type of device to start.
    746           *
    747           *          Looks at zgDeviceLogicalType and determines what type of
    748           *          device to start.  The types are:
    749           *            ZG_DEVICETYPE_COORDINATOR
    750           *            ZG_DEVICETYPE_ROUTER
    751           *            ZG_DEVICETYPE_ENDDEVICE
    752           *
    753           * @param   none
    754           *
    755           * @return  none
    756           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    757          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    758          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    759            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    760            {
    761              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   90....       MOV     DPTR,#devStartMode
   \   00000D   7402         MOV     A,#0x2
   \   00000F   F0           MOVX    @DPTR,A
    762              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802E         SJMP    ??ZDAppDetermineDeviceType_1
    763            }
    764            else
    765            {
    766              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   6401         XRL     A,#0x1
   \   00001A   700A         JNZ     ??ZDAppDetermineDeviceType_2
    767                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   54F8         ANL     A,#0xf8
   \   000022   4401         ORL     A,#0x1
   \   000024   800D         SJMP    ??ZDAppDetermineDeviceType_3
    768              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6402         XRL     A,#0x2
   \   000029   7009         JNZ     ??ZDAppDetermineDeviceType_4
    769                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002B   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   54F8         ANL     A,#0xf8
   \   000031   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000033   F0           MOVX    @DPTR,A
    770          
    771              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    772              // The device shall do rejoin the network. Otherwise, do normal join
    773              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000034                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000034   7A..         MOV     R2,#AIB_apsUseExtendedPANID & 0xff
   \   000036   7B..         MOV     R3,#(AIB_apsUseExtendedPANID >> 8) & 0xff
   \   000038   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003B   E9           MOV     A,R1
   \   00003C   90....       MOV     DPTR,#devStartMode
   \   00003F   7003         JNZ     ??ZDAppDetermineDeviceType_5
    774              {
    775                devStartMode = MODE_JOIN;     // Assume joining
   \   000041   E4           CLR     A
   \   000042   8002         SJMP    ??ZDAppDetermineDeviceType_1
    776              }
    777              else
    778              {
    779                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_5:
   \   000044   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_1:
   \   000046   F0           MOVX    @DPTR,A
    780              }
    781            }
    782          }
   \   000047   02....       LJMP    ??Subroutine44_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine44_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    783          
    784          /*********************************************************************
    785           * @fn      ZDApp_NetworkStartEvt()
    786           *
    787           * @brief   Process the Network Start Event
    788           *
    789           * @param   none
    790           *
    791           * @return  none
    792           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    793          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    794          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    795            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    796            {
    797              // Successfully started a ZigBee network
    798              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    799              {
    800                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    801              }
    802          
    803              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    804              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802B         SJMP    ??ZDApp_NetworkStartEvt_2
    805            }
    806            else
    807            {
    808              // Try again with a higher energy threshold !!
    809              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   2410         ADD     A,#0x10
   \   000022   F8           MOV     R0,A
   \   000023   E4           CLR     A
   \   000024   3400         ADDC    A,#0x0
   \   000026   F9           MOV     R1,A
   \   000027   E8           MOV     A,R0
   \   000028   94FF         SUBB    A,#-0x1
   \   00002A   E9           MOV     A,R1
   \   00002B   9400         SUBB    A,#0x0
   \   00002D   C3           CLR     C
   \   00002E   65D0         XRL     A,PSW
   \   000030   33           RLC     A
   \   000031   500E         JNC     ??ZDApp_NetworkStartEvt_3
    810              {
    811                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000033                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000033                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000033   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000036   E9           MOV     A,R1
   \   000037   2410         ADD     A,#0x10
   \   000039   F9           MOV     R1,A
   \   00003A   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    812                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003D                ; Setup parameters for call to function osal_set_event
   \   00003D   7A01         MOV     R2,#0x1
   \   00003F   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    813              }
    814              else
    815              {
    816                // Failed to start network. Enter a dormant state (until user intervenes)
    817                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000041   90....       MOV     DPTR,#devState
   \   000044   7401         MOV     A,#0x1
   \   000046   F0           MOVX    @DPTR,A
    818                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000047                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000047   7A10         MOV     R2,#0x10
    819              }
    820            }
   \                     ??ZDApp_NetworkStartEvt_4:
   \   000049   12....       LCALL   ??Subroutine38_0 & 0xFFFF
    821          }
   \                     ??CrossCallReturnLabel_63:
   \   00004C   02....       LJMP    ??Subroutine44_0 & 0xFFFF
    822          
    823          /*********************************************************************
    824           * @fn      ZDApp_DeviceAuthEvt()
    825           *
    826           * @brief   Process the Device Authentic Event
    827           *
    828           * @param   none
    829           *
    830           * @return  none
    831           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    832          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    833          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    834            // received authentication from trust center
    835            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   7030         JNZ     ??ZDApp_DeviceAuthEvt_0
    836            {
    837              // Stop the reset timer so it doesn't reset
    838              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    839          
    840              devState = DEV_END_DEVICE;
   \   00000F   12....       LCALL   ?Subroutine8 & 0xFFFF
    841              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
    842          
    843              // Set the Power Manager Device
    844          #if defined ( POWER_SAVING )
    845              osal_pwrmgr_device( PWRMGR_BATTERY );
    846          #endif
    847          
    848              if ( ZSTACK_ROUTER_BUILD )
    849              {
    850                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??CrossCallReturnLabel_66:
   \   000012   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   000015   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    851                {
    852                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    853                  NLME_StartRouterRequest( 0, 0, false );
   \   000017                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000017   7B00         MOV     R3,#0x0
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??NLME_StartRouterRequest?relay
    854                }
    855              }
    856          
    857              // Notify to save info into NV
    858              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000020                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000020   12....       LCALL   ??ZDApp_NVUpdate?relay
    859          
    860              // Save off the security
    861              ZDApp_SaveNwkKey();
   \   000023                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000023   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    862          
    863              ZDApp_AnnounceNewAddress();
   \   000026                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000026   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    864          
    865              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   000029   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   A2E3         MOV     C,0xE0 /* A   */.3
   \   00002F   400E         JC      ??ZDApp_DeviceAuthEvt_2
    866              {
    867                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000031                ; Setup parameters for call to function NLME_SetPollRate
   \   000031   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000034   12....       LCALL   ??Subroutine52_0 & 0xFFFF
    868              }
    869            }
   \                     ??CrossCallReturnLabel_90:
   \   000037   12....       LCALL   ??NLME_SetPollRate?relay
   \   00003A   8003         SJMP    ??ZDApp_DeviceAuthEvt_2
    870            else
    871            {
    872              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   00003C                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00003C   12....       LCALL   ??ZDApp_NVUpdate?relay
    873            }
    874          }
   \                     ??ZDApp_DeviceAuthEvt_2:
   \   00003F   02....       LJMP    ??Subroutine44_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   90....       MOV     DPTR,#devState
   \   000003   7406         MOV     A,#0x6
   \   000005                REQUIRE ??Subroutine39_0
   \   000005                ; // Fall through to label ??Subroutine39_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000003   E0           MOVX    A,@DPTR
   \   000004   5407         ANL     A,#0x7
   \   000006   6402         XRL     A,#0x2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine52_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005   22           RET
    875          
    876          /*********************************************************************
    877           * @fn      ZDApp_SaveNetworkStateEvt()
    878           *
    879           * @brief   Process the Save the Network State Event
    880           *
    881           * @param   none
    882           *
    883           * @return  none
    884           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    885          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    886          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    887          #if defined ( NV_RESTORE )
    888           #if defined ( NV_TURN_OFF_RADIO )
    889            // Turn off the radio's receiver during an NV update
    890            uint8 RxOnIdle;
    891            uint8 x = false;
    892            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    893            ZMacSetReq( ZMacRxOnIdle, &x );
    894           #endif
    895          
    896            // Update the Network State in NV
    897            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    898                           NWK_NV_DEVICELIST_ENABLE |
    899                           NWK_NV_BINDING_ENABLE    |
    900                           NWK_NV_ADDRMGR_ENABLE );
   \   000004                ; Setup parameters for call to function NLME_UpdateNV
   \   000004   790F         MOV     R1,#0xf
   \   000006   12....       LCALL   ??NLME_UpdateNV?relay
    901          
    902            // Reset the NV startup option to resume from NV by
    903            // clearing the "New" join option.
    904            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
   \   000009                ; Setup parameters for call to function zgWriteStartupOptions
   \   000009   7A02         MOV     R2,#0x2
   \   00000B   7900         MOV     R1,#0x0
   \   00000D   12....       LCALL   ??zgWriteStartupOptions?relay
    905          
    906           #if defined ( NV_TURN_OFF_RADIO )
    907            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    908           #endif
    909          #endif  // NV_RESTORE
    910          }
   \   000010   02....       LJMP    ??Subroutine44_0 & 0xFFFF
    911          
    912          /*********************************************************************
    913           * @fn      ZDApp_RestoreNetworkState()
    914           *
    915           * @brief   This function will restore the network state of the
    916           *          device if the network state is stored in NV.
    917           *
    918           * @param   none
    919           *
    920           * @return
    921           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    922           *          restored.
    923           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    924           *          This could mean that zgStartupOption said to not restore, or
    925           *          it could mean that there was no network state to restore.
    926           *
    927           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    928          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    929          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    930            uint8 nvStat;
    931          
    932            // Initialize NWK NV items
    933            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    934          
    935            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   604A         JZ      ??ZDApp_RestoreNetworkState_0
    936            {
    937              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   602B         JZ      ??ZDApp_RestoreNetworkState_1
    938              {
    939                // Are we a coordinator
    940                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   12....       LCALL   ??Subroutine58_0 & 0xFFFF
    941                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \                     ??CrossCallReturnLabel_121:
   \   00001E   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000024   7007         JNZ     ??ZDApp_RestoreNetworkState_2
    942                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000026   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   54F8         ANL     A,#0xf8
   \   00002C   F0           MOVX    @DPTR,A
    943                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_2:
   \   00002D   90....       MOV     DPTR,#devStartMode
   \   000030   7401         MOV     A,#0x1
   \   000032   F0           MOVX    @DPTR,A
    944                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000033                ; Setup parameters for call to function sAddrExtCpy
   \   000033   7C..         MOV     R4,#(_NIB + 53) & 0xff
   \   000035   7D..         MOV     R5,#((_NIB + 53) >> 8) & 0xff
   \   000037   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   000039   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00003B   12....       LCALL   ??sAddrExtCpy?relay
   \   00003E   8002         SJMP    ??ZDApp_RestoreNetworkState_3
    945              }
    946              else
    947                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000040   7E09         MOV     R6,#0x9
    948          
    949              if ( ZG_SECURE_ENABLED )
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000042   90....       MOV     DPTR,#zgSecurityMode
   \   000045   E0           MOVX    A,@DPTR
   \   000046   600A         JZ      ??ZDApp_RestoreNetworkState_4
    950              {
    951                nwkFrameCounterChanges = 0;
   \   000048   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00004B   E4           CLR     A
   \   00004C   F0           MOVX    @DPTR,A
   \   00004D   A3           INC     DPTR
   \   00004E   F0           MOVX    @DPTR,A
    952          
    953                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    954                {
    955                  ZDApp_RestoreNwkKey();
   \   00004F                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   00004F   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
    956                }
    957              }
    958          
    959              // The default for RxOnWhenIdle is true for Routers and false for end devices
    960              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    961              // other than default.
    962            }
    963          
    964            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_4:
   \   000052   EE           MOV     A,R6
   \   000053   7004         JNZ     ??ZDApp_RestoreNetworkState_0
    965              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000055   7900         MOV     R1,#0x0
   \   000057   8002         SJMP    ??ZDApp_RestoreNetworkState_5
    966            else
    967              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000059   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_5:
   \   00005B   02....       LJMP    ??Subroutine51_0 & 0xFFFF
    968          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   12....       LCALL   ?Subroutine35 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000003   E8           MOV     A,R0
   \   000004   49           ORL     A,R1
   \   000005   22           RET
    969          
    970          /*********************************************************************
    971           * @fn      ZDApp_InitUserDesc()
    972           *
    973           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    974           *          when needed.  If you want to initialize the User descriptor to
    975           *          something other than all zero, do it here.
    976           *
    977           * @param   none
    978           *
    979           * @return  none
    980           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    981          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    982          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    983            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    984          
    985            // Initialize the User Descriptor, the descriptor is read from NV
    986            // when needed.  If you want to initialize the User descriptor to something
    987            // other than all zero, do it here.
    988            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   12....       LCALL   ?Subroutine27 & 0xFFFF
    989            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    990                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \                     ??CrossCallReturnLabel_33:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   7C11         MOV     R4,#0x11
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A81         MOV     R2,#-0x7f
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_nv_item_init?relay
   \   00001D   7402         MOV     A,#0x2
   \   00001F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000022   E9           MOV     A,R1
   \   000023   702F         JNZ     ??ZDApp_InitUserDesc_0
    991            {
    992              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    993                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000025                ; Setup parameters for call to function osal_nv_read
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..11       MOV     ?V0 + 0,#0x11
   \   00002D   75..00       MOV     ?V0 + 1,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7C00         MOV     R4,#0x0
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7A81         MOV     R2,#-0x7f
   \   00003B   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   00003E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000041   E9           MOV     A,R1
   \   000042   7010         JNZ     ??ZDApp_InitUserDesc_0
    994              {
    995                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000044   85..82       MOV     DPL,?XSP + 0
   \   000047   85..83       MOV     DPH,?XSP + 1
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   6007         JZ      ??ZDApp_InitUserDesc_0
    996                {
    997                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   00004D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000050   E0           MOVX    A,@DPTR
   \   000051   D2E4         SETB    0xE0 /* A   */.4
   \   000053   F0           MOVX    @DPTR,A
    998                }
    999              }
   1000            }
   1001          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000054   7411         MOV     A,#0x11
   \   000056   02....       LJMP    ??Subroutine49_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine27:
   \   000000   7D00         MOV     R5,#0x0
   \   000002   7900         MOV     R1,#0x0
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   AB83         MOV     R3,DPH
   \   00000E   12....       LCALL   ??osal_memset?relay
   \   000011                ; Setup parameters for call to function osal_nv_item_init
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 0,DPL
   \   00001A   8583..       MOV     ?V0 + 1,DPH
   \   00001D   78..         MOV     R0,#?V0 + 0
   \   00001F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine31:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   12....       LCALL   ??osal_nv_read?relay
   \   000005   7404         MOV     A,#0x4
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine49_0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003                REQUIRE ??Subroutine50_0
   \   000003                ; // Fall through to label ??Subroutine50_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine50_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
   1002          
   1003          /*********************************************************************
   1004           * @fn      ZDAppCheckForHoldKey()
   1005           *
   1006           * @brief   Check for key to set the device into Hold Auto Start
   1007           *
   1008           * @param   none
   1009           *
   1010           * @return  none
   1011           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1012          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
   1013          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1014          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
   1015            // Get Keypad directly to see if a HOLD_START is needed.
   1016            // Hold down the SW_BYPASS_START key (see OnBoard.h)
   1017            // while booting to avoid starting up the device.
   1018            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
   1019            {
   1020              // Change the device state to HOLD on start up
   1021              devState = DEV_HOLD;
   \   00000C   90....       MOV     DPTR,#devState
   \   00000F   E4           CLR     A
   \   000010   F0           MOVX    @DPTR,A
   1022            }
   1023          #endif // HAL_KEY
   1024          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   1025          
   1026          /*********************************************************************
   1027           * @fn      ZDApp_ProcessOSALMsg()
   1028           *
   1029           * @brief   Process the incoming task message.
   1030           *
   1031           * @param   msgPtr - message to process
   1032           *
   1033           * @return  none
   1034           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1035          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
   1036          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1037            // Data Confirmation message fields
   1038            uint8 sentEP;       // This should always be 0
   1039            uint8 sentStatus;
   1040            afDataConfirm_t *afDataConfirm;
   1041            uint8 tmp;
   1042          
   1043            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   14           DEC     A
   \   00000A   6037         JZ      ??ZDApp_ProcessOSALMsg_0
   \   00000C   14           DEC     A
   \   00000D   6034         JZ      ??ZDApp_ProcessOSALMsg_0
   \   00000F   14           DEC     A
   \   000010   6031         JZ      ??ZDApp_ProcessOSALMsg_0
   \   000012   24E9         ADD     A,#-0x17
   \   000014   600A         JZ      ??ZDApp_ProcessOSALMsg_1
   \   000016   2447         ADD     A,#0x47
   \   000018   600B         JZ      ??ZDApp_ProcessOSALMsg_2
   \   00001A   24D6         ADD     A,#-0x2a
   \   00001C   600C         JZ      ??ZDApp_ProcessOSALMsg_3
   \   00001E   801A         SJMP    ??ZDApp_ProcessOSALMsg_4
   1044            {
   1045              // Incoming ZDO Message
   1046              case AF_INCOMING_MSG_CMD:
   1047                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   000020                ; Setup parameters for call to function ZDP_IncomingData
   \   000020   12....       LCALL   ??ZDP_IncomingData?relay
   1048                break;
   \   000023   801E         SJMP    ??ZDApp_ProcessOSALMsg_0
   1049          
   1050              case ZDO_CB_MSG:
   1051                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   000025                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000025   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   1052                break;
   \   000028   8019         SJMP    ??ZDApp_ProcessOSALMsg_0
   1053          
   1054              case AF_DATA_CONFIRM_CMD:
   1055                // This message is received as a confirmation of a data packet sent.
   1056                // The status is of ZStatus_t type [defined in NLMEDE.h]
   1057                // The message fields are defined in AF.h
   1058                afDataConfirm = (afDataConfirm_t *)msgPtr;
   1059                sentEP = afDataConfirm->endpoint;
   1060                sentStatus = afDataConfirm->hdr.status;
   1061          
   1062                // Action taken when confirmation is received.
   1063          #if defined ( ZIGBEE_FREQ_AGILITY )
   1064                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   00002A   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   00002D   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000030   6011         JZ      ??ZDApp_ProcessOSALMsg_0
   1065                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   000032                ; Setup parameters for indirect call
   \   000032   12....       LCALL   ??Subroutine48_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_86:
   \   000035   12....       LCALL   ?CALL_IND
   \   000038   8009         SJMP    ??ZDApp_ProcessOSALMsg_0
   1066          #endif
   1067                (void)sentEP;
   1068                (void)sentStatus;
   1069                break;
   1070          
   1071              case ZDO_NWK_DISC_CNF:
   1072                if (devState != DEV_NWK_DISC)
   1073                  break;
   1074          
   1075                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1076                {
   1077                  // Process the network discovery scan results and choose a parent
   1078                  // device to join/rejoin itself
   1079                  networkDesc_t *pChosenNwk;
   1080                  if ( ( (pChosenNwk = ZDApp_NwkDescListProcessing()) != NULL ) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   1081                  {
   1082                    if ( devStartMode == MODE_JOIN )
   1083                    {
   1084                      devState = DEV_NWK_JOINING;
   1085          
   1086                      ZDApp_NodeProfileSync( pChosenNwk->stackProfile);
   1087          
   1088                      if ( NLME_JoinRequest( pChosenNwk->extendedPANID, pChosenNwk->panId,
   1089                                            pChosenNwk->logicalChannel,
   1090                                            ZDO_Config_Node_Descriptor.CapabilityFlags,
   1091                                            pChosenNwk->chosenRouter, pChosenNwk->chosenRouterDepth ) != ZSuccess )
   1092                      {
   1093                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1094                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1095                      }
   1096                    } // if ( devStartMode == MODE_JOIN )
   1097                    else if ( devStartMode == MODE_REJOIN )
   1098                    {
   1099                      devState = DEV_NWK_REJOIN;
   1100          
   1101                      // Before trying to do rejoin, check if the device has a valid short address
   1102                      // If not, generate a random short address for itself
   1103                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   1104                      {
   1105                        _NIB.nwkDevAddress = osal_rand();
   1106                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   1107                      }
   1108          
   1109                      if ( ZG_SECURE_ENABLED )
   1110                      {
   1111                        ZDApp_RestoreNwkKey();
   1112                      }
   1113          
   1114                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1115                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   1116                      {
   1117                        _NIB.nwkPanId = pChosenNwk->panId;
   1118                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   1119                      }
   1120          
   1121                      tmp = true;
   1122                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   1123                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, pChosenNwk->logicalChannel) != ZSuccess )
   1124                      {
   1125                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1126                                                    + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   1127                      }
   1128                    } // else if ( devStartMode == MODE_REJOIN )
   1129          
   1130                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   1131                    {
   1132                      // The receiver is on, turn network layer polling off.
   1133                      NLME_SetPollRate( 0 );
   1134                      NLME_SetQueuedPollRate( 0 );
   1135                      NLME_SetResponseRate( 0 );
   1136                    }
   1137                    else
   1138                    {
   1139                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1140                      {
   1141                        ZDApp_SavedPollRate = zgPollRate;
   1142                        NLME_SetPollRate( zgRejoinPollRate );
   1143                      }
   1144                    }
   1145                  }
   1146                  else
   1147                  {
   1148                    if ( continueJoining )
   1149                    {
   1150              #if defined ( MANAGED_SCAN )
   1151                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1152              #else
   1153                      zdoDiscCounter++;
   1154                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1155                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   1156              #endif
   1157                    }
   1158                  }
   1159                }
   1160                break;
   1161          
   1162              case ZDO_NWK_JOIN_IND:
   1163                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1164                {
   1165                  ZDApp_ProcessNetworkJoin();
   1166                }
   1167                break;
   1168          
   1169              case ZDO_NWK_JOIN_REQ:
   1170                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1171                {
   1172                  retryCnt = 0;
   1173                  devStartMode = MODE_RESUME;
   1174                  _tmpRejoinState = true;
   1175                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   1176                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   1177                  ZDApp_NetworkInit( 0 );
   1178                }
   1179                break;
   1180          
   1181              default:
   1182                if ( ZG_SECURE_ENABLED )
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   00003A   90....       MOV     DPTR,#zgSecurityMode
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   6003         JZ      ??ZDApp_ProcessOSALMsg_0
   1183                  ZDApp_ProcessSecMsg( msgPtr );
   \   000040                ; Setup parameters for call to function ZDApp_ProcessSecMsg
   \   000040   12....       LCALL   ??ZDApp_ProcessSecMsg?relay
   1184                break;
   1185            }
   1186          
   1187          }
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000043   02....       LJMP    ??Subroutine44_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine48_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F583         MOV     DPH,A
   \   000003   8882         MOV     DPL,R0
   \   000005   22           RET
   1188          
   1189          /*********************************************************************
   1190           * @fn      ZDApp_ProcessMsgCBs()
   1191           *
   1192           * @brief   Process response messages
   1193           *
   1194           * @param   none
   1195           *
   1196           * @return  none
   1197           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1198          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1199          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 44
   \   000005   74D4         MOV     A,#-0x2c
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1200            switch ( inMsg->clusterID )
   \   00000E   12....       LCALL   ?Subroutine32 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000011   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_91:
   \   000014   8A..         MOV     ?V0 + 0,R2
   \   000016   8B..         MOV     ?V0 + 1,R3
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   00001D   0300         DW        3
   \   00001F   2100         DW        33
   \   000021   2200         DW        34
   \   000023   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   000025   0080         DW        32768
   \   000027   0180         DW        32769
   \   000029   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   00002B   2180         DW        32801
   \   00002D   2280         DW        32802
   \   00002F   ....         DW        ??ZDApp_ProcessMsgCBs_2
   \   000031   0100         DW        1
   \   000033   2000         DW        32
   \   000035   ....         DW        ??ZDApp_ProcessMsgCBs_3
   \   000037   ....         DW        ??ZDApp_ProcessMsgCBs_4
   1201            {
   1202          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1203              case NWK_addr_rsp:
   1204              case IEEE_addr_rsp:
   1205                {
   1206                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1207                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000039                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000039   EE           MOV     A,R6
   \   00003A   FA           MOV     R2,A
   \   00003B   EF           MOV     A,R7
   \   00003C   FB           MOV     R3,A
   \   00003D   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   000040   8A..         MOV     ?V0 + 0,R2
   \   000042   8B..         MOV     ?V0 + 1,R3
   \   000044   AE..         MOV     R6,?V0 + 0
   \   000046   AF..         MOV     R7,?V0 + 1
   1208                  if ( pAddrRsp )
   \   000048   EE           MOV     A,R6
   \   000049   4F           ORL     A,R7
   \   00004A   7003         JNZ     $+5
   \   00004C   02....       LJMP    ??ZDApp_ProcessMsgCBs_4 & 0xFFFF
   1209                  {
   1210                    if ( pAddrRsp->status == ZSuccess )
   \   00004F   8E82         MOV     DPL,R6
   \   000051   8F83         MOV     DPH,R7
   \   000053   E0           MOVX    A,@DPTR
   \   000054   700F         JNZ     ??ZDApp_ProcessMsgCBs_5
   1211                    {
   1212                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   000056                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   000056   EE           MOV     A,R6
   \   000057   2403         ADD     A,#0x3
   \   000059   FC           MOV     R4,A
   \   00005A   EF           MOV     A,R7
   \   00005B   3400         ADDC    A,#0x0
   \   00005D   FD           MOV     R5,A
   \   00005E   A3           INC     DPTR
   \   00005F   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   1213                    }
   \                     ??CrossCallReturnLabel_92:
   \   000062   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1214                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_5:
   \   000065                ; Setup parameters for call to function osal_mem_free
   \   000065   EE           MOV     A,R6
   \   000066   FA           MOV     R2,A
   \   000067   EF           MOV     A,R7
   \   000068   02....       LJMP    ??ZDApp_ProcessMsgCBs_6 & 0xFFFF
   1215                  }
   1216                }
   1217                break;
   1218          #endif
   1219          
   1220          #if defined ( REFLECTOR )
   1221              case Bind_req:
   1222              case Unbind_req:
   1223                {
   1224                  ZDO_BindUnbindReq_t bindReq;
   1225                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   00006B                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   00006B   7417         MOV     A,#0x17
   \   00006D   12....       LCALL   ?XSTACK_DISP0_8
   \   000070   AC82         MOV     R4,DPL
   \   000072   AD83         MOV     R5,DPH
   \   000074   EE           MOV     A,R6
   \   000075   FA           MOV     R2,A
   \   000076   EF           MOV     A,R7
   \   000077   FB           MOV     R3,A
   \   000078   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1226                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   00007B                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   00007B   7417         MOV     A,#0x17
   \   00007D   12....       LCALL   ?XSTACK_DISP0_8
   \   000080   AC82         MOV     R4,DPL
   \   000082   AD83         MOV     R5,DPH
   \   000084   EE           MOV     A,R6
   \   000085   FA           MOV     R2,A
   \   000086   EF           MOV     A,R7
   \   000087   FB           MOV     R3,A
   \   000088   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1227                }
   1228                break;
   \   00008B   8073         SJMP    ??ZDApp_ProcessMsgCBs_4
   1229          #endif
   1230          
   1231          #if ( ZG_BUILD_COORDINATOR_TYPE )
   1232              case Bind_rsp:
   1233              case Unbind_rsp:
   1234                if (ZG_DEVICE_COORDINATOR_TYPE && matchED)
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   00008D   90....       MOV     DPTR,#matchED
   \   000090   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000093   606B         JZ      ??ZDApp_ProcessMsgCBs_4
   1235                {
   1236                  ZDMatchSendState(
   1237                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1238                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   \   000095   7421         MOV     A,#0x21
   \   000097   6A           XRL     A,R2
   \   000098   7003         JNZ     ??ZDApp_ProcessMsgCBs_7
   \   00009A   7480         MOV     A,#-0x80
   \   00009C   6B           XRL     A,R3
   \                     ??ZDApp_ProcessMsgCBs_7:
   \   00009D   7004         JNZ     ??ZDApp_ProcessMsgCBs_8
   \   00009F   7903         MOV     R1,#0x3
   \   0000A1   8002         SJMP    ??ZDApp_ProcessMsgCBs_9
   \                     ??ZDApp_ProcessMsgCBs_8:
   \   0000A3   7902         MOV     R1,#0x2
   \                     ??ZDApp_ProcessMsgCBs_9:
   \   0000A5                ; Setup parameters for call to function ZDMatchSendState
   \   0000A5   12....       LCALL   ?Subroutine28 & 0xFFFF
   1239                }
   \                     ??CrossCallReturnLabel_112:
   \   0000A8   FB           MOV     R3,A
   \   0000A9   EE           MOV     A,R6
   \   0000AA   2413         ADD     A,#0x13
   \   0000AC   F582         MOV     DPL,A
   \   0000AE   EF           MOV     A,R7
   \   0000AF   3400         ADDC    A,#0x0
   \   0000B1   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_70:
   \   0000B4   FA           MOV     R2,A
   \   0000B5   12....       LCALL   ??ZDMatchSendState?relay
   \   0000B8   8046         SJMP    ??ZDApp_ProcessMsgCBs_4
   1240                break;
   1241          
   1242              case End_Device_Bind_req:
   1243                if (ZG_DEVICE_COORDINATOR_TYPE)
   1244                {
   1245                  ZDEndDeviceBind_t bindReq;
   1246                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   0000BA                ; Setup parameters for call to function ZDO_ParseEndDeviceBindReq
   \   0000BA   85..82       MOV     DPL,?XSP + 0
   \   0000BD   85..83       MOV     DPH,?XSP + 1
   \   0000C0   AC82         MOV     R4,DPL
   \   0000C2   AD83         MOV     R5,DPH
   \   0000C4   EE           MOV     A,R6
   \   0000C5   FA           MOV     R2,A
   \   0000C6   EF           MOV     A,R7
   \   0000C7   FB           MOV     R3,A
   \   0000C8   12....       LCALL   ??ZDO_ParseEndDeviceBindReq?relay
   1247                  ZDO_MatchEndDeviceBind( &bindReq );
   \   0000CB                ; Setup parameters for call to function ZDO_MatchEndDeviceBind
   \   0000CB   85..82       MOV     DPL,?XSP + 0
   \   0000CE   85..83       MOV     DPH,?XSP + 1
   \   0000D1   AA82         MOV     R2,DPL
   \   0000D3   AB83         MOV     R3,DPH
   \   0000D5   12....       LCALL   ??ZDO_MatchEndDeviceBind?relay
   1248          
   1249                  // Freeing the cluster lists - if allocated.
   1250                  if ( bindReq.numInClusters )
   \   0000D8   7411         MOV     A,#0x11
   \   0000DA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DD   E0           MOVX    A,@DPTR
   \   0000DE   600B         JZ      ??ZDApp_ProcessMsgCBs_10
   1251                    osal_mem_free( bindReq.inClusters );
   \   0000E0                ; Setup parameters for call to function osal_mem_free
   \   0000E0   7412         MOV     A,#0x12
   \   0000E2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E5   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_93:
   \   0000E8   12....       LCALL   ??osal_mem_free?relay
   1252                  if ( bindReq.numOutClusters )
   \                     ??ZDApp_ProcessMsgCBs_10:
   \   0000EB   7414         MOV     A,#0x14
   \   0000ED   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F0   E0           MOVX    A,@DPTR
   \   0000F1   600D         JZ      ??ZDApp_ProcessMsgCBs_4
   1253                    osal_mem_free( bindReq.outClusters );
   \   0000F3                ; Setup parameters for call to function osal_mem_free
   \   0000F3   7415         MOV     A,#0x15
   \   0000F5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   FA           MOV     R2,A
   \   0000FA   A3           INC     DPTR
   \   0000FB   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessMsgCBs_6:
   \   0000FC   FB           MOV     R3,A
   \   0000FD   12....       LCALL   ??osal_mem_free?relay
   1254                }
   1255                break;
   1256          #endif
   1257            }
   1258          }
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   000100   742C         MOV     A,#0x2c
   \   000102   02....       LJMP    ??Subroutine49_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   F583         MOV     DPH,A
   \   000002                REQUIRE ??Subroutine40_0
   \   000002                ; // Fall through to label ??Subroutine40_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine40_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8882         MOV     DPL,R0
   \   000008   E0           MOVX    A,@DPTR
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine32:
   \   000000   EE           MOV     A,R6
   \   000001   240C         ADD     A,#0xc
   \   000003   12....       LCALL   ?Subroutine37 & 0xFFFF
   \                     ??CrossCallReturnLabel_118:
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine37:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003                REQUIRE ??Subroutine54_0
   \   000003                ; // Fall through to label ??Subroutine54_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine54_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine28:
   \   000000   EE           MOV     A,R6
   \   000001   240F         ADD     A,#0xf
   \   000003                REQUIRE ??Subroutine55_0
   \   000003                ; // Fall through to label ??Subroutine55_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine55_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003                REQUIRE ??Subroutine56_0
   \   000003                ; // Fall through to label ??Subroutine56_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine56_0:
   \   000000   12....       LCALL   ??Subroutine54_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_119:
   \   000003   E0           MOVX    A,@DPTR
   \   000004   22           RET
   1259          
   1260          /*********************************************************************
   1261           * @fn      ZDApp_RegisterCBs()
   1262           *
   1263           * @brief   Process response messages
   1264           *
   1265           * @param   none
   1266           *
   1267           * @return  none
   1268           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1269          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1270          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1271          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1272            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   12....       LCALL   ?Subroutine17 & 0xFFFF
   1273          #endif
   1274          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1275            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \                     ??CrossCallReturnLabel_72:
   \   000009                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000009   7A00         MOV     R2,#0x0
   \   00000B   12....       LCALL   ?Subroutine17 & 0xFFFF
   1276          #endif
   1277          #if ZG_BUILD_COORDINATOR_TYPE
   1278            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   \                     ??CrossCallReturnLabel_73:
   \   00000E                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00000E   7A21         MOV     R2,#0x21
   \   000010   12....       LCALL   ?Subroutine17 & 0xFFFF
   1279            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   \                     ??CrossCallReturnLabel_74:
   \   000013                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000013   7A22         MOV     R2,#0x22
   \   000015   12....       LCALL   ?Subroutine17 & 0xFFFF
   1280            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   \                     ??CrossCallReturnLabel_75:
   \   000018                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000018   7A20         MOV     R2,#0x20
   \   00001A   7B00         MOV     R3,#0x0
   \   00001C   12....       LCALL   ??Subroutine41_0 & 0xFFFF
   1281          #endif
   1282          #if defined ( REFLECTOR )
   1283            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \                     ??CrossCallReturnLabel_76:
   \   00001F                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001F   7A21         MOV     R2,#0x21
   \   000021   7B00         MOV     R3,#0x0
   \   000023   12....       LCALL   ??Subroutine41_0 & 0xFFFF
   1284            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \                     ??CrossCallReturnLabel_77:
   \   000026                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000026   7A22         MOV     R2,#0x22
   \   000028   7B00         MOV     R3,#0x0
   \   00002A   12....       LCALL   ??Subroutine41_0 & 0xFFFF
   1285          #endif
   1286          }
   \                     ??CrossCallReturnLabel_78:
   \   00002D   02....       LJMP    ??Subroutine44_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7B80         MOV     R3,#-0x80
   \   000002                REQUIRE ??Subroutine41_0
   \   000002                ; // Fall through to label ??Subroutine41_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine41_0:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000008   22           RET
   1287          
   1288          /*********************************************************************
   1289           * @fn      ZDApp_ProcessSecMsg()
   1290           *
   1291           * @brief   Process the incoming security message.
   1292           *
   1293           * @param   msgPtr - message to process
   1294           *
   1295           * @return  none
   1296           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1297          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1298          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1299            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   24FC         ADD     A,#-0x4
   \   00000B   6011         JZ      ??ZDApp_ProcessSecMsg_0
   \   00000D   24FD         ADD     A,#-0x3
   \   00000F   601A         JZ      ??ZDApp_ProcessSecMsg_1
   \   000011   24FE         ADD     A,#-0x2
   \   000013   601B         JZ      ??ZDApp_ProcessSecMsg_2
   \   000015   24FE         ADD     A,#-0x2
   \   000017   6029         JZ      ??ZDApp_ProcessSecMsg_3
   \   000019   14           DEC     A
   \   00001A   6033         JZ      ??ZDApp_ProcessSecMsg_4
   \   00001C   803C         SJMP    ??ZDApp_ProcessSecMsg_5
   1300            {
   1301              case ZDO_ESTABLISH_KEY_CFM:
   1302                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   \                     ??ZDApp_ProcessSecMsg_0:
   \   00001E   90....       MOV     DPTR,#zgSecurityMode
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6403         XRL     A,#0x3
   \   000024   7034         JNZ     ??ZDApp_ProcessSecMsg_5
   1303                {
   1304                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   \   000026                ; Setup parameters for call to function ZDSecMgrEstablishKeyCfm
   \   000026   12....       LCALL   ??ZDSecMgrEstablishKeyCfm?relay
   \   000029   802F         SJMP    ??ZDApp_ProcessSecMsg_5
   1305                }
   1306                break;
   1307          
   1308              case ZDO_ESTABLISH_KEY_IND:
   1309                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1310                {
   1311                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1312                  {
   1313                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1314                  }
   1315                }
   1316                break;
   1317          
   1318              case ZDO_TRANSPORT_KEY_IND:
   1319                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1320                {
   1321                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   1322                }
   1323                break;
   1324          
   1325              case ZDO_UPDATE_DEVICE_IND:
   1326                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1327                {
   1328                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002B                ; Setup parameters for call to function ZDSecMgrUpdateDeviceInd
   \   00002B   12....       LCALL   ??ZDSecMgrUpdateDeviceInd?relay
   1329                }
   1330                break;
   \   00002E   802A         SJMP    ??ZDApp_ProcessSecMsg_5
   1331          
   1332              case ZDO_REMOVE_DEVICE_IND:
   1333                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   1334                {
   1335                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   1336                }
   1337                break;
   1338          
   1339              case ZDO_REQUEST_KEY_IND:
   1340                if (( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH ) ||
   1341                    ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD ))
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000030   90....       MOV     DPTR,#zgSecurityMode
   \   000033   E0           MOVX    A,@DPTR
   \   000034   6403         XRL     A,#0x3
   \   000036   6005         JZ      ??ZDApp_ProcessSecMsg_6
   \   000038   E0           MOVX    A,@DPTR
   \   000039   6404         XRL     A,#0x4
   \   00003B   701D         JNZ     ??ZDApp_ProcessSecMsg_5
   1342                {
   1343                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1344                  {
   1345                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_6:
   \   00003D                ; Setup parameters for call to function ZDSecMgrRequestKeyInd
   \   00003D   12....       LCALL   ??ZDSecMgrRequestKeyInd?relay
   \   000040   8018         SJMP    ??ZDApp_ProcessSecMsg_5
   1346                  }
   1347                }
   1348                break;
   1349          
   1350              case ZDO_SWITCH_KEY_IND:
   1351                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1352                {
   1353                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   1354                }
   1355                break;
   1356          
   1357              case ZDO_AUTHENTICATE_IND:
   1358                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000042   90....       MOV     DPTR,#zgSecurityMode
   \   000045   E0           MOVX    A,@DPTR
   \   000046   6403         XRL     A,#0x3
   \   000048   7010         JNZ     ??ZDApp_ProcessSecMsg_5
   1359                {
   1360                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   \   00004A                ; Setup parameters for call to function ZDSecMgrAuthenticateInd
   \   00004A   12....       LCALL   ??ZDSecMgrAuthenticateInd?relay
   \   00004D   800B         SJMP    ??ZDApp_ProcessSecMsg_5
   1361                }
   1362                break;
   1363          
   1364              case ZDO_AUTHENTICATE_CFM:
   1365                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   \                     ??ZDApp_ProcessSecMsg_4:
   \   00004F   90....       MOV     DPTR,#zgSecurityMode
   \   000052   E0           MOVX    A,@DPTR
   \   000053   6403         XRL     A,#0x3
   \   000055   7003         JNZ     ??ZDApp_ProcessSecMsg_5
   1366                {
   1367                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   \   000057                ; Setup parameters for call to function ZDSecMgrAuthenticateCfm
   \   000057   12....       LCALL   ??ZDSecMgrAuthenticateCfm?relay
   1368                }
   1369                break;
   1370          
   1371              default:
   1372                // Unsupported messages
   1373                break;
   1374            }
   1375          }
   \                     ??ZDApp_ProcessSecMsg_5:
   \   00005A   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   1376          
   1377          /*********************************************************************
   1378           * @fn      ZDApp_ProcessNetworkJoin()
   1379           *
   1380           * @brief
   1381           *
   1382           *   Save off the Network key information.
   1383           *
   1384           * @param   none
   1385           *
   1386           * @return  none
   1387           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1388          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1389          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1390            if ( (devState == DEV_NWK_JOINING) ||
   1391                ((devState == DEV_NWK_ORPHAN)  &&
   1392                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_2 & 0xFFFF
   1393            {
   1394              // Result of a Join attempt by this device.
   1395              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7058         JNZ     ??ZDApp_ProcessNetworkJoin_3
   1396              {
   1397                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   12....       LCALL   ?Subroutine15 & 0xFFFF
   1398          
   1399          #if defined ( POWER_SAVING )
   1400                osal_pwrmgr_device( PWRMGR_BATTERY );
   1401          #endif
   1402          
   1403                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   \                     ??CrossCallReturnLabel_60:
   \   000030   90....       MOV     DPTR,#zgSecurityMode
   \   000033   E0           MOVX    A,@DPTR
   \   000034   6018         JZ      ??ZDApp_ProcessNetworkJoin_4
   \   000036                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   000036   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   \   000039   E9           MOV     A,R1
   \   00003A   7012         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1404                {
   1405                  // wait for auth from trust center!!
   1406                  devState = DEV_END_DEVICE_UNAUTH;
   \   00003C   90....       MOV     DPTR,#devState
   \   00003F   7405         MOV     A,#0x5
   \   000041   F0           MOVX    @DPTR,A
   1407          
   1408                  // Start the reset timer for MAX UNAUTH time
   1409                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   \   000042                ; Setup parameters for call to function osal_start_timerEx
   \   000042   7C10         MOV     R4,#0x10
   \   000044   7D27         MOV     R5,#0x27
   \   000046   7A04         MOV     R2,#0x4
   \   000048   12....       LCALL   ??Subroutine45_0 & 0xFFFF
   1410                }
   \                     ??CrossCallReturnLabel_81:
   \   00004B   02....       LJMP    ??CrossCallReturnLabel_61 & 0xFFFF
   1411                else
   1412                {
   1413                  if ( ZSTACK_ROUTER_BUILD )
   1414                  {
   1415                    if ( devState == DEV_NWK_ORPHAN
   1416                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   00004E   90....       MOV     DPTR,#devState
   \   000051   E0           MOVX    A,@DPTR
   \   000052   640A         XRL     A,#0xa
   \   000054   700D         JNZ     ??ZDApp_ProcessNetworkJoin_5
   \   000056   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000059   6010         JZ      ??ZDApp_ProcessNetworkJoin_6
   1417                    {
   1418                      // Change NIB state to router for restore
   1419                      _NIB.nwkState = NWK_ROUTER;
   \   00005B   90....       MOV     DPTR,#_NIB + 35
   \   00005E   7408         MOV     A,#0x8
   \   000060   F0           MOVX    @DPTR,A
   \   000061   8008         SJMP    ??ZDApp_ProcessNetworkJoin_6
   1420                    }
   1421                  }
   1422          
   1423                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   000063   E0           MOVX    A,@DPTR
   \   000064   6403         XRL     A,#0x3
   \   000066   7003         JNZ     ??ZDApp_ProcessNetworkJoin_6
   1424                  {
   1425                    ZDApp_AnnounceNewAddress();
   \   000068                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000068   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1426                  }
   1427          
   1428                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   00006B   90....       MOV     DPTR,#devState
   \   00006E   7406         MOV     A,#0x6
   \   000070   F0           MOVX    @DPTR,A
   1429                  if ( ZSTACK_ROUTER_BUILD )
   1430                  {
   1431                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1432                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000071   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000074   7003         JNZ     $+5
   \   000076   02....       LJMP    ??CrossCallReturnLabel_61 & 0xFFFF
   1433                    {
   1434                      NLME_StartRouterRequest( 0, 0, false );
   \   000079                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000079   7B00         MOV     R3,#0x0
   \   00007B   7A00         MOV     R2,#0x0
   \   00007D   7900         MOV     R1,#0x0
   \   00007F   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000082   02....       LJMP    ??CrossCallReturnLabel_61 & 0xFFFF
   1435                    }
   1436                  }
   1437                }
   1438              }
   1439              else
   1440              {
   1441                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000085   90....       MOV     DPTR,#devStartMode
   \   000088   E0           MOVX    A,@DPTR
   \   000089   6401         XRL     A,#0x1
   \   00008B   7031         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00008D   90....       MOV     DPTR,#retryCnt
   \   000090   E0           MOVX    A,@DPTR
   \   000091   04           INC     A
   \   000092   F0           MOVX    @DPTR,A
   \   000093   C3           CLR     C
   \   000094   9403         SUBB    A,#0x3
   \   000096   4026         JC      ??ZDApp_ProcessNetworkJoin_7
   1442                {
   1443                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000098   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   00009B   7003         JNZ     ??ZDApp_ProcessNetworkJoin_8
   \   00009D   74FF         MOV     A,#-0x1
   \   00009F   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   0000A0   600A         JZ      ??ZDApp_ProcessNetworkJoin_9
   \   0000A2   74FE         MOV     A,#-0x2
   \   0000A4   68           XRL     A,R0
   \   0000A5   7003         JNZ     ??ZDApp_ProcessNetworkJoin_10
   \   0000A7   74FF         MOV     A,#-0x1
   \   0000A9   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000AA   7006         JNZ     ??ZDApp_ProcessNetworkJoin_11
   1444                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   0000AC   90....       MOV     DPTR,#devStartMode
   \   0000AF   E4           CLR     A
   \   0000B0   800B         SJMP    ??ZDApp_ProcessNetworkJoin_12
   1445                  else
   1446                  {
   1447                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000B2   90....       MOV     DPTR,#devStartMode
   \   0000B5   7403         MOV     A,#0x3
   \   0000B7   F0           MOVX    @DPTR,A
   1448                    _tmpRejoinState = true;
   \   0000B8   90....       MOV     DPTR,#_tmpRejoinState
   \   0000BB   7401         MOV     A,#0x1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000BD   F0           MOVX    @DPTR,A
   1449                  }
   1450                }
   1451          
   1452                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1453                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   0000BE                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000BE   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000C1   8A..         MOV     ?V0 + 0,R2
   \   0000C3   8B..         MOV     ?V0 + 1,R3
   \   0000C5   74FE         MOV     A,#-0x2
   \   0000C7   65..         XRL     A,?V0 + 0
   \   0000C9   7004         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000CB   74FF         MOV     A,#-0x1
   \   0000CD   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000CF   700D         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000D1   90....       MOV     DPTR,#_NIB + 20
   \   0000D4   E0           MOVX    A,@DPTR
   \   0000D5   64FE         XRL     A,#0xfe
   \   0000D7   7003         JNZ     ??ZDApp_ProcessNetworkJoin_15
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F4           CPL     A
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   0000DC   601C         JZ      ??ZDApp_ProcessNetworkJoin_16
   1454                {
   1455                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000DE   85..82       MOV     DPL,?XSP + 0
   \   0000E1   85..83       MOV     DPH,?XSP + 1
   \   0000E4   74FE         MOV     A,#-0x2
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   04           INC     A
   \   0000E9   F0           MOVX    @DPTR,A
   1456                  // Invalidate nwk addr so end device does not use in its data reqs.
   1457                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000EA   90....       MOV     DPTR,#_NIB + 20
   \   0000ED   14           DEC     A
   \   0000EE   12....       LCALL   ?Subroutine10 & 0xFFFF
   1458                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   1459                }
   \                     ??CrossCallReturnLabel_0:
   \   0000F1   AA82         MOV     R2,DPL
   \   0000F3   AB83         MOV     R3,DPH
   \   0000F5   7953         MOV     R1,#0x53
   \   0000F7   12....       LCALL   ??ZMacSetReq?relay
   1460          
   1461                // Clear the neighbor Table and network discovery tables.
   1462                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   0000FA                ; Setup parameters for call to function nwkNeighborInitTable
   \   0000FA   12....       LCALL   ??nwkNeighborInitTable?relay
   1463                NLME_NwkDiscTerm();
   \   0000FD                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0000FD   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1464          
   1465                zdoDiscCounter = 1;
   \   000100   90....       MOV     DPTR,#zdoDiscCounter
   \   000103   7401         MOV     A,#0x1
   \   000105   F0           MOVX    @DPTR,A
   1466          
   1467          //      ZDApp_NetworkInit( (uint16)
   1468          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1469          //                          (NWK_START_DELAY * 5)) );
   1470                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1471                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000106                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000106                ; Setup parameters for call to function osal_rand
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   000106   12....       LCALL   ??osal_rand?relay
   \   000109   EA           MOV     A,R2
   \   00010A   547F         ANL     A,#0x7f
   \   00010C   2464         ADD     A,#0x64
   \   00010E   FA           MOV     R2,A
   \   00010F   7B00         MOV     R3,#0x0
   \   000111   12....       LCALL   ??ZDApp_NetworkInit?relay
   \   000114   02....       LJMP    ??CrossCallReturnLabel_61 & 0xFFFF
   1472              }
   1473            }
   1474            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   000117   E0           MOVX    A,@DPTR
   \   000118   6404         XRL     A,#0x4
   \   00011A   6003         JZ      $+5
   \   00011C   02....       LJMP    ??ZDApp_ProcessNetworkJoin_18 & 0xFFFF
   1475            {
   1476              // results of an orphaning attempt by this device
   1477              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   00011F   90....       MOV     DPTR,#nwkStatus
   \   000122   E0           MOVX    A,@DPTR
   \   000123   703C         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1478              {
   1479                if ( ZG_SECURE_ENABLED )
   \   000125   90....       MOV     DPTR,#zgSecurityMode
   \   000128   E0           MOVX    A,@DPTR
   \   000129   6003         JZ      ??ZDApp_ProcessNetworkJoin_20
   1480                {
   1481                  ZDApp_RestoreNwkKey();
   \   00012B                ; Setup parameters for call to function ZDApp_RestoreNwkKey
   \   00012B   12....       LCALL   ??ZDApp_RestoreNwkKey?relay
   1482                }
   1483          
   1484                devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   00012E   12....       LCALL   ?Subroutine8 & 0xFFFF
   1485                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1486                // setup Power Manager Device
   1487          #if defined ( POWER_SAVING )
   1488                osal_pwrmgr_device( PWRMGR_BATTERY );
   1489          #endif
   1490          
   1491                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??CrossCallReturnLabel_67:
   \   000131   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000134   E0           MOVX    A,@DPTR
   \   000135   A2E3         MOV     C,0xE0 /* A   */.3
   \   000137   5015         JNC     ??ZDApp_ProcessNetworkJoin_21
   1492                {
   1493                  // The receiver is on, turn network layer polling off.
   1494                  NLME_SetPollRate( 0 );
   \   000139                ; Setup parameters for call to function NLME_SetPollRate
   \   000139   7A00         MOV     R2,#0x0
   \   00013B   7B00         MOV     R3,#0x0
   \   00013D   12....       LCALL   ??NLME_SetPollRate?relay
   1495                  NLME_SetQueuedPollRate( 0 );
   \   000140                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000140   7A00         MOV     R2,#0x0
   \   000142   7B00         MOV     R3,#0x0
   \   000144   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1496                  NLME_SetResponseRate( 0 );
   \   000147                ; Setup parameters for call to function NLME_SetResponseRate
   \   000147   7A00         MOV     R2,#0x0
   \   000149   7B00         MOV     R3,#0x0
   \   00014B   12....       LCALL   ??NLME_SetResponseRate?relay
   1497                }
   1498          
   1499                if ( ZSTACK_ROUTER_BUILD )
   1500                {
   1501                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1502                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   00014E   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000151   6009         JZ      ??ZDApp_ProcessNetworkJoin_22
   1503                  {
   1504                    NLME_StartRouterRequest( 0, 0, false );
   \   000153                ; Setup parameters for call to function NLME_StartRouterRequest
   \   000153   7B00         MOV     R3,#0x0
   \   000155   7A00         MOV     R2,#0x0
   \   000157   7900         MOV     R1,#0x0
   \   000159   12....       LCALL   ??NLME_StartRouterRequest?relay
   1505                  }
   1506                }
   1507          
   1508                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   00015C                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00015C   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   00015F   805A         SJMP    ??CrossCallReturnLabel_61
   1509              }
   1510              else
   1511              {
   1512                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   000161   90....       MOV     DPTR,#devStartMode
   \   000164   E0           MOVX    A,@DPTR
   \   000165   6401         XRL     A,#0x1
   \   000167   703B         JNZ     ??ZDApp_ProcessNetworkJoin_23
   1513                {
   1514                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000169   90....       MOV     DPTR,#retryCnt
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   04           INC     A
   \   00016E   F0           MOVX    @DPTR,A
   \   00016F   C3           CLR     C
   \   000170   9404         SUBB    A,#0x4
   \   000172   5028         JNC     ??ZDApp_ProcessNetworkJoin_24
   1515                  {
   1516                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   000174   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000177   7003         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   000179   74FF         MOV     A,#-0x1
   \   00017B   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   00017C   600A         JZ      ??ZDApp_ProcessNetworkJoin_26
   \   00017E   74FE         MOV     A,#-0x2
   \   000180   68           XRL     A,R0
   \   000181   7003         JNZ     ??ZDApp_ProcessNetworkJoin_27
   \   000183   74FF         MOV     A,#-0x1
   \   000185   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_27:
   \   000186   7007         JNZ     ??ZDApp_ProcessNetworkJoin_28
   1517                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   000188   90....       MOV     DPTR,#devStartMode
   \   00018B   E4           CLR     A
   \                     ??ZDApp_ProcessNetworkJoin_29:
   \   00018C   F0           MOVX    @DPTR,A
   \   00018D   8015         SJMP    ??ZDApp_ProcessNetworkJoin_23
   1518                    else
   1519                    {
   1520                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_28:
   \   00018F   90....       MOV     DPTR,#devStartMode
   \   000192   7403         MOV     A,#0x3
   \   000194   F0           MOVX    @DPTR,A
   1521                      _tmpRejoinState = true;
   \   000195   90....       MOV     DPTR,#_tmpRejoinState
   \   000198   7401         MOV     A,#0x1
   \   00019A   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_29
   1522                    }
   1523                  }
   1524                  // Do a normal join to the network after certain times of rejoin retries
   1525                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00019C   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   00019F   E0           MOVX    A,@DPTR
   \   0001A0   6401         XRL     A,#0x1
   \   0001A2   60E4         JZ      ??ZDApp_ProcessNetworkJoin_26
   1526                  {
   1527                    devStartMode = MODE_JOIN;
   1528                  }
   1529                }
   1530          
   1531                // Clear the neighbor Table and network discovery tables.
   1532                nwkNeighborInitTable();
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   0001A4                ; Setup parameters for call to function nwkNeighborInitTable
   \   0001A4   12....       LCALL   ??nwkNeighborInitTable?relay
   1533                NLME_NwkDiscTerm();
   \   0001A7                ; Setup parameters for call to function NLME_NwkDiscTerm
   \   0001A7   12....       LCALL   ??NLME_NwkDiscTerm?relay
   1534          
   1535                // setup a retry for later...
   1536                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1537                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \   0001AA                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001AA                ; Setup parameters for call to function osal_rand
   \   0001AA   02....       LJMP    ??ZDApp_ProcessNetworkJoin_17 & 0xFFFF
   1538              }
   1539            }
   1540          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1541            else
   1542            {
   1543              // Assume from address conflict
   1544              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   0001AD   90....       MOV     DPTR,#_NIB + 96
   \   0001B0   E0           MOVX    A,@DPTR
   \   0001B1   6402         XRL     A,#0x2
   \   0001B3   7006         JNZ     ??CrossCallReturnLabel_61
   1545              {
   1546                // Notify the network
   1547                ZDApp_AnnounceNewAddress();
   \   0001B5                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   0001B5   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1548          
   1549                // Notify apps
   1550                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   0001B8                ; Setup parameters for call to function osal_set_event
   \   0001B8   12....       LCALL   ?Subroutine15 & 0xFFFF
   1551              }
   1552            }
   1553          #endif
   1554          }
   \                     ??CrossCallReturnLabel_61:
   \   0001BB                REQUIRE ?Subroutine6
   \   0001BB                ; // Fall through to label ?Subroutine6

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7402         MOV     A,#0x2
   \   000002   02....       LJMP    ??Subroutine49_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   90....       MOV     DPTR,#_NIB + 33
   \   000003   12....       LCALL   ?Subroutine35 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   000006   74FF         MOV     A,#-0x1
   \   000008   68           XRL     A,R0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   A3           INC     DPTR
   \   000002   04           INC     A
   \   000003   F0           MOVX    @DPTR,A
   \   000004                ; Setup parameters for call to function ZMacSetReq
   \   000004                ; Setup parameters for call to function osal_nv_read
   \   000004   85..82       MOV     DPL,?XSP + 0
   \   000007   85..83       MOV     DPH,?XSP + 1
   \   00000A   22           RET
   1555          
   1556          /*********************************************************************
   1557           * @fn      ZDApp_SaveNwkKey()
   1558           *
   1559           * @brief   Save off the Network key information.
   1560           *
   1561           * @param   none
   1562           *
   1563           * @return  none
   1564           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1565          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1566          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1567            nwkActiveKeyItems keyItems;
   1568          
   1569            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1570            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1571          
   1572            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1573                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7C00         MOV     R4,#0x0
   \   000047   7D00         MOV     R5,#0x0
   \   000049   7A82         MOV     R2,#-0x7e
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_write?relay
   \   000050   7404         MOV     A,#0x4
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   1574          
   1575            nwkFrameCounterChanges = 0;
   \   000055   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000058   E4           CLR     A
   \   000059   F0           MOVX    @DPTR,A
   \   00005A   A3           INC     DPTR
   \   00005B   F0           MOVX    @DPTR,A
   1576          
   1577            // Clear copy in RAM before return.
   1578            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \   00005C                ; Setup parameters for call to function osal_memset
   \   00005C   7C15         MOV     R4,#0x15
   \   00005E   FD           MOV     R5,A
   \   00005F   F9           MOV     R1,A
   \   000060   85..82       MOV     DPL,?XSP + 0
   \   000063   85..83       MOV     DPH,?XSP + 1
   \   000066   AA82         MOV     R2,DPL
   \   000068   AB83         MOV     R3,DPH
   \   00006A   12....       LCALL   ??osal_memset?relay
   1579          
   1580          }
   \   00006D                REQUIRE ?Subroutine7
   \   00006D                ; // Fall through to label ?Subroutine7

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7415         MOV     A,#0x15
   \   000002   80..         SJMP    ??Subroutine42_0
   1581          
   1582          /*********************************************************************
   1583           * @fn      ZDApp_ResetNwkKey()
   1584           *
   1585           * @brief   Reset the Network key information in NV.
   1586           *
   1587           * @param   none
   1588           *
   1589           * @return  none
   1590           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1591          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1592          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1593            nwkActiveKeyItems keyItems;
   1594          
   1595            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   12....       LCALL   ?Subroutine27 & 0xFFFF
   1596            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1597                          (void *)&keyItems );
   \                     ??CrossCallReturnLabel_34:
   \   00000F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000012   75..15       MOV     ?V0 + 0,#0x15
   \   000015   75..00       MOV     ?V0 + 1,#0x0
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   7C00         MOV     R4,#0x0
   \   00001F   7D00         MOV     R5,#0x0
   \   000021   7A82         MOV     R2,#-0x7e
   \   000023   7B00         MOV     R3,#0x0
   \   000025   12....       LCALL   ??osal_nv_write?relay
   \   000028   7404         MOV     A,#0x4
   \   00002A   12....       LCALL   ?DEALLOC_XSTACK8
   1598          }
   \   00002D   7415         MOV     A,#0x15
   \   00002F   02....       LJMP    ??Subroutine49_0 & 0xFFFF
   1599          
   1600          /*********************************************************************
   1601           * @fn      ZDApp_RestoreNwkKey()
   1602           *
   1603           * @brief
   1604           *
   1605           *   Save off the Network key information.
   1606           *
   1607           * @param   none
   1608           *
   1609           * @return  true if restored from NV, false if not
   1610           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1611          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1612          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1613            nwkActiveKeyItems keyItems;
   1614            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1615          
   1616            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1617                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000030   12....       LCALL   ?DEALLOC_XSTACK8
   \   000033   E9           MOV     A,R1
   \   000034   703F         JNZ     ??ZDApp_RestoreNwkKey_0
   1618            {
   1619              if ( keyItems.frameCounter > 0 )
   \   000036   7411         MOV     A,#0x11
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?L_MOV_X
   \   000040   E5..         MOV     A,?V0 + 0
   \   000042   45..         ORL     A,?V0 + 1
   \   000044   45..         ORL     A,?V0 + 2
   \   000046   45..         ORL     A,?V0 + 3
   \   000048   6021         JZ      ??ZDApp_RestoreNwkKey_1
   1620              {
   1621                // Restore the key information
   1622                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   \   00004A   90....       MOV     DPTR,#__Constant_3e8
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?L_MOV_X
   \   000052   7411         MOV     A,#0x11
   \   000054   12....       LCALL   ?XSTACK_DISP0_8
   \   000057   78..         MOV     R0,#?V0 + 0
   \   000059   12....       LCALL   ?L_ADD_TO_X
   1623                nwkFrameCounter = keyItems.frameCounter;
   \   00005C   7411         MOV     A,#0x11
   \   00005E   12....       LCALL   ?XSTACK_DISP0_8
   \   000061   12....       LCALL   ?XLOAD_R2345
   \   000064   90....       MOV     DPTR,#nwkFrameCounter
   \   000067   12....       LCALL   ?XSTORE_R2345
   1624                ret = true;
   \   00006A   0E           INC     R6
   1625              }
   1626          
   1627              // Force a save for the first frame counter increment
   1628              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00006B   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   00006E   74E9         MOV     A,#-0x17
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   7403         MOV     A,#0x3
   \   000074   F0           MOVX    @DPTR,A
   1629            }
   1630            // Clear copy in RAM before return.
   1631            osal_memset( &keyItems, 0x00, sizeof(keyItems) );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000075                ; Setup parameters for call to function osal_memset
   \   000075   7C15         MOV     R4,#0x15
   \   000077   7D00         MOV     R5,#0x0
   \   000079   7900         MOV     R1,#0x0
   \   00007B   85..82       MOV     DPL,?XSP + 0
   \   00007E   85..83       MOV     DPH,?XSP + 1
   \   000081   AA82         MOV     R2,DPL
   \   000083   AB83         MOV     R3,DPH
   \   000085   12....       LCALL   ??osal_memset?relay
   1632          
   1633            return ( ret );
   \   000088   EE           MOV     A,R6
   \   000089   F9           MOV     R1,A
   \   00008A   02....       LJMP    ?Subroutine7 & 0xFFFF
   1634          }
   1635          
   1636          /*********************************************************************
   1637           * @fn      ZDApp_ResetTimerStart
   1638           *
   1639           * @brief   Start the reset timer.
   1640           *
   1641           * @param   delay - delay time(ms) before reset
   1642           *
   1643           * @return  none
   1644           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1645          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1646          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1647            // Start the rest timer
   1648            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   7B00         MOV     R3,#0x0
   \   00000C   80..         SJMP    ?Subroutine2
   1649          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ??Subroutine46_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_84:
   \   000003                REQUIRE ??Subroutine44_0
   \   000003                ; // Fall through to label ??Subroutine44_0
   1650          
   1651          /*********************************************************************
   1652           * @fn      ZDApp_ResetTimerCancel
   1653           *
   1654           * @brief   Cancel the reset timer.
   1655           *
   1656           * @param   none
   1657           *
   1658           * @return  none
   1659           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1660          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1661          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1662            // Cancel the reset timer
   1663            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1664          }
   \   000010   80..         SJMP    ??Subroutine44_0
   1665          
   1666          /*********************************************************************
   1667           * @fn      ZDApp_LeaveCtrlInit
   1668           *
   1669           * @brief   Initialize the leave control logic.
   1670           *
   1671           * @param   none
   1672           *
   1673           * @return  none
   1674           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1675          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1676          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1677            uint8 status;
   1678          
   1679          
   1680            // Initialize control state
   1681            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   E4           CLR     A
   \   000009   F0           MOVX    @DPTR,A
   1682          
   1683            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1684                                        sizeof(ZDApp_LeaveCtrl),
   1685                                        &ZDApp_LeaveCtrl );
   1686          
   1687            if ( status == ZSUCCESS )
   \   00000A                ; Setup parameters for call to function osal_nv_item_init
   \   00000A   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   00000D   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000010   78..         MOV     R0,#?V0 + 0
   \   000012   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000015   7C01         MOV     R4,#0x1
   \   000017   7D00         MOV     R5,#0x0
   \   000019   7A85         MOV     R2,#-0x7b
   \   00001B   7B00         MOV     R3,#0x0
   \   00001D   12....       LCALL   ??osal_nv_item_init?relay
   \   000020   7402         MOV     A,#0x2
   \   000022   12....       LCALL   ?DEALLOC_XSTACK8
   \   000025   E9           MOV     A,R1
   \   000026   701C         JNZ     ??ZDApp_LeaveCtrlInit_0
   1688            {
   1689              // Read saved control
   1690              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1691                            0,
   1692                            sizeof( uint8 ),
   1693                            &ZDApp_LeaveCtrl);
   \   000028                ; Setup parameters for call to function osal_nv_read
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002D   75..01       MOV     ?V0 + 0,#0x1
   \   000030   75..00       MOV     ?V0 + 1,#0x0
   \   000033   78..         MOV     R0,#?V0 + 0
   \   000035   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000038   7C00         MOV     R4,#0x0
   \   00003A   7D00         MOV     R5,#0x0
   \   00003C   7A85         MOV     R2,#-0x7b
   \   00003E   12....       LCALL   ?Subroutine31 & 0xFFFF
   1694            }
   \                     ??CrossCallReturnLabel_41:
   \   000041   12....       LCALL   ?DEALLOC_XSTACK8
   1695          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   000044   02....       LJMP    ??Subroutine50_0 & 0xFFFF
   1696          
   1697          /*********************************************************************
   1698           * @fn      ZDApp_LeaveCtrlSet
   1699           *
   1700           * @brief   Set the leave control logic.
   1701           *
   1702           * @param   ra - reassociate flag
   1703           *
   1704           * @return  none
   1705           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1706          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1707          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   1708            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   7401         MOV     A,#0x1
   \   00000C   F0           MOVX    @DPTR,A
   1709          
   1710            if ( ra == TRUE )
   \   00000D   6E           XRL     A,R6
   \   00000E   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1711            {
   1712              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   000010   7403         MOV     A,#0x3
   \   000012   F0           MOVX    @DPTR,A
   1713            }
   1714          
   1715            // Write the leave control
   1716            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1717                           0,
   1718                           sizeof( uint8 ),
   1719                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000013                ; Setup parameters for call to function osal_nv_write
   \   000013   02....       LJMP    ?Subroutine3 & 0xFFFF
   1720          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   75....       MOV     ?V0 + 0,#ZDApp_LeaveCtrl & 0xff
   \   000003   75....       MOV     ?V0 + 1,#(ZDApp_LeaveCtrl >> 8) & 0xff
   \   000006   78..         MOV     R0,#?V0 + 0
   \   000008   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000B   75..01       MOV     ?V0 + 0,#0x1
   \   00000E   75..00       MOV     ?V0 + 1,#0x0
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000016   7C00         MOV     R4,#0x0
   \   000018   7D00         MOV     R5,#0x0
   \   00001A   7A85         MOV     R2,#-0x7b
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   12....       LCALL   ??osal_nv_write?relay
   \   000021   7404         MOV     A,#0x4
   \   000023                REQUIRE ??Subroutine49_0
   \   000023                ; // Fall through to label ??Subroutine49_0
   1721          
   1722          /*********************************************************************
   1723           * @fn      ZDApp_LeaveCtrlReset
   1724           *
   1725           * @brief   Re-initialize the leave control logic.
   1726           *
   1727           * @param   none
   1728           *
   1729           * @return  none
   1730           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1731          void ZDApp_LeaveCtrlReset( void )
   \                     ZDApp_LeaveCtrlReset:
   1732          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1733            // Set leave control to initialized state
   1734            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000008   E4           CLR     A
   \   000009   F0           MOVX    @DPTR,A
   1735          
   1736            // Write initialized control
   1737            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1738                          0,
   1739                          sizeof( uint8 ),
   1740                          &ZDApp_LeaveCtrl);
   \   00000A                ; Setup parameters for call to function osal_nv_write
   \   00000A   02....       LJMP    ?Subroutine3 & 0xFFFF
   1741          }
   1742          
   1743          /*********************************************************************
   1744           * @fn      ZDApp_LeaveCtrlBypass
   1745           *
   1746           * @brief   Check if NV restore should be skipped during a leave reset.
   1747           *
   1748           * @param   none
   1749           *
   1750           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1751           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1752          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1753          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1754            uint8 bypass;
   1755          
   1756            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1757            {
   1758              bypass = TRUE;
   1759            }
   1760            else
   1761            {
   1762              bypass = FALSE;
   1763            }
   1764          
   1765            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   33           RLC     A
   \   00000C   F9           MOV     R1,A
   \   00000D   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   1766          }
   1767          
   1768          /*********************************************************************
   1769           * @fn      ZDApp_LeaveCtrlStartup
   1770           *
   1771           * @brief   Check for startup conditions during a leave reset.
   1772           *
   1773           * @param   state      - devState_t determined by leave control logic
   1774           * @param   startDelay - startup delay
   1775           *
   1776           * @return  none
   1777           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1778          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1779          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1780            *startDelay = 0;
   \   000004   8C82         MOV     DPL,R4
   \   000006   8D83         MOV     DPH,R5
   \   000008   E4           CLR     A
   \   000009   F0           MOVX    @DPTR,A
   \   00000A   A3           INC     DPTR
   \   00000B   F0           MOVX    @DPTR,A
   1781          
   1782            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000C   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   A2E0         MOV     C,0xE0 /* A   */.0
   \   000012   5019         JNC     ??ZDApp_LeaveCtrlStartup_0
   1783            {
   1784              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000014   A2E1         MOV     C,0xE0 /* A   */.1
   \   000016   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1785              {
   1786                *startDelay = LEAVE_RESET_DELAY;
   \   000018   8C82         MOV     DPL,R4
   \   00001A   8D83         MOV     DPH,R5
   \   00001C   7488         MOV     A,#-0x78
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   A3           INC     DPTR
   \   000020   7413         MOV     A,#0x13
   \   000022   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1787              }
   1788              else
   1789              {
   1790                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000024   8A82         MOV     DPL,R2
   \   000026   8B83         MOV     DPH,R3
   \   000028   E4           CLR     A
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   000029   F0           MOVX    @DPTR,A
   1791              }
   1792          
   1793              // Reset leave control logic
   1794              ZDApp_LeaveCtrlReset();
   \   00002A                ; Setup parameters for call to function ZDApp_LeaveCtrlReset
   \   00002A   12....       LCALL   ??ZDApp_LeaveCtrlReset?relay
   1795            }
   1796          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   00002D   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   1797          
   1798          /*********************************************************************
   1799           * @fn      ZDApp_LeaveReset
   1800           *
   1801           * @brief   Setup a device reset due to a leave indication/confirm.
   1802           *
   1803           * @param   ra - reassociate flag
   1804           *
   1805           * @return  none
   1806           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1807          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1808          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1809            ZDApp_LeaveCtrlSet( ra );
   \   000005                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000005   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1810          
   1811            ZDApp_ResetTimerStart( LEAVE_RESET_DELAY );
   \   000008                ; Setup parameters for call to function osal_start_timerEx
   \   000008   7C88         MOV     R4,#-0x78
   \   00000A   7D13         MOV     R5,#0x13
   \   00000C   7A04         MOV     R2,#0x4
   \   00000E   12....       LCALL   ??Subroutine45_0 & 0xFFFF
   1812          }
   \                     ??CrossCallReturnLabel_82:
   \   000011   02....       LJMP    ??Subroutine51_0 & 0xFFFF
   1813          
   1814          /*********************************************************************
   1815           * @fn      ZDApp_LeaveUpdate
   1816           *
   1817           * @brief   Update local device data related to leaving device.
   1818           *
   1819           * @param   nwkAddr        - NWK address of leaving device
   1820           * @param   extAddr        - EXT address of leaving device
   1821           * @param   removeChildren - remove children of leaving device
   1822           *
   1823           * @return  none
   1824           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1825          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1826                                  uint8 removeChildren )
   1827          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 2,R1
   1828            // Remove Apps Key for leaving device
   1829            ZDSecMgrDeviceRemoveByExtAddr(extAddr);
   \   000014                ; Setup parameters for call to function ZDSecMgrDeviceRemoveByExtAddr
   \   000014   EE           MOV     A,R6
   \   000015   FA           MOV     R2,A
   \   000016   EF           MOV     A,R7
   \   000017   FB           MOV     R3,A
   \   000018   12....       LCALL   ??ZDSecMgrDeviceRemoveByExtAddr?relay
   1830          
   1831            // Clear SECURITY bit from Address Manager
   1832            ZDSecMgrAddrClear( extAddr );
   \   00001B                ; Setup parameters for call to function ZDSecMgrAddrClear
   \   00001B   EE           MOV     A,R6
   \   00001C   FA           MOV     R2,A
   \   00001D   EF           MOV     A,R7
   \   00001E   FB           MOV     R3,A
   \   00001F   12....       LCALL   ??ZDSecMgrAddrClear?relay
   1833          
   1834            if ( pbindRemoveDev )
   \   000022   90....       MOV     DPTR,#pbindRemoveDev
   \   000025   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000028   603C         JZ      ??ZDApp_LeaveUpdate_0
   1835            {
   1836              zAddrType_t devAddr;
   1837          
   1838              // Remove bind entry and all related data
   1839              devAddr.addrMode = Addr64Bit;
   \   00002A   7408         MOV     A,#0x8
   \   00002C   12....       LCALL   ?XSTACK_DISP0_8
   \   00002F   7403         MOV     A,#0x3
   \   000031   F0           MOVX    @DPTR,A
   1840              osal_memcpy(devAddr.addr.extAddr, extAddr, Z_EXTADDR_LEN);
   \   000032                ; Setup parameters for call to function osal_memcpy
   \   000032   8E..         MOV     ?V0 + 4,R6
   \   000034   8F..         MOV     ?V0 + 5,R7
   \   000036   75..00       MOV     ?V0 + 6,#0x0
   \   000039   78..         MOV     R0,#?V0 + 4
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00003E   7C08         MOV     R4,#0x8
   \   000040   7D00         MOV     R5,#0x0
   \   000042   7403         MOV     A,#0x3
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_memcpy?relay
   \   00004E   7403         MOV     A,#0x3
   \   000050   12....       LCALL   ?DEALLOC_XSTACK8
   1841          
   1842              pbindRemoveDev(&devAddr);
   \   000053                ; Setup parameters for indirect call
   \   000053   85..82       MOV     DPL,?XSP + 0
   \   000056   85..83       MOV     DPH,?XSP + 1
   \   000059   AA82         MOV     R2,DPL
   \   00005B   AB83         MOV     R3,DPH
   \   00005D   90....       MOV     DPTR,#pbindRemoveDev
   \   000060   12....       LCALL   ?Subroutine24 & 0xFFFF
   1843            }
   \                     ??CrossCallReturnLabel_88:
   \   000063   12....       LCALL   ?CALL_IND
   1844          
   1845            // Remove if child
   1846            if ( ZSTACK_ROUTER_BUILD )
   1847            {
   1848              NLME_RemoveChild( extAddr, removeChildren );
   \                     ??ZDApp_LeaveUpdate_0:
   \   000066                ; Setup parameters for call to function NLME_RemoveChild
   \   000066   A9..         MOV     R1,?V0 + 2
   \   000068   EE           MOV     A,R6
   \   000069   FA           MOV     R2,A
   \   00006A   EF           MOV     A,R7
   \   00006B   FB           MOV     R3,A
   \   00006C   12....       LCALL   ??NLME_RemoveChild?relay
   1849            }
   1850          
   1851            // Remove Routing table related entry
   1852            RTG_RemoveRtgEntry( nwkAddr, 0 );
   \   00006F                ; Setup parameters for call to function RTG_RemoveRtgEntry
   \   00006F   7900         MOV     R1,#0x0
   \   000071   AA..         MOV     R2,?V0 + 0
   \   000073   AB..         MOV     R3,?V0 + 1
   \   000075   12....       LCALL   ??RTG_RemoveRtgEntry?relay
   1853          
   1854            // Remove entry from neighborTable
   1855            nwkNeighborRemove( nwkAddr, _NIB.nwkPanId );
   \   000078                ; Setup parameters for call to function nwkNeighborRemove
   \   000078   90....       MOV     DPTR,#_NIB + 33
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   FC           MOV     R4,A
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   FD           MOV     R5,A
   \   000080   AA..         MOV     R2,?V0 + 0
   \   000082   AB..         MOV     R3,?V0 + 1
   \   000084   12....       LCALL   ??nwkNeighborRemove?relay
   1856          
   1857            // Schedule to save data to NV
   1858            ZDApp_NwkWriteNVRequest();
   \   000087                ; Setup parameters for call to function AddrMgrWriteNVRequest
   \   000087   12....       LCALL   ??AddrMgrWriteNVRequest?relay
   1859          }
   \   00008A   7409         MOV     A,#0x9
   \   00008C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008F   7F07         MOV     R7,#0x7
   \   000091   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003                REQUIRE ??Subroutine48_0
   \   000003                ; // Fall through to label ??Subroutine48_0
   1860          
   1861          /*********************************************************************
   1862           * @fn      ZDApp_NetworkDiscoveryReq
   1863           *
   1864           * @brief   Request a network discovery.
   1865           *
   1866           * @param  scanChannels -
   1867           * @param  scanDuration -
   1868           *
   1869           * @return  ZStatus_t
   1870           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1871          ZStatus_t ZDApp_NetworkDiscoveryReq( uint32 scanChannels, uint8 scanDuration)
   \                     ZDApp_NetworkDiscoveryReq:
   1872          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   1873            // Setup optional filters - tbd
   1874          
   1875            // Request NLME network discovery
   1876            return NLME_NetworkDiscoveryRequest(scanChannels, scanDuration);
   \   000005                ; Setup parameters for call to function NLME_NetworkDiscoveryRequest
   \   000005   12....       LCALL   ??NLME_NetworkDiscoveryRequest?relay
   \   000008   02....       LJMP    ??Subroutine43_0 & 0xFFFF
   1877          }
   1878          
   1879          /*********************************************************************
   1880           * @fn      ZDApp_JoinReq
   1881           *
   1882           * @brief   Request the device to join a parent in a network.
   1883           *
   1884           * @param   channel -
   1885           * @param   panID -
   1886           *
   1887           * @return  ZStatus_t
   1888           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1889          ZStatus_t ZDApp_JoinReq( uint8 channel, uint16 panID, uint8 *extendedPanID,
   \                     ZDApp_JoinReq:
   1890                                   uint16 chosenParent, uint8 parentDepth, uint8 stackProfile )
   1891          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 0,R2
   \   000009   8B..         MOV     ?V0 + 1,R3
   \   00000B   EC           MOV     A,R4
   \   00000C   FE           MOV     R6,A
   \   00000D   ED           MOV     A,R5
   \   00000E   FF           MOV     R7,A
   \   00000F   740E         MOV     A,#0xe
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 3,A
   \   00001B   7410         MOV     A,#0x10
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 5,A
   \   000023   7411         MOV     A,#0x11
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F9           MOV     R1,A
   1892            // Sync up the node with the stack profile (In the case where a pro device
   1893            // joins a non-pro network, or verse versa)
   1894            ZDApp_NodeProfileSync( stackProfile);
   \   00002A                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   00002A   12....       LCALL   ??ZDApp_NodeProfileSync?relay
   1895          
   1896            // Request NLME Join Request
   1897            return NLME_JoinRequest(extendedPanID, panID,channel,
   1898                                    ZDO_Config_Node_Descriptor.CapabilityFlags,
   1899                                    chosenParent, parentDepth);
   \   00002D                ; Setup parameters for call to function NLME_JoinRequest
   \   00002D   78..         MOV     R0,#?V0 + 5
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000032   78..         MOV     R0,#?V0 + 2
   \   000034   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000037   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   F5..         MOV     ?V0 + 2,A
   \   00003D   78..         MOV     R0,#?V0 + 2
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000042   A9..         MOV     R1,?V0 + 4
   \   000044   AC..         MOV     R4,?V0 + 0
   \   000046   AD..         MOV     R5,?V0 + 1
   \   000048   EE           MOV     A,R6
   \   000049   FA           MOV     R2,A
   \   00004A   EF           MOV     A,R7
   \   00004B   FB           MOV     R3,A
   \   00004C   12....       LCALL   ??NLME_JoinRequest?relay
   \   00004F   7404         MOV     A,#0x4
   \   000051   12....       LCALL   ?DEALLOC_XSTACK8
   \   000054   02....       LJMP    ?Subroutine4 & 0xFFFF
   1900          
   1901          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7F06         MOV     R7,#0x6
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
   1902          
   1903          /*********************************************************************
   1904           * @fn      ZDApp_DeviceConfigured
   1905           *
   1906           * @brief   Check to see if the local device is configured (i.e., part
   1907           *          of a network).
   1908           *
   1909           * @param   none
   1910           *
   1911           * @return  TRUE if configured. FALSE, otherwise.
   1912           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1913          uint8 ZDApp_DeviceConfigured( void )
   \                     ZDApp_DeviceConfigured:
   1914          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1915            uint16 nwkAddr = INVALID_NODE_ADDR;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   74FE         MOV     A,#-0x2
   \   000012   12....       LCALL   ?Subroutine10 & 0xFFFF
   1916          
   1917            osal_nv_read( ZCD_NV_NIB, osal_offsetof( nwkIB_t, nwkDevAddress ),
   1918                          sizeof( uint16), &nwkAddr );
   \                     ??CrossCallReturnLabel_1:
   \   000015   8582..       MOV     ?V0 + 0,DPL
   \   000018   8583..       MOV     ?V0 + 1,DPH
   \   00001B   78..         MOV     R0,#?V0 + 0
   \   00001D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000020   75..02       MOV     ?V0 + 0,#0x2
   \   000023   75..00       MOV     ?V0 + 1,#0x0
   \   000026   78..         MOV     R0,#?V0 + 0
   \   000028   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002B   7C14         MOV     R4,#0x14
   \   00002D   7D00         MOV     R5,#0x0
   \   00002F   7A21         MOV     R2,#0x21
   \   000031   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   1919          
   1920            // Does the NIB have anything more than default?
   1921            return ( nwkAddr == INVALID_NODE_ADDR ? FALSE : TRUE );
   \   000037   85..82       MOV     DPL,?XSP + 0
   \   00003A   85..83       MOV     DPH,?XSP + 1
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   64FE         XRL     A,#0xfe
   \   000040   7003         JNZ     ??ZDApp_DeviceConfigured_0
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F4           CPL     A
   \                     ??ZDApp_DeviceConfigured_0:
   \   000045   7004         JNZ     ??ZDApp_DeviceConfigured_1
   \   000047   7900         MOV     R1,#0x0
   \   000049   8002         SJMP    ??ZDApp_DeviceConfigured_2
   \                     ??ZDApp_DeviceConfigured_1:
   \   00004B   7901         MOV     R1,#0x1
   \                     ??ZDApp_DeviceConfigured_2:
   \   00004D   02....       LJMP    ?Subroutine6 & 0xFFFF
   1922          }
   1923          
   1924          /*********************************************************************
   1925           * CALLBACK FUNCTIONS
   1926           */
   1927          
   1928          
   1929          /*********************************************************************
   1930           * @fn      ZDApp_SendEventMsg()
   1931           *
   1932           * @brief
   1933           *
   1934           *   Sends a Network Join message
   1935           *
   1936           * @param  cmd - command ID
   1937           * @param  len - length (in bytes) of the buf field
   1938           * @param  buf - buffer for the rest of the message.
   1939           *
   1940           * @return  none
   1941           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1942          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1943          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   1944            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000008                ; Setup parameters for call to function ZDApp_SendMsg
   \   000008   FB           MOV     R3,A
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B   12....       LCALL   ?Subroutine22 & 0xFFFF
   1945          }
   \                     ??CrossCallReturnLabel_23:
   \   00000E   80..         SJMP    ??Subroutine51_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   90....       MOV     DPTR,#ZDAppTaskID
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   12....       LCALL   ??ZDApp_SendMsg?relay
   \   000008   22           RET
   1946          
   1947          /*********************************************************************
   1948           * @fn      ZDApp_SendMsg()
   1949           *
   1950           * @brief   Sends a OSAL message
   1951           *
   1952           * @param  taskID - Where to send the message
   1953           * @param  cmd - command ID
   1954           * @param  len - length (in bytes) of the buf field
   1955           * @param  buf - buffer for the rest of the message.
   1956           *
   1957           * @return  none
   1958           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1959          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1960          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 4,R1
   \   000007   8A..         MOV     ?V0 + 6,R2
   \   000009   8B..         MOV     ?V0 + 5,R3
   \   00000B   8C..         MOV     ?V0 + 2,R4
   \   00000D   8D..         MOV     ?V0 + 3,R5
   1961            osal_event_hdr_t *msgPtr;
   1962          
   1963            // Send the address to the task
   1964            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00000F   8B82         MOV     DPL,R3
   \   000011   8582..       MOV     ?V0 + 0,DPL
   \   000014   75..00       MOV     ?V0 + 1,#0x0
   \   000017                ; Setup parameters for call to function osal_msg_allocate
   \   000017   AA..         MOV     R2,?V0 + 0
   \   000019   AB..         MOV     R3,?V0 + 1
   \   00001B   12....       LCALL   ??osal_msg_allocate?relay
   \   00001E   8A..         MOV     ?V0 + 8,R2
   \   000020   8B..         MOV     ?V0 + 9,R3
   \   000022   AE..         MOV     R6,?V0 + 8
   \   000024   AF..         MOV     R7,?V0 + 9
   1965            if ( msgPtr )
   \   000026   EE           MOV     A,R6
   \   000027   4F           ORL     A,R7
   \   000028   6034         JZ      ??ZDApp_SendMsg_0
   1966            {
   1967              if ( (len > 0) && (buf != NULL) )
   \   00002A   E5..         MOV     A,?V0 + 5
   \   00002C   6020         JZ      ??ZDApp_SendMsg_1
   \   00002E   E5..         MOV     A,?V0 + 2
   \   000030   45..         ORL     A,?V0 + 3
   \   000032   601A         JZ      ??ZDApp_SendMsg_1
   1968                osal_memcpy( msgPtr, buf, len );
   \   000034                ; Setup parameters for call to function osal_memcpy
   \   000034   85....       MOV     ?V0 + 8,?V0 + 2
   \   000037   85....       MOV     ?V0 + 9,?V0 + 3
   \   00003A   75..00       MOV     ?V0 + 10,#0x0
   \   00003D   78..         MOV     R0,#?V0 + 8
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000042   AC..         MOV     R4,?V0 + 0
   \   000044   AD..         MOV     R5,?V0 + 1
   \   000046   12....       LCALL   ??osal_memcpy?relay
   \   000049   7403         MOV     A,#0x3
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
   1969          
   1970              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_1:
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   E5..         MOV     A,?V0 + 6
   \   000054   F0           MOVX    @DPTR,A
   1971              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000055                ; Setup parameters for call to function osal_msg_send
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   A9..         MOV     R1,?V0 + 4
   \   00005B   12....       LCALL   ??osal_msg_send?relay
   1972            }
   1973          }
   \                     ??ZDApp_SendMsg_0:
   \   00005E   7F0B         MOV     R7,#0xb
   \   000060   02....       LJMP    ?BANKED_LEAVE_XDATA
   1974          
   1975          /*********************************************************************
   1976           * Call Back Functions from NWK  - API
   1977           */
   1978          
   1979          /*********************************************************************
   1980           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1981           *
   1982           * @brief       This function returns a choice of PAN to join.
   1983           *
   1984           * @param       status - return status of the nwk discovery confirm
   1985           *
   1986           * @return      ZStatus_t
   1987           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1988          ZStatus_t ZDO_NetworkDiscoveryConfirmCB(uint8 status)
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1989          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
   1990            osal_event_hdr_t msg;
   1991          
   1992            // If Scan is initiated by ZDO_MGMT_NWK_DISC_REQ
   1993            // Send ZDO_MGMT_NWK_DISC_RSP back
   1994          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1995            if ( zdappMgmtNwkDiscReqInProgress )
   1996            {
   1997              zdappMgmtNwkDiscReqInProgress = false;
   1998              ZDO_FinishProcessingMgmtNwkDiscReq();
   1999            }
   2000            else
   2001          #endif
   2002            {
   2003              // Pass the confirm to another task if it registers the callback
   2004              // Otherwise, pass the confirm to ZDApp.
   2005              if (zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID] != NULL )
   \   000011   90....       MOV     DPTR,#zdoCBFunc + 4
   \   000014   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000017   6013         JZ      ??ZDO_NetworkDiscoveryConfirmCB_0
   2006              {
   2007                zdoCBFunc[ZDO_NWK_DISCOVERY_CNF_CBID]( (void*)&status );
   \   000019                ; Setup parameters for indirect call
   \   000019   85..82       MOV     DPL,?XSP + 0
   \   00001C   85..83       MOV     DPH,?XSP + 1
   \   00001F   AA82         MOV     R2,DPL
   \   000021   AB83         MOV     R3,DPH
   \   000023   8882         MOV     DPL,R0
   \   000025   8983         MOV     DPH,R1
   \   000027   12....       LCALL   ?CALL_IND
   \   00002A   8016         SJMP    ??CrossCallReturnLabel_24
   2008              }
   2009              else
   2010              {
   2011                // Otherwise, send scan confirm to ZDApp task to proceed
   2012                msg.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   00002C   7402         MOV     A,#0x2
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   E4           CLR     A
   \   000032   F0           MOVX    @DPTR,A
   2013                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(osal_event_hdr_t), (uint8 *)&msg );
   \   000033                ; Setup parameters for call to function ZDApp_SendMsg
   \   000033   04           INC     A
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   AC82         MOV     R4,DPL
   \   000039   AD83         MOV     R5,DPH
   \   00003B   7B02         MOV     R3,#0x2
   \   00003D   7A01         MOV     R2,#0x1
   \   00003F   12....       LCALL   ?Subroutine22 & 0xFFFF
   2014              }
   2015            }
   2016            return (ZSuccess);
   \                     ??CrossCallReturnLabel_24:
   \   000042   7900         MOV     R1,#0x0
   \   000044   7403         MOV     A,#0x3
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   2017          }  // ZDO_NetworkDiscoveryConfirmCB
   2018          
   2019          /*********************************************************************
   2020           * @fn          ZDApp_NwkDescListProcessing
   2021           *
   2022           * @brief       This function process the network discovery result and select
   2023           *              a parent device to join itself.
   2024           *
   2025           * @param       none
   2026           *
   2027           * @return      ZStatus_t
   2028           */
   2029          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2030          networkDesc_t* ZDApp_NwkDescListProcessing(void)
   \                     ZDApp_NwkDescListProcessing:
   2031          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   2032            networkDesc_t *pNwkDesc;
   2033            uint8 i, ResultCount = 0;
   \   000005   75..00       MOV     ?V0 + 0,#0x0
   2034            uint8 stackProfile;
   2035            uint8 stackProfilePro;
   2036            uint8 selected;
   2037          
   2038            // Count the number of nwk descriptors in the list
   2039            pNwkDesc = nwk_getNwkDescList();
   \   000008                ; Setup parameters for call to function nwk_getNwkDescList
   \   000008   12....       LCALL   ??nwk_getNwkDescList?relay
   \   00000B   8A..         MOV     ?V0 + 2,R2
   \   00000D   8B..         MOV     ?V0 + 3,R3
   \   00000F   AE..         MOV     R6,?V0 + 2
   \   000011   AF..         MOV     R7,?V0 + 3
   2040            while (pNwkDesc)
   \   000013   EE           MOV     A,R6
   \   000014   4F           ORL     A,R7
   \   000015   6009         JZ      ??ZDApp_NwkDescListProcessing_0
   2041            {
   2042              ResultCount++;
   \                     ??ZDApp_NwkDescListProcessing_1:
   \   000017   05..         INC     ?V0 + 0
   2043              pNwkDesc = pNwkDesc->nextDesc;
   \   000019   12....       LCALL   ?Subroutine20 & 0xFFFF
   2044            }
   \                     ??CrossCallReturnLabel_102:
   \   00001C   EE           MOV     A,R6
   \   00001D   4F           ORL     A,R7
   \   00001E   70F7         JNZ     ??ZDApp_NwkDescListProcessing_1
   2045          
   2046            // process discovery results
   2047            stackProfilePro = FALSE;
   \                     ??ZDApp_NwkDescListProcessing_0:
   \   000020   75..00       MOV     ?V0 + 3,#0x0
   2048            selected = FALSE;
   2049          
   2050          
   2051            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000023   75..00       MOV     ?V0 + 1,#0x0
   2052            {
   2053              pNwkDesc = nwk_getNwkDescList();
   \                     ??ZDApp_NwkDescListProcessing_2:
   \   000026                ; Setup parameters for call to function nwk_getNwkDescList
   \   000026   12....       LCALL   ??nwk_getNwkDescList?relay
   \   000029   8A..         MOV     ?V0 + 4,R2
   \   00002B   8B..         MOV     ?V0 + 5,R3
   \   00002D   AE..         MOV     R6,?V0 + 4
   \   00002F   AF..         MOV     R7,?V0 + 5
   2054              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   000031   75..00       MOV     ?V0 + 2,#0x0
   \   000034   E5..         MOV     A,?V0 + 0
   \   000036   7003         JNZ     $+5
   \   000038   02....       LJMP    ??ZDApp_NwkDescListProcessing_3 & 0xFFFF
   2055              {
   2056                if ( zgConfigPANID != 0xFFFF )
   \                     ??ZDApp_NwkDescListProcessing_4:
   \   00003B   90....       MOV     DPTR,#zgConfigPANID
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F4           CPL     A
   \   000040   7003         JNZ     ??ZDApp_NwkDescListProcessing_5
   \   000042   A3           INC     DPTR
   \   000043   E0           MOVX    A,@DPTR
   \   000044   F4           CPL     A
   \                     ??ZDApp_NwkDescListProcessing_5:
   \   000045   6013         JZ      ??ZDApp_NwkDescListProcessing_6
   2057                {
   2058                  // PAN Id is preconfigured. check if it matches
   2059                  if ( pNwkDesc->panId != zgConfigPANID )
   \   000047   8E82         MOV     DPL,R6
   \   000049   8F83         MOV     DPH,R7
   \   00004B   12....       LCALL   ?Subroutine35 & 0xFFFF
   2060                    continue;
   2061                }
   \                     ??CrossCallReturnLabel_52:
   \   00004E   90....       MOV     DPTR,#zgConfigPANID
   \   000051   E0           MOVX    A,@DPTR
   \   000052   68           XRL     A,R0
   \   000053   7003         JNZ     ??ZDApp_NwkDescListProcessing_7
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   69           XRL     A,R1
   \                     ??ZDApp_NwkDescListProcessing_7:
   \   000058   7074         JNZ     ??ZDApp_NwkDescListProcessing_8
   2062          
   2063                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   \                     ??ZDApp_NwkDescListProcessing_6:
   \   00005A                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   00005A   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   00005C   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   00005E   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   000061   E9           MOV     A,R1
   \   000062   6401         XRL     A,#0x1
   \   000064   7012         JNZ     ??ZDApp_NwkDescListProcessing_9
   2064                {
   2065                  // If the extended Pan ID is commissioned to a non zero value
   2066                  // Only join the Pan that has match EPID
   2067                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   \   000066                ; Setup parameters for call to function sAddrExtCmp
   \   000066   EE           MOV     A,R6
   \   000067   240B         ADD     A,#0xb
   \   000069   FC           MOV     R4,A
   \   00006A   EF           MOV     A,R7
   \   00006B   3400         ADDC    A,#0x0
   \   00006D   FD           MOV     R5,A
   \   00006E   7A..         MOV     R2,#ZDO_UseExtendedPANID & 0xff
   \   000070   7B..         MOV     R3,#(ZDO_UseExtendedPANID >> 8) & 0xff
   \   000072   12....       LCALL   ??sAddrExtCmp?relay
   \   000075   E9           MOV     A,R1
   \   000076   6056         JZ      ??ZDApp_NwkDescListProcessing_8
   2068                    continue;
   2069          
   2070                }
   2071          
   2072                // check that network is allowing joining
   2073                if ( ZSTACK_ROUTER_BUILD )
   2074                {
   2075                  if ( stackProfilePro == FALSE )
   \                     ??ZDApp_NwkDescListProcessing_9:
   \   000078   E5..         MOV     A,?V0 + 3
   \   00007A   8E82         MOV     DPL,R6
   \   00007C   8F83         MOV     DPH,R7
   \   00007E   A3           INC     DPTR
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   7005         JNZ     ??ZDApp_NwkDescListProcessing_10
   2076                  {
   2077                    if ( !pNwkDesc->routerCapacity )
   \   000083   E0           MOVX    A,@DPTR
   \   000084   7006         JNZ     ??ZDApp_NwkDescListProcessing_11
   \   000086   8046         SJMP    ??ZDApp_NwkDescListProcessing_8
   2078                    {
   2079                      continue;
   2080                    }
   2081                  }
   2082                  else
   2083                  {
   2084                    if ( !pNwkDesc->deviceCapacity )
   \                     ??ZDApp_NwkDescListProcessing_10:
   \   000088   A3           INC     DPTR
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   6042         JZ      ??ZDApp_NwkDescListProcessing_8
   2085                    {
   2086                      continue;
   2087                    }
   2088                  }
   2089                }
   2090                else if ( ZSTACK_END_DEVICE_BUILD )
   2091                {
   2092                  if ( !pNwkDesc->deviceCapacity )
   2093                  {
   2094                    continue;
   2095                  }
   2096                }
   2097          
   2098                // check version of zigbee protocol
   2099                if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \                     ??ZDApp_NwkDescListProcessing_11:
   \   00008C   8E82         MOV     DPL,R6
   \   00008E   8F83         MOV     DPH,R7
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   A3           INC     DPTR
   \   000093   A3           INC     DPTR
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F8           MOV     R0,A
   \   000097   90....       MOV     DPTR,#_NIB + 17
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   68           XRL     A,R0
   \   00009C   7030         JNZ     ??ZDApp_NwkDescListProcessing_8
   2100                  continue;
   2101          
   2102                // check version of stack profile
   2103                if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   00009E   8E82         MOV     DPL,R6
   \   0000A0   8F83         MOV     DPH,R7
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   E0           MOVX    A,@DPTR
   \   0000A9   F8           MOV     R0,A
   \   0000AA   90....       MOV     DPTR,#zgStackProfile
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   68           XRL     A,R0
   \   0000AF   602C         JZ      ??ZDApp_NwkDescListProcessing_12
   2104                {
   2105                  if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   2106                      || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   6401         XRL     A,#0x1
   \   0000B4   7007         JNZ     ??ZDApp_NwkDescListProcessing_13
   \   0000B6   7402         MOV     A,#0x2
   \   0000B8   68           XRL     A,R0
   \   0000B9   700F         JNZ     ??ZDApp_NwkDescListProcessing_14
   \   0000BB   800A         SJMP    ??ZDApp_NwkDescListProcessing_15
   \                     ??ZDApp_NwkDescListProcessing_13:
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   6402         XRL     A,#0x2
   \   0000C0   7008         JNZ     ??ZDApp_NwkDescListProcessing_14
   \   0000C2   7401         MOV     A,#0x1
   \   0000C4   68           XRL     A,R0
   \   0000C5   7003         JNZ     ??ZDApp_NwkDescListProcessing_14
   2107                  {
   2108                    stackProfilePro = TRUE;
   \                     ??ZDApp_NwkDescListProcessing_15:
   \   0000C7   75..01       MOV     ?V0 + 3,#0x1
   2109                  }
   2110          
   2111                  if ( stackProfile == 0 )
   \                     ??ZDApp_NwkDescListProcessing_14:
   \   0000CA   E5..         MOV     A,?V0 + 1
   \   0000CC   700F         JNZ     ??ZDApp_NwkDescListProcessing_12
   2112                  {
   2113                    continue;
   2114                  }
   2115                }
   2116          
   2117                break;
   2118              }
   \                     ??ZDApp_NwkDescListProcessing_8:
   \   0000CE   05..         INC     ?V0 + 2
   \   0000D0   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_103:
   \   0000D3   E5..         MOV     A,?V0 + 2
   \   0000D5   C3           CLR     C
   \   0000D6   95..         SUBB    A,?V0 + 0
   \   0000D8   5003         JNC     $+5
   \   0000DA   02....       LJMP    ??ZDApp_NwkDescListProcessing_4 & 0xFFFF
   2119          
   2120              if (i < ResultCount)
   \                     ??ZDApp_NwkDescListProcessing_12:
   \   0000DD   E5..         MOV     A,?V0 + 2
   \   0000DF   C3           CLR     C
   \   0000E0   95..         SUBB    A,?V0 + 0
   \   0000E2   4010         JC      ??ZDApp_NwkDescListProcessing_16
   2121              {
   2122               selected = TRUE;
   2123                break;
   2124              }
   2125          
   2126              // break if selected or stack profile pro wasn't found
   2127              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \                     ??ZDApp_NwkDescListProcessing_3:
   \   0000E4   E5..         MOV     A,?V0 + 3
   \   0000E6   600C         JZ      ??ZDApp_NwkDescListProcessing_16
   2128              {
   2129                break;
   2130              }
   2131            }
   \   0000E8   05..         INC     ?V0 + 1
   \   0000EA   E5..         MOV     A,?V0 + 1
   \   0000EC   C3           CLR     C
   \   0000ED   9402         SUBB    A,#0x2
   \   0000EF   5003         JNC     $+5
   \   0000F1   02....       LJMP    ??ZDApp_NwkDescListProcessing_2 & 0xFFFF
   2132          
   2133            if ( i == ResultCount )
   \                     ??ZDApp_NwkDescListProcessing_16:
   \   0000F4   E5..         MOV     A,?V0 + 0
   \   0000F6   65..         XRL     A,?V0 + 2
   \   0000F8   7006         JNZ     ??ZDApp_NwkDescListProcessing_17
   2134            {
   2135              return (NULL);   // couldn't find appropriate PAN to join !
   \   0000FA   7A00         MOV     R2,#0x0
   \   0000FC   7B00         MOV     R3,#0x0
   \   0000FE   8004         SJMP    ??ZDApp_NwkDescListProcessing_18
   2136            }
   2137            else
   2138            {
   2139              return (pNwkDesc);
   \                     ??ZDApp_NwkDescListProcessing_17:
   \   000100   EE           MOV     A,R6
   \   000101   FA           MOV     R2,A
   \   000102   EF           MOV     A,R7
   \   000103   FB           MOV     R3,A
   2140            }
   \                     ??ZDApp_NwkDescListProcessing_18:
   \   000104   02....       LJMP    ?Subroutine4 & 0xFFFF
   2141          }// ZDApp_NwkDescListProcessing()

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   EE           MOV     A,R6
   \   000001   2414         ADD     A,#0x14
   \   000003   12....       LCALL   ?Subroutine37 & 0xFFFF
   \                     ??CrossCallReturnLabel_117:
   \   000006                REQUIRE ??Subroutine53_0
   \   000006                ; // Fall through to label ??Subroutine53_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine53_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FE           MOV     R6,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FF           MOV     R7,A
   \   000005   22           RET
   2142          
   2143          /*********************************************************************
   2144           * @fn          ZDO_NetworkFormationConfirmCB
   2145           *
   2146           * @brief       This function reports the results of the request to
   2147           *              initialize a coordinator in a network.
   2148           *
   2149           * @param       Status - Result of NLME_NetworkFormationRequest()
   2150           *
   2151           * @return      none
   2152           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??Subroutine38_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_64:
   \   000003                REQUIRE ??Subroutine51_0
   \   000003                ; // Fall through to label ??Subroutine51_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2153          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   2154          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2155            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2156          
   2157            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   2158            {
   2159          #if !defined(HAL_MT7620_GPIO_MAP)  && (!(DEVICE_TYPE_ID==13) && !(DEVICE_TYPE_ID==14))
   2160              // LED on shows Coordinator started
   2161              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine33 & 0xFFFF
   2162              // LED off forgets HOLD_AUTO_START
   2163              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   2164          #endif
   2165          #if defined ( ZBIT )
   2166              SIM_SetColor(0xd0ffd0);
   2167          #endif
   2168          
   2169              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_45:
   \   00000F   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   2170              {
   2171                // Began with HOLD_AUTO_START
   2172                devState = DEV_COORD_STARTING;
   \   000011   7408         MOV     A,#0x8
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   2173              }
   2174            }
   2175          #if defined(BLINK_LEDS)
   2176            else
   2177            {
   2178              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2179            }
   2180          #endif
   2181          
   2182            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A02         MOV     R2,#0x2
   \   00001F   02....       LJMP    ?Subroutine0 & 0xFFFF
   2183          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine33:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7904         MOV     R1,#0x4
   \   000004   12....       LCALL   ??HalLedSet?relay
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007                ; Setup parameters for call to function HalLedSet
   \   000007   7A00         MOV     R2,#0x0
   \   000009   7908         MOV     R1,#0x8
   \   00000B   12....       LCALL   ??HalLedSet?relay
   \   00000E   90....       MOV     DPTR,#devState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
   2184          
   2185          /****************************************************************************
   2186           * @fn          ZDApp_beaconIndProcessing
   2187           *
   2188           * @brief       This function processes the incoming beacon indication.
   2189           *
   2190           *              When another task (MT or App) is registered to process
   2191           *              beacon indication themselves, this function will parse the
   2192           *              beacon payload and pass the beacon descriptor to that task
   2193           *              If no other tasks registered, this function will process
   2194           *              the beacon payload and generate the network descriptor link
   2195           *              list.
   2196           *
   2197           * @param
   2198           *
   2199           * @return      none
   2200           *
   2201           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2202          void ZDO_beaconNotifyIndCB( NLME_beaconInd_t *pBeacon )
   \                     ZDO_beaconNotifyIndCB:
   2203          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2204            // Pass the beacon Indication to another task if it registers the callback
   2205            // Otherwise, process the beacon notification here.
   2206            if (zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID] != NULL )
   \   000009   90....       MOV     DPTR,#zdoCBFunc + 6
   \   00000C   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00000F   6006         JZ      ??ZDO_beaconNotifyIndCB_0
   2207            {
   2208              zdoCBFunc[ZDO_BEACON_NOTIFY_IND_CBID]( (void*)pBeacon );
   \   000011                ; Setup parameters for indirect call
   \   000011   12....       LCALL   ?CALL_IND
   \   000014   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2209            }
   2210            else
   2211            {
   2212              networkDesc_t *pNwkDesc;
   2213              networkDesc_t *pLastNwkDesc;
   2214              uint8 found = false;
   2215          
   2216              // Add the network to the Network Descriptor List
   2217              pNwkDesc = NwkDescList;
   \                     ??ZDO_beaconNotifyIndCB_0:
   \   000017   90....       MOV     DPTR,#NwkDescList
   \   00001A   12....       LCALL   ??Subroutine53_0 & 0xFFFF
   2218              pLastNwkDesc = NwkDescList;
   \                     ??CrossCallReturnLabel_99:
   \   00001D   90....       MOV     DPTR,#NwkDescList
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 2,A
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F5..         MOV     ?V0 + 3,A
   \   000027   EA           MOV     A,R2
   \   000028   2404         ADD     A,#0x4
   \   00002A   F8           MOV     R0,A
   \   00002B   EB           MOV     A,R3
   \   00002C   3400         ADDC    A,#0x0
   \   00002E   F9           MOV     R1,A
   \   00002F   EA           MOV     A,R2
   \   000030   2402         ADD     A,#0x2
   \   000032   0A           INC     R2
   \   000033   0A           INC     R2
   \   000034   EB           MOV     A,R3
   \   000035   3400         ADDC    A,#0x0
   \   000037   FB           MOV     R3,A
   \   000038   802D         SJMP    ??CrossCallReturnLabel_104
   2219              while (pNwkDesc)
   2220              {
   2221                if ((pNwkDesc->panId == pBeacon->panID) &&
   2222                    (pNwkDesc->logicalChannel == pBeacon->logicalChannel))
   \                     ??ZDO_beaconNotifyIndCB_2:
   \   00003A   8E82         MOV     DPL,R6
   \   00003C   8F83         MOV     DPH,R7
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   FC           MOV     R4,A
   \   000040   A3           INC     DPTR
   \   000041   E0           MOVX    A,@DPTR
   \   000042   FD           MOV     R5,A
   \   000043   8A82         MOV     DPL,R2
   \   000045   8B83         MOV     DPH,R3
   \   000047   E0           MOVX    A,@DPTR
   \   000048   6C           XRL     A,R4
   \   000049   7003         JNZ     ??ZDO_beaconNotifyIndCB_3
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   6D           XRL     A,R5
   \                     ??ZDO_beaconNotifyIndCB_3:
   \   00004E   7010         JNZ     ??ZDO_beaconNotifyIndCB_4
   \   000050   8E82         MOV     DPL,R6
   \   000052   8F83         MOV     DPH,R7
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   FC           MOV     R4,A
   \   000058   8882         MOV     DPL,R0
   \   00005A   8983         MOV     DPH,R1
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   6C           XRL     A,R4
   \   00005E   6067         JZ      ??ZDO_beaconNotifyIndCB_5
   2223                {
   2224                  found = true;
   2225                  break;
   2226                }
   2227                pLastNwkDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_4:
   \   000060   8E..         MOV     ?V0 + 2,R6
   \   000062   8F..         MOV     ?V0 + 3,R7
   2228                pNwkDesc = pNwkDesc->nextDesc;
   \   000064   12....       LCALL   ?Subroutine20 & 0xFFFF
   2229              }
   \                     ??CrossCallReturnLabel_104:
   \   000067   EE           MOV     A,R6
   \   000068   4F           ORL     A,R7
   \   000069   70CF         JNZ     ??ZDO_beaconNotifyIndCB_2
   2230          
   2231              // If no existing descriptor found, make a new one and add to the list
   2232              if (found == false)
   2233              {
   2234                pNwkDesc = osal_mem_alloc( sizeof(networkDesc_t)  );
   \   00006B                ; Setup parameters for call to function osal_mem_alloc
   \   00006B   7A16         MOV     R2,#0x16
   \   00006D   7B00         MOV     R3,#0x0
   \   00006F   12....       LCALL   ??osal_mem_alloc?relay
   \   000072   8A..         MOV     ?V0 + 4,R2
   \   000074   8B..         MOV     ?V0 + 5,R3
   \   000076   AE..         MOV     R6,?V0 + 4
   \   000078   AF..         MOV     R7,?V0 + 5
   2235                if ( !pNwkDesc )
   \   00007A   EE           MOV     A,R6
   \   00007B   4F           ORL     A,R7
   \   00007C   7003         JNZ     $+5
   \   00007E   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2236                {
   2237                  // Memory alloc failed, discard this beacon
   2238                  return;
   2239                }
   2240          
   2241                // Clear the network descriptor
   2242                osal_memset( pNwkDesc, 0, sizeof(networkDesc_t)  );
   \   000081                ; Setup parameters for call to function osal_memset
   \   000081   7C16         MOV     R4,#0x16
   \   000083   7D00         MOV     R5,#0x0
   \   000085   7900         MOV     R1,#0x0
   \   000087   12....       LCALL   ??osal_memset?relay
   2243          
   2244                // Initialize the descriptor
   2245                pNwkDesc->chosenRouter = INVALID_NODE_ADDR;
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   A3           INC     DPTR
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   A3           INC     DPTR
   \   000093   A3           INC     DPTR
   \   000094   A3           INC     DPTR
   \   000095   74FE         MOV     A,#-0x2
   \   000097   F0           MOVX    @DPTR,A
   \   000098   A3           INC     DPTR
   \   000099   04           INC     A
   \   00009A   F0           MOVX    @DPTR,A
   2246                pNwkDesc->chosenRouterDepth = 0xFF;
   \   00009B   8E82         MOV     DPL,R6
   \   00009D   8F83         MOV     DPH,R7
   \   00009F   A3           INC     DPTR
   \   0000A0   A3           INC     DPTR
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   F0           MOVX    @DPTR,A
   2247          
   2248                // Save new entry into the descriptor list
   2249                if ( !NwkDescList )
   \   0000AA   90....       MOV     DPTR,#NwkDescList
   \   0000AD   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0000B0   7005         JNZ     ??ZDO_beaconNotifyIndCB_6
   2250                {
   2251                  NwkDescList = pNwkDesc;
   \   0000B2   90....       MOV     DPTR,#NwkDescList
   \   0000B5   800B         SJMP    ??CrossCallReturnLabel_114
   2252                }
   2253                else
   2254                {
   2255                  pLastNwkDesc->nextDesc = pNwkDesc;
   \                     ??ZDO_beaconNotifyIndCB_6:
   \   0000B7   E5..         MOV     A,?V0 + 2
   \   0000B9   2414         ADD     A,#0x14
   \   0000BB   F582         MOV     DPL,A
   \   0000BD   E5..         MOV     A,?V0 + 3
   \   0000BF   12....       LCALL   ??Subroutine54_0 & 0xFFFF
   2256                }
   2257              }
   \                     ??CrossCallReturnLabel_114:
   \   0000C2   EE           MOV     A,R6
   \   0000C3   F0           MOVX    @DPTR,A
   \   0000C4   A3           INC     DPTR
   \   0000C5   EF           MOV     A,R7
   \   0000C6   F0           MOVX    @DPTR,A
   2258          
   2259              // Update the descriptor with the incoming beacon
   2260              pNwkDesc->stackProfile   = pBeacon->stackProfile;
   \                     ??ZDO_beaconNotifyIndCB_5:
   \   0000C7   85..82       MOV     DPL,?V0 + 0
   \   0000CA   85..83       MOV     DPH,?V0 + 1
   \   0000CD   A3           INC     DPTR
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   0000D9   A3           INC     DPTR
   \   0000DA   A3           INC     DPTR
   \   0000DB   A3           INC     DPTR
   \   0000DC   F0           MOVX    @DPTR,A
   2261              pNwkDesc->version        = pBeacon->protocolVersion;
   \   0000DD   E5..         MOV     A,?V0 + 0
   \   0000DF   2408         ADD     A,#0x8
   \   0000E1   F8           MOV     R0,A
   \   0000E2   E5..         MOV     A,?V0 + 1
   \   0000E4   3400         ADDC    A,#0x0
   \   0000E6   F9           MOV     R1,A
   \   0000E7   8882         MOV     DPL,R0
   \   0000E9   8983         MOV     DPH,R1
   \   0000EB   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   0000EE   12....       LCALL   ?Subroutine11 & 0xFFFF
   2262              pNwkDesc->logicalChannel = pBeacon->logicalChannel;
   \                     ??CrossCallReturnLabel_2:
   \   0000F1   A3           INC     DPTR
   \   0000F2   A3           INC     DPTR
   \   0000F3   E0           MOVX    A,@DPTR
   \   0000F4   8E82         MOV     DPL,R6
   \   0000F6   8F83         MOV     DPH,R7
   \   0000F8   12....       LCALL   ?Subroutine11 & 0xFFFF
   2263              pNwkDesc->panId          = pBeacon->panID;
   \                     ??CrossCallReturnLabel_3:
   \   0000FB   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_94:
   \   0000FE   8E82         MOV     DPL,R6
   \   000100   8F83         MOV     DPH,R7
   \   000102   12....       LCALL   ??Subroutine58_0 & 0xFFFF
   2264              pNwkDesc->updateId       = pBeacon->updateID;
   \                     ??CrossCallReturnLabel_122:
   \   000105   E5..         MOV     A,?V0 + 0
   \   000107   240C         ADD     A,#0xc
   \   000109   F582         MOV     DPL,A
   \   00010B   E5..         MOV     A,?V0 + 1
   \   00010D   12....       LCALL   ??Subroutine56_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_105:
   \   000110   C0E0         PUSH    A
   \   000112   EE           MOV     A,R6
   \   000113   2413         ADD     A,#0x13
   \   000115   12....       LCALL   ?Subroutine37 & 0xFFFF
   \                     ??CrossCallReturnLabel_116:
   \   000118   D0E0         POP     A
   \   00011A   F0           MOVX    @DPTR,A
   2265          
   2266              // Save the extended PAN ID from the beacon payload only if 1.1 version network
   2267              if ( pBeacon->protocolVersion != ZB_PROT_V1_0 )
   \   00011B   EE           MOV     A,R6
   \   00011C   240B         ADD     A,#0xb
   \   00011E   FA           MOV     R2,A
   \   00011F   EF           MOV     A,R7
   \   000120   3400         ADDC    A,#0x0
   \   000122   FB           MOV     R3,A
   \   000123   8882         MOV     DPL,R0
   \   000125   8983         MOV     DPH,R1
   \   000127   E0           MOVX    A,@DPTR
   \   000128   6401         XRL     A,#0x1
   \   00012A   600F         JZ      ??ZDO_beaconNotifyIndCB_7
   2268              {
   2269                osal_cpyExtAddr( pNwkDesc->extendedPANID, pBeacon->extendedPanID );
   \   00012C                ; Setup parameters for call to function sAddrExtCpy
   \   00012C   E5..         MOV     A,?V0 + 0
   \   00012E   240D         ADD     A,#0xd
   \   000130   FC           MOV     R4,A
   \   000131   E5..         MOV     A,?V0 + 1
   \   000133   3400         ADDC    A,#0x0
   \   000135   FD           MOV     R5,A
   \   000136   12....       LCALL   ??sAddrExtCpy?relay
   \   000139   8009         SJMP    ??ZDO_beaconNotifyIndCB_8
   2270              }
   2271              else
   2272              {
   2273                osal_memset( pNwkDesc->extendedPANID, 0xFF, Z_EXTADDR_LEN );
   \                     ??ZDO_beaconNotifyIndCB_7:
   \   00013B                ; Setup parameters for call to function osal_memset
   \   00013B   7C08         MOV     R4,#0x8
   \   00013D   7D00         MOV     R5,#0x0
   \   00013F   79FF         MOV     R1,#-0x1
   \   000141   12....       LCALL   ??osal_memset?relay
   2274              }
   2275          
   2276              // check if this device is a better choice to join...
   2277              // ...dont bother checking assocPermit flag is doing a rejoin
   2278              if ( ( pBeacon->LQI > gMIN_TREE_LINK_COST ) &&
   2279                  ( ( pBeacon->permitJoining == TRUE ) || ( _tmpRejoinState ) ) )
   \                     ??ZDO_beaconNotifyIndCB_8:
   \   000144   E5..         MOV     A,?V0 + 0
   \   000146   240A         ADD     A,#0xa
   \   000148   F8           MOV     R0,A
   \   000149   E5..         MOV     A,?V0 + 1
   \   00014B   3400         ADDC    A,#0x0
   \   00014D   F9           MOV     R1,A
   \   00014E   8882         MOV     DPL,R0
   \   000150   8983         MOV     DPH,R1
   \   000152   E0           MOVX    A,@DPTR
   \   000153   FA           MOV     R2,A
   \   000154   90....       MOV     DPTR,#gMIN_TREE_LINK_COST
   \   000157   E0           MOVX    A,@DPTR
   \   000158   C3           CLR     C
   \   000159   9A           SUBB    A,R2
   \   00015A   4003         JC      $+5
   \   00015C   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   \   00015F   85..82       MOV     DPL,?V0 + 0
   \   000162   85..83       MOV     DPH,?V0 + 1
   \   000165   A3           INC     DPTR
   \   000166   A3           INC     DPTR
   \   000167   A3           INC     DPTR
   \   000168   A3           INC     DPTR
   \   000169   A3           INC     DPTR
   \   00016A   E0           MOVX    A,@DPTR
   \   00016B   6401         XRL     A,#0x1
   \   00016D   6009         JZ      ??ZDO_beaconNotifyIndCB_9
   \   00016F   90....       MOV     DPTR,#_tmpRejoinState
   \   000172   E0           MOVX    A,@DPTR
   \   000173   7003         JNZ     $+5
   \   000175   02....       LJMP    ??ZDO_beaconNotifyIndCB_1 & 0xFFFF
   2280              {
   2281                uint8 selected = FALSE;
   \                     ??ZDO_beaconNotifyIndCB_9:
   \   000178   7C00         MOV     R4,#0x0
   2282                uint8 capacity = FALSE;
   2283          
   2284                if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   \   00017A   90....       MOV     DPTR,#_NIB + 96
   \   00017D   E0           MOVX    A,@DPTR
   \   00017E   6402         XRL     A,#0x2
   \   000180   7024         JNZ     ??ZDO_beaconNotifyIndCB_10
   \   000182   8E82         MOV     DPL,R6
   \   000184   8F83         MOV     DPH,R7
   \   000186   A3           INC     DPTR
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   A3           INC     DPTR
   \   00018A   A3           INC     DPTR
   \   00018B   A3           INC     DPTR
   \   00018C   A3           INC     DPTR
   \   00018D   A3           INC     DPTR
   \   00018E   A3           INC     DPTR
   \   00018F   E0           MOVX    A,@DPTR
   \   000190   FB           MOV     R3,A
   \   000191   C3           CLR     C
   \   000192   9A           SUBB    A,R2
   \   000193   500D         JNC     ??ZDO_beaconNotifyIndCB_11
   \   000195   12....       LCALL   ?Subroutine34 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000198   12....       LCALL   ??Subroutine56_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_106:
   \   00019B   C3           CLR     C
   \   00019C   9414         SUBB    A,#0x14
   \   00019E   4020         JC      ??ZDO_beaconNotifyIndCB_12
   \   0001A0   801F         SJMP    ??ZDO_beaconNotifyIndCB_13
   \                     ??ZDO_beaconNotifyIndCB_11:
   \   0001A2   EB           MOV     A,R3
   \   0001A3   6A           XRL     A,R2
   \   0001A4   701B         JNZ     ??ZDO_beaconNotifyIndCB_13
   \                     ??ZDO_beaconNotifyIndCB_10:
   \   0001A6   8E82         MOV     DPL,R6
   \   0001A8   8F83         MOV     DPH,R7
   \   0001AA   A3           INC     DPTR
   \   0001AB   A3           INC     DPTR
   \   0001AC   A3           INC     DPTR
   \   0001AD   A3           INC     DPTR
   \   0001AE   A3           INC     DPTR
   \   0001AF   A3           INC     DPTR
   \   0001B0   A3           INC     DPTR
   \   0001B1   A3           INC     DPTR
   \   0001B2   A3           INC     DPTR
   \   0001B3   A3           INC     DPTR
   \   0001B4   E0           MOVX    A,@DPTR
   \   0001B5   FA           MOV     R2,A
   \   0001B6   12....       LCALL   ?Subroutine34 & 0xFFFF
   \                     ??CrossCallReturnLabel_49:
   \   0001B9   12....       LCALL   ??Subroutine56_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_107:
   \   0001BC   C3           CLR     C
   \   0001BD   9A           SUBB    A,R2
   \   0001BE   5001         JNC     ??ZDO_beaconNotifyIndCB_13
   2285                {
   2286                  if ( ((pBeacon->LQI   > pNwkDesc->chosenRouterLinkQuality) &&
   2287                        (pBeacon->depth < MAX_NODE_DEPTH)) ||
   2288                      ((pBeacon->LQI   == pNwkDesc->chosenRouterLinkQuality) &&
   2289                       (pBeacon->depth < pNwkDesc->chosenRouterDepth)) )
   2290                  {
   2291                    selected = TRUE;
   \                     ??ZDO_beaconNotifyIndCB_12:
   \   0001C0   0C           INC     R4
   2292                  }
   2293                }
   2294                else
   2295                {
   2296                  if ( pBeacon->depth < pNwkDesc->chosenRouterDepth )
   2297                  {
   2298                    selected = TRUE;
   2299                  }
   2300                }
   2301          
   2302                if ( ZSTACK_ROUTER_BUILD )
   2303                {
   2304                  capacity = pBeacon->routerCapacity;
   2305                }
   2306                else if ( ZSTACK_END_DEVICE_BUILD )
   2307                {
   2308                  capacity = pBeacon->deviceCapacity;
   2309                }
   2310          
   2311                if ( (capacity) && (selected) )
   \                     ??ZDO_beaconNotifyIndCB_13:
   \   0001C1   E5..         MOV     A,?V0 + 0
   \   0001C3   2406         ADD     A,#0x6
   \   0001C5   FA           MOV     R2,A
   \   0001C6   E5..         MOV     A,?V0 + 1
   \   0001C8   3400         ADDC    A,#0x0
   \   0001CA   FB           MOV     R3,A
   \   0001CB   8A82         MOV     DPL,R2
   \   0001CD   8B83         MOV     DPH,R3
   \   0001CF   E0           MOVX    A,@DPTR
   \   0001D0   6033         JZ      ??ZDO_beaconNotifyIndCB_14
   \   0001D2   EC           MOV     A,R4
   \   0001D3   A2E0         MOV     C,0xE0 /* A   */.0
   \   0001D5   502E         JNC     ??ZDO_beaconNotifyIndCB_14
   2312                {
   2313                  // this is the new chosen router for joining...
   2314                  pNwkDesc->chosenRouter            = pBeacon->sourceAddr;
   \   0001D7   85..82       MOV     DPL,?V0 + 0
   \   0001DA   85..83       MOV     DPH,?V0 + 1
   \   0001DD   E0           MOVX    A,@DPTR
   \   0001DE   FC           MOV     R4,A
   \   0001DF   A3           INC     DPTR
   \   0001E0   E0           MOVX    A,@DPTR
   \   0001E1   FD           MOV     R5,A
   \   0001E2   8E82         MOV     DPL,R6
   \   0001E4   8F83         MOV     DPH,R7
   \   0001E6   A3           INC     DPTR
   \   0001E7   A3           INC     DPTR
   \   0001E8   A3           INC     DPTR
   \   0001E9   A3           INC     DPTR
   \   0001EA   A3           INC     DPTR
   \   0001EB   A3           INC     DPTR
   \   0001EC   A3           INC     DPTR
   \   0001ED   EC           MOV     A,R4
   \   0001EE   F0           MOVX    @DPTR,A
   \   0001EF   A3           INC     DPTR
   \   0001F0   ED           MOV     A,R5
   \   0001F1   F0           MOVX    @DPTR,A
   2315                  pNwkDesc->chosenRouterLinkQuality = pBeacon->LQI;
   \   0001F2   8882         MOV     DPL,R0
   \   0001F4   8983         MOV     DPH,R1
   \   0001F6   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0001F9   F0           MOVX    @DPTR,A
   2316                  pNwkDesc->chosenRouterDepth       = pBeacon->depth;
   \   0001FA   12....       LCALL   ?Subroutine34 & 0xFFFF
   2317                }
   \                     ??CrossCallReturnLabel_50:
   \   0001FD   12....       LCALL   ??Subroutine54_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_115:
   \   000200   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000203   A3           INC     DPTR
   \   000204   F0           MOVX    @DPTR,A
   2318          
   2319                if ( pBeacon->deviceCapacity )
   \                     ??ZDO_beaconNotifyIndCB_14:
   \   000205   85..82       MOV     DPL,?V0 + 0
   \   000208   85..83       MOV     DPH,?V0 + 1
   \   00020B   A3           INC     DPTR
   \   00020C   A3           INC     DPTR
   \   00020D   A3           INC     DPTR
   \   00020E   A3           INC     DPTR
   \   00020F   A3           INC     DPTR
   \   000210   A3           INC     DPTR
   \   000211   A3           INC     DPTR
   \   000212   E0           MOVX    A,@DPTR
   \   000213   600B         JZ      ??ZDO_beaconNotifyIndCB_15
   2320                  pNwkDesc->deviceCapacity = 1;
   \   000215   8E82         MOV     DPL,R6
   \   000217   8F83         MOV     DPH,R7
   \   000219   A3           INC     DPTR
   \   00021A   A3           INC     DPTR
   \   00021B   A3           INC     DPTR
   \   00021C   A3           INC     DPTR
   \   00021D   7401         MOV     A,#0x1
   \   00021F   F0           MOVX    @DPTR,A
   2321          
   2322                if ( pBeacon->routerCapacity )
   \                     ??ZDO_beaconNotifyIndCB_15:
   \   000220   8A82         MOV     DPL,R2
   \   000222   8B83         MOV     DPH,R3
   \   000224   E0           MOVX    A,@DPTR
   \   000225   600A         JZ      ??ZDO_beaconNotifyIndCB_1
   2323                  pNwkDesc->routerCapacity = 1;
   \   000227   8E82         MOV     DPL,R6
   \   000229   8F83         MOV     DPH,R7
   \   00022B   A3           INC     DPTR
   \   00022C   A3           INC     DPTR
   \   00022D   A3           INC     DPTR
   \   00022E   7401         MOV     A,#0x1
   \   000230   F0           MOVX    @DPTR,A
   2324              }
   2325            }
   \                     ??ZDO_beaconNotifyIndCB_1:
   \   000231                REQUIRE ?Subroutine4
   \   000231                ; // Fall through to label ?Subroutine4
   2326          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine34:
   \   000000   E5..         MOV     A,?V0 + 0
   \   000002   240B         ADD     A,#0xb
   \   000004   F582         MOV     DPL,A
   \   000006   E5..         MOV     A,?V0 + 1
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine26:
   \   000000   12....       LCALL   ?Subroutine36 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine36:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   A3           INC     DPTR
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   12....       LCALL   ?Subroutine36 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   A3           INC     DPTR
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   A3           INC     DPTR
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   A3           INC     DPTR
   \   000001   A3           INC     DPTR
   \   000002   F0           MOVX    @DPTR,A
   \   000003   85..82       MOV     DPL,?V0 + 0
   \   000006   85..83       MOV     DPH,?V0 + 1
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL   ?Subroutine35 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000003   8882         MOV     DPL,R0
   \   000005   8983         MOV     DPH,R1
   \   000007   E582         MOV     A,DPL
   \   000009   4583         ORL     A,DPH
   \   00000B   22           RET
   2327          
   2328          /*********************************************************************
   2329           * @fn          ZDO_StartRouterConfirmCB
   2330           *
   2331           * @brief       This function reports the results of the request to
   2332           *              start functioning as a router in a network.
   2333           *
   2334           * @param       Status - Result of NLME_StartRouterRequest()
   2335           *
   2336           * @return      none
   2337           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2338          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   2339          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   2340            nwkStatus = (byte)Status;
   \   000006   90....       MOV     DPTR,#nwkStatus
   \   000009   F0           MOVX    @DPTR,A
   2341          
   2342            if ( Status == ZSUCCESS )
   \   00000A   700A         JNZ     ??ZDO_StartRouterConfirmCB_0
   2343            {
   2344              // LED on shows Router started
   2345              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000C                ; Setup parameters for call to function HalLedSet
   \   00000C   12....       LCALL   ?Subroutine33 & 0xFFFF
   2346              // LED off forgets HOLD_AUTO_START
   2347              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2348              if ( devState == DEV_HOLD )
   \                     ??CrossCallReturnLabel_46:
   \   00000F   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   2349              {
   2350                // Began with HOLD_AUTO_START
   2351                devState = DEV_END_DEVICE;
   \   000011   7406         MOV     A,#0x6
   \   000013   F0           MOVX    @DPTR,A
   \   000014   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2352              }
   2353            }
   2354          #if defined(BLINK_LEDS)
   2355            else
   2356            {
   2357              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000016                ; Setup parameters for call to function HalLedSet
   \   000016   7A04         MOV     R2,#0x4
   \   000018   7904         MOV     R1,#0x4
   \   00001A   12....       LCALL   ??HalLedSet?relay
   2358            }
   2359          #endif
   2360          
   2361            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00001D                ; Setup parameters for call to function osal_set_event
   \   00001D   7A20         MOV     R2,#0x20
   \   00001F   02....       LJMP    ?Subroutine0 & 0xFFFF
   2362          }
   2363          
   2364          /*********************************************************************
   2365           * @fn          ZDO_JoinConfirmCB
   2366           *
   2367           * @brief       This function allows the next hight layer to be notified
   2368           *              of the results of its request to join itself or another
   2369           *              device to a network.
   2370           *
   2371           * @param       Status - Result of NLME_JoinRequest()
   2372           *
   2373           * @return      none
   2374           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2375          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2376          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   2377            (void)PanId;  // remove if this parameter is used.
   2378          
   2379            nwkStatus = (byte)Status;
   \   00000C   90....       MOV     DPTR,#nwkStatus
   \   00000F   F0           MOVX    @DPTR,A
   2380          
   2381            if ( Status == ZSUCCESS )
   \   000010   7013         JNZ     ??ZDO_JoinConfirmCB_0
   2382            {
   2383              // LED on shows device joined
   2384              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   12....       LCALL   ?Subroutine33 & 0xFFFF
   2385              // LED off forgets HOLD_AUTO_START
   2386              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   2387              if ( (devState == DEV_HOLD) )
   \                     ??CrossCallReturnLabel_47:
   \   000015   7003         JNZ     ??ZDO_JoinConfirmCB_1
   2388              {
   2389                // Began with HOLD_AUTO_START
   2390                devState = DEV_NWK_JOINING;
   \   000017   7403         MOV     A,#0x3
   \   000019   F0           MOVX    @DPTR,A
   2391              }
   2392          
   2393              if ( !ZG_SECURE_ENABLED )
   \                     ??ZDO_JoinConfirmCB_1:
   \   00001A   90....       MOV     DPTR,#zgSecurityMode
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   700C         JNZ     ??ZDO_JoinConfirmCB_2
   2394              {
   2395                // Notify to save info into NV
   2396                ZDApp_NVUpdate();
   \   000020                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000020   12....       LCALL   ??ZDApp_NVUpdate?relay
   \   000023   8007         SJMP    ??ZDO_JoinConfirmCB_2
   2397              }
   2398            }
   2399            else
   2400            {
   2401          #if defined(BLINK_LEDS)
   2402              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000025                ; Setup parameters for call to function HalLedSet
   \   000025   7A04         MOV     R2,#0x4
   \   000027   7904         MOV     R1,#0x4
   \   000029   12....       LCALL   ??HalLedSet?relay
   2403          #endif
   2404            }
   2405          
   2406            // Pass the join confirm to higher layer if callback registered
   2407            if (zdoCBFunc[ZDO_JOIN_CNF_CBID] != NULL )
   \                     ??ZDO_JoinConfirmCB_2:
   \   00002C   90....       MOV     DPTR,#zdoCBFunc + 8
   \   00002F   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000032   6035         JZ      ??ZDO_JoinConfirmCB_3
   2408            {
   2409              zdoJoinCnf_t joinCnf;
   2410          
   2411              joinCnf.status = Status;
   \   000034   EE           MOV     A,R6
   \   000035   85..82       MOV     DPL,?XSP + 0
   \   000038   85..83       MOV     DPH,?XSP + 1
   \   00003B   F0           MOVX    @DPTR,A
   2412              joinCnf.deviceAddr = _NIB.nwkDevAddress;
   \   00003C   90....       MOV     DPTR,#_NIB + 20
   \   00003F   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_95:
   \   000042   7401         MOV     A,#0x1
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   12....       LCALL   ??Subroutine58_0 & 0xFFFF
   2413              joinCnf.parentAddr = _NIB.nwkCoordAddress;
   \                     ??CrossCallReturnLabel_123:
   \   00004A   90....       MOV     DPTR,#_NIB + 23
   \   00004D   12....       LCALL   ??Subroutine52_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_96:
   \   000050   7403         MOV     A,#0x3
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   12....       LCALL   ??Subroutine58_0 & 0xFFFF
   2414          
   2415              zdoCBFunc[ZDO_JOIN_CNF_CBID]( (void*)&joinCnf );
   \                     ??CrossCallReturnLabel_124:
   \   000058                ; Setup parameters for indirect call
   \   000058   85..82       MOV     DPL,?XSP + 0
   \   00005B   85..83       MOV     DPH,?XSP + 1
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   8882         MOV     DPL,R0
   \   000064   8983         MOV     DPH,R1
   \   000066   12....       LCALL   ?CALL_IND
   2416            }
   2417          
   2418            // Notify ZDApp
   2419            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_3:
   \   000069                ; Setup parameters for call to function ZDApp_SendMsg
   \   000069   7C00         MOV     R4,#0x0
   \   00006B   7D00         MOV     R5,#0x0
   \   00006D   7B02         MOV     R3,#0x2
   \   00006F   7A02         MOV     R2,#0x2
   \   000071   12....       LCALL   ?Subroutine22 & 0xFFFF
   2420          
   2421          }
   \                     ??CrossCallReturnLabel_25:
   \   000074   02....       LJMP    ?Subroutine5 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7405         MOV     A,#0x5
   \   000002                REQUIRE ??Subroutine57_0
   \   000002                ; // Fall through to label ??Subroutine57_0
   2422          
   2423          /*********************************************************************
   2424           * @fn          ZDO_AddrChangeIndicationCB
   2425           *
   2426           * @brief       This function notifies the application that this
   2427           *              device's address has changed.  Could happen in
   2428           *              a network with stochastic addressing (PRO).
   2429           *
   2430           * @param       newAddr - the new address
   2431           *
   2432           * @return      none
   2433           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2434          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2435          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2436            ZDO_AddrChangeInd_t *pZDOAddrChangeMsg;
   2437            epList_t *pItem = epList;
   \   000009   90....       MOV     DPTR,#epList
   \   00000C   12....       LCALL   ??Subroutine53_0 & 0xFFFF
   2438          
   2439            // Notify to save info into NV
   2440            ZDApp_NVUpdate();
   \                     ??CrossCallReturnLabel_100:
   \   00000F                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00000F   12....       LCALL   ??ZDApp_NVUpdate?relay
   2441          
   2442            // Notify the applications
   2443            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000012                ; Setup parameters for call to function osal_set_event
   \   000012   12....       LCALL   ?Subroutine15 & 0xFFFF
   2444          
   2445            while (pItem != NULL)
   \                     ??CrossCallReturnLabel_62:
   \   000015   EE           MOV     A,R6
   \   000016   4F           ORL     A,R7
   \   000017   6043         JZ      ??ZDO_AddrChangeIndicationCB_0
   2446            {
   2447              if (pItem->epDesc->endPoint != ZDO_EP)
   \                     ??ZDO_AddrChangeIndicationCB_1:
   \   000019   EE           MOV     A,R6
   \   00001A   2402         ADD     A,#0x2
   \   00001C   F8           MOV     R0,A
   \   00001D   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000020   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_71:
   \   000023   602C         JZ      ??ZDO_AddrChangeIndicationCB_2
   2448              {
   2449                pZDOAddrChangeMsg = (ZDO_AddrChangeInd_t *)osal_msg_allocate( sizeof( ZDO_AddrChangeInd_t ) );
   \   000025                ; Setup parameters for call to function osal_msg_allocate
   \   000025   7A04         MOV     R2,#0x4
   \   000027   7B00         MOV     R3,#0x0
   \   000029   12....       LCALL   ??osal_msg_allocate?relay
   2450                if (pZDOAddrChangeMsg != NULL)
   \   00002C   EA           MOV     A,R2
   \   00002D   4B           ORL     A,R3
   \   00002E   6021         JZ      ??ZDO_AddrChangeIndicationCB_2
   2451                {
   2452                  pZDOAddrChangeMsg->hdr.event = ZDO_ADDR_CHANGE_IND;
   \   000030   8A82         MOV     DPL,R2
   \   000032   8B83         MOV     DPH,R3
   \   000034   74D6         MOV     A,#-0x2a
   \   000036   F0           MOVX    @DPTR,A
   2453                  pZDOAddrChangeMsg->shortAddr = newAddr;
   \   000037   A3           INC     DPTR
   \   000038   A3           INC     DPTR
   \   000039   E5..         MOV     A,?V0 + 0
   \   00003B   F0           MOVX    @DPTR,A
   \   00003C   A3           INC     DPTR
   \   00003D   E5..         MOV     A,?V0 + 1
   \   00003F   F0           MOVX    @DPTR,A
   2454                  osal_msg_send( *(pItem->epDesc->task_id), (uint8 *)pZDOAddrChangeMsg );
   \   000040                ; Setup parameters for call to function osal_msg_send
   \   000040   85..82       MOV     DPL,?V0 + 2
   \   000043   85..83       MOV     DPH,?V0 + 3
   \   000046   12....       LCALL   ?Subroutine24 & 0xFFFF
   2455                }
   2456              }
   \                     ??CrossCallReturnLabel_89:
   \   000049   A3           INC     DPTR
   \   00004A   12....       LCALL   ??Subroutine40_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_69:
   \   00004D   F9           MOV     R1,A
   \   00004E   12....       LCALL   ??osal_msg_send?relay
   2457              pItem = pItem->nextDesc;
   \                     ??ZDO_AddrChangeIndicationCB_2:
   \   000051   8E82         MOV     DPL,R6
   \   000053   8F83         MOV     DPH,R7
   \   000055   12....       LCALL   ??Subroutine53_0 & 0xFFFF
   2458            }
   \                     ??CrossCallReturnLabel_101:
   \   000058   EE           MOV     A,R6
   \   000059   4F           ORL     A,R7
   \   00005A   70BD         JNZ     ??ZDO_AddrChangeIndicationCB_1
   2459          
   2460            // Send out a device announce
   2461            ZDApp_AnnounceNewAddress();
   \                     ??ZDO_AddrChangeIndicationCB_0:
   \   00005C                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00005C   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2462          }
   \   00005F   02....       LJMP    ?Subroutine4 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine29:
   \   000000   EF           MOV     A,R7
   \   000001   3400         ADDC    A,#0x0
   \   000003   F9           MOV     R1,A
   \   000004   88..         MOV     ?V0 + 2,R0
   \   000006   89..         MOV     ?V0 + 3,R1
   \   000008   8882         MOV     DPL,R0
   \   00000A   22           RET
   2463          
   2464          /*********************************************************************
   2465           * @fn          ZDO_JoinIndicationCB
   2466           *
   2467           * @brief       This function allows the next higher layer of a
   2468           *              coordinator to be notified of a remote join request.
   2469           *
   2470           * @param       ShortAddress - 16-bit address
   2471           * @param       ExtendedAddress - IEEE (64-bit) address
   2472           * @param       CapabilityFlags - Association Capability Flags
   2473           * @param       type - of joining -
   2474           *                          NWK_ASSOC_JOIN
   2475           *                          NWK_ASSOC_REJOIN_UNSECURE
   2476           *                          NWK_ASSOC_REJOIN_SECURE
   2477           *
   2478           * @return      ZStatus_t
   2479           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2480          ZStatus_t ZDO_JoinIndicationCB(uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2481                                          uint8 CapabilityFlags, uint8 type)
   2482          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   7409         MOV     A,#0x9
   \   000007   12....       LCALL   ?XSTACK_DISP0_8
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   FE           MOV     R6,A
   2483            (void)ShortAddress;
   2484            (void)ExtendedAddress;
   2485          #if ZDO_NV_SAVE_RFDs
   2486            (void)CapabilityFlags;
   2487          
   2488          #else  // if !ZDO_NV_SAVE_RFDs
   2489            if (CapabilityFlags & CAPINFO_DEVICETYPE_FFD)
   2490          #endif
   2491            {
   2492              ZDApp_NVUpdate();  // Notify to save info into NV.
   \   00000C                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00000C   12....       LCALL   ??ZDApp_NVUpdate?relay
   2493            }
   2494          
   2495            if (ZG_SECURE_ENABLED)  // Send notification to TC of new device.
   \   00000F   90....       MOV     DPTR,#zgSecurityMode
   \   000012   E0           MOVX    A,@DPTR
   \   000013   600F         JZ      ??CrossCallReturnLabel_80
   2496            {
   2497              if (type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE)
   \   000015   EE           MOV     A,R6
   \   000016   6005         JZ      ??ZDO_JoinIndicationCB_0
   \   000018   7401         MOV     A,#0x1
   \   00001A   6E           XRL     A,R6
   \   00001B   7007         JNZ     ??CrossCallReturnLabel_80
   2498              {
   2499                osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   \                     ??ZDO_JoinIndicationCB_0:
   \   00001D                ; Setup parameters for call to function osal_start_timerEx
   \   00001D   7C58         MOV     R4,#0x58
   \   00001F   7D02         MOV     R5,#0x2
   \   000021   12....       LCALL   ?Subroutine16 & 0xFFFF
   2500              }
   2501            }
   2502          
   2503            return ZSuccess;
   \                     ??CrossCallReturnLabel_80:
   \   000024   7900         MOV     R1,#0x0
   \   000026   02....       LJMP    ??Subroutine51_0 & 0xFFFF
   2504          }
   2505          
   2506          /*********************************************************************
   2507           * @fn          ZDO_ConcentratorIndicationCB
   2508           *
   2509           * @brief       This function allows the next higher layer of a
   2510           *              device to be notified of existence of the concentrator.
   2511           *
   2512           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2513           * @param       extAddr - pointer to extended Address
   2514           *                        NULL if not available
   2515           * @param       pktCost - PktCost from RREQ
   2516           *
   2517           * @return      void
   2518           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2519          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr, uint8 *extAddr, uint8 pktCost )
   \                     ZDO_ConcentratorIndicationCB:
   2520          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2521            zdoConcentratorInd_t conInd;
   2522          
   2523            conInd.nwkAddr = nwkAddr;
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
   2524            conInd.extAddr = extAddr;
   \                     ??CrossCallReturnLabel_127:
   \   00000D   7402         MOV     A,#0x2
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   EC           MOV     A,R4
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   ED           MOV     A,R5
   \   000016   F0           MOVX    @DPTR,A
   2525            conInd.pktCost = pktCost;
   \   000017   7404         MOV     A,#0x4
   \   000019   12....       LCALL   ?XSTACK_DISP0_8
   \   00001C   E9           MOV     A,R1
   \   00001D   F0           MOVX    @DPTR,A
   2526          
   2527            if( zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID] != NULL )
   \   00001E   90....       MOV     DPTR,#zdoCBFunc + 2
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000024   6011         JZ      ??ZDO_ConcentratorIndicationCB_0
   2528            {
   2529              zdoCBFunc[ZDO_CONCENTRATOR_IND_CBID]( (void*)&conInd );
   \   000026                ; Setup parameters for indirect call
   \   000026   85..82       MOV     DPL,?XSP + 0
   \   000029   85..83       MOV     DPH,?XSP + 1
   \   00002C   AA82         MOV     R2,DPL
   \   00002E   AB83         MOV     R3,DPH
   \   000030   8882         MOV     DPL,R0
   \   000032   8983         MOV     DPH,R1
   \   000034   12....       LCALL   ?CALL_IND
   2530            }
   2531          }
   \                     ??ZDO_ConcentratorIndicationCB_0:
   \   000037   02....       LJMP    ?Subroutine5 & 0xFFFF
   2532          
   2533          /*********************************************************************
   2534           * @fn          ZDO_LeaveCnf
   2535           *
   2536           * @brief       This function allows the next higher layer to be
   2537           *              notified of the results of its request for this or
   2538           *              a child device to leave the network.
   2539           *
   2540           * @param       cnf - NLME_LeaveCnf_t
   2541           *
   2542           * @return      none
   2543           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   8E82         MOV     DPL,R6
   \   000002   8F83         MOV     DPH,R7
   \   000004                REQUIRE ??Subroutine52_0
   \   000004                ; // Fall through to label ??Subroutine52_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2544          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2545          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2546            // Check for this device
   2547            if ( osal_ExtAddrEqual( cnf->extAddr,
   2548                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   7022         JNZ     ??ZDO_LeaveCnf_0
   2549            {
   2550              // Pass the leave confirm to higher layer if callback registered
   2551              if ( ( zdoCBFunc[ZDO_LEAVE_CNF_CBID] == NULL ) ||
   2552                   ( (*zdoCBFunc[ZDO_LEAVE_CNF_CBID])( cnf ) == NULL ) )
   \   000026   90....       MOV     DPTR,#zdoCBFunc + 10
   \   000029   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   00002C   600E         JZ      ??ZDO_LeaveCnf_1
   \   00002E                ; Setup parameters for indirect call
   \   00002E   EE           MOV     A,R6
   \   00002F   FA           MOV     R2,A
   \   000030   EF           MOV     A,R7
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ?CALL_IND
   \   000035   8B..         MOV     ?V0 + 1,R3
   \   000037   EA           MOV     A,R2
   \   000038   45..         ORL     A,?V0 + 1
   \   00003A   7026         JNZ     ??ZDO_LeaveCnf_2
   2553              {
   2554                // Prepare to leave with reset
   2555                ZDApp_LeaveReset( cnf->rejoin );
   \                     ??ZDO_LeaveCnf_1:
   \   00003C                ; Setup parameters for call to function ZDApp_LeaveReset
   \   00003C   EE           MOV     A,R6
   \   00003D   240B         ADD     A,#0xb
   \   00003F   12....       LCALL   ??Subroutine55_0 & 0xFFFF
   2556              }
   2557            }
   \                     ??CrossCallReturnLabel_108:
   \   000042   F9           MOV     R1,A
   \   000043   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000046   801A         SJMP    ??ZDO_LeaveCnf_2
   2558            else if ( ZSTACK_ROUTER_BUILD )
   2559            {
   2560              // Remove device address(optionally descendents) from data
   2561              ZDApp_LeaveUpdate( cnf->dstAddr,
   2562                                 cnf->extAddr,
   2563                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000048                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000048   8E82         MOV     DPL,R6
   \   00004A   8F83         MOV     DPH,R7
   \   00004C   A3           INC     DPTR
   \   00004D   A3           INC     DPTR
   \   00004E   A3           INC     DPTR
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   AC..         MOV     R4,?V0 + 0
   \   00005A   AD..         MOV     R5,?V0 + 1
   \   00005C   12....       LCALL   ?Subroutine14 & 0xFFFF
   2564            }
   \                     ??CrossCallReturnLabel_97:
   \   00005F   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2565          }
   \                     ??ZDO_LeaveCnf_2:
   \   000062   02....       LJMP    ??Subroutine50_0 & 0xFFFF
   2566          
   2567          /*********************************************************************
   2568           * @fn          ZDO_LeaveInd
   2569           *
   2570           * @brief       This function allows the next higher layer of a
   2571           *              device to be notified of a remote leave request or
   2572           *              indication.
   2573           *
   2574           * @param       ind - NLME_LeaveInd_t
   2575           *
   2576           * @return      none
   2577           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2578          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2579          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2580            uint8 leave;
   2581          
   2582          
   2583            // Parent is requesting the leave - NWK layer filters out illegal
   2584            // requests
   2585            if ( ind->request == TRUE )
   \   00000E   EE           MOV     A,R6
   \   00000F   240B         ADD     A,#0xb
   \   000011   F8           MOV     R0,A
   \   000012   EF           MOV     A,R7
   \   000013   3400         ADDC    A,#0x0
   \   000015   F9           MOV     R1,A
   \   000016   88..         MOV     ?V0 + 0,R0
   \   000018   89..         MOV     ?V0 + 1,R1
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6401         XRL     A,#0x1
   \   00002B   7036         JNZ     ??ZDO_LeaveInd_0
   2586            {
   2587              // Notify network of leave
   2588              if ( ZSTACK_ROUTER_BUILD )
   2589              {
   2590                NLME_LeaveRsp_t rsp;
   2591                rsp.rejoin         = ind->rejoin;
   \   00002D   EE           MOV     A,R6
   \   00002E   240C         ADD     A,#0xc
   \   000030   08           INC     R0
   \   000031   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000034   F583         MOV     DPH,A
   \   000036   E0           MOVX    A,@DPTR
   \   000037   C0E0         PUSH    A
   \   000039   7401         MOV     A,#0x1
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   D0E0         POP     A
   \   000040   F0           MOVX    @DPTR,A
   2592                rsp.removeChildren = ind->removeChildren;
   \   000041   85..82       MOV     DPL,?V0 + 0
   \   000044   85..83       MOV     DPH,?V0 + 1
   \   000047   E0           MOVX    A,@DPTR
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   F0           MOVX    @DPTR,A
   2593                NLME_LeaveRsp( &rsp );
   \   00004F                ; Setup parameters for call to function NLME_LeaveRsp
   \   00004F   AA82         MOV     R2,DPL
   \   000051   AB83         MOV     R3,DPH
   \   000053   12....       LCALL   ??NLME_LeaveRsp?relay
   2594              }
   2595          
   2596              // Prepare to leave with reset
   2597              ZDApp_LeaveReset( ind->rejoin );
   \   000056                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000056   85..82       MOV     DPL,?V0 + 2
   \   000059   85..83       MOV     DPH,?V0 + 3
   \                     ??ZDO_LeaveInd_1:
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000061   8036         SJMP    ??ZDO_LeaveInd_2
   2598            }
   2599            else
   2600            {
   2601              leave = FALSE;
   2602          
   2603              // Check if this device needs to leave as a child or descendent
   2604              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \                     ??ZDO_LeaveInd_0:
   \   000063                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   000063   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   000066   8A..         MOV     ?V0 + 2,R2
   \   000068   8B..         MOV     ?V0 + 3,R3
   \   00006A   85..82       MOV     DPL,?V0 + 0
   \   00006D   85..83       MOV     DPH,?V0 + 1
   \   000070   E0           MOVX    A,@DPTR
   \   000071   F9           MOV     R1,A
   \   000072   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_98:
   \   000075   E5..         MOV     A,?V0 + 2
   \   000077   6A           XRL     A,R2
   \   000078   7003         JNZ     ??ZDO_LeaveInd_3
   \   00007A   E5..         MOV     A,?V0 + 3
   \   00007C   6B           XRL     A,R3
   \                     ??ZDO_LeaveInd_3:
   \   00007D   700F         JNZ     ??ZDO_LeaveInd_4
   2605              {
   2606                if ( ( ind->removeChildren == TRUE               ) ||
   2607                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2608                       NODETYPE_DEVICE                           )    )
   \   00007F   7401         MOV     A,#0x1
   \   000081   69           XRL     A,R1
   \   000082   6005         JZ      ??ZDO_LeaveInd_5
   \   000084   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000087   7005         JNZ     ??ZDO_LeaveInd_4
   2609                {
   2610                  leave = TRUE;
   2611                }
   2612              }
   2613              else if ( ind->removeChildren == TRUE )
   2614              {
   2615                // Check NWK address allocation algorithm
   2616                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2617              }
   2618          
   2619              if ( leave == TRUE )
   2620              {
   2621                // Prepare to leave with reset
   2622                ZDApp_LeaveReset( ind->rejoin );
   \                     ??ZDO_LeaveInd_5:
   \   000089                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000089   12....       LCALL   ?Subroutine32 & 0xFFFF
   2623              }
   \                     ??CrossCallReturnLabel_44:
   \   00008C   80CE         SJMP    ??ZDO_LeaveInd_1
   2624              else
   2625              {
   2626                // Remove device address(optionally descendents) from data
   2627                ZDApp_LeaveUpdate( ind->srcAddr,
   2628                                   ind->extAddr,
   2629                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_4:
   \   00008E                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   00008E   EE           MOV     A,R6
   \   00008F   2402         ADD     A,#0x2
   \   000091   FC           MOV     R4,A
   \   000092   EF           MOV     A,R7
   \   000093   3400         ADDC    A,#0x0
   \   000095   FD           MOV     R5,A
   \   000096   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2630              }
   2631            }
   2632          
   2633            // Pass the leave indication to higher layer if callback registered.
   2634            if (zdoCBFunc[ZDO_LEAVE_IND_CBID] != NULL)
   \                     ??ZDO_LeaveInd_2:
   \   000099   90....       MOV     DPTR,#zdoCBFunc + 12
   \   00009C   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   00009F   6007         JZ      ??ZDO_LeaveInd_6
   2635            {
   2636              (void)zdoCBFunc[ZDO_LEAVE_IND_CBID](ind);
   \   0000A1                ; Setup parameters for indirect call
   \   0000A1   EE           MOV     A,R6
   \   0000A2   FA           MOV     R2,A
   \   0000A3   EF           MOV     A,R7
   \   0000A4   FB           MOV     R3,A
   \   0000A5   12....       LCALL   ?CALL_IND
   2637            }
   2638          }
   \                     ??ZDO_LeaveInd_6:
   \   0000A8   02....       LJMP    ?Subroutine1 & 0xFFFF
   2639          
   2640          /*********************************************************************
   2641           * @fn          ZDO_SyncIndicationCB
   2642           *
   2643           * @brief       This function allows the next higher layer of a
   2644           *              coordinator to be notified of a loss of synchronization
   2645           *                          with the parent/child device.
   2646           *
   2647           * @param       type: 0 - child; 1 - parent
   2648           *
   2649           *
   2650           * @return      none
   2651           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2652          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2653          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2654            (void)shortAddr;  // Remove this line if this parameter is used.
   2655          
   2656            if ( ZSTACK_END_DEVICE_BUILD
   2657              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityFlags & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000007   90....       MOV     DPTR,#_NIB + 14
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   4013         JC      ??CrossCallReturnLabel_26
   2658            {
   2659              if ( type == 1 )
   \   00000F   7401         MOV     A,#0x1
   \   000011   6E           XRL     A,R6
   \   000012   700E         JNZ     ??CrossCallReturnLabel_26
   2660              {
   2661                // We lost contact with our parent.  Clear the neighbor Table.
   2662                nwkNeighborInitTable();
   \   000014                ; Setup parameters for call to function nwkNeighborInitTable
   \   000014   12....       LCALL   ??nwkNeighborInitTable?relay
   2663          
   2664                // Start the rejoin process.
   2665                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000017                ; Setup parameters for call to function ZDApp_SendMsg
   \   000017   7C00         MOV     R4,#0x0
   \   000019   7D00         MOV     R5,#0x0
   \   00001B   7B02         MOV     R3,#0x2
   \   00001D   7A03         MOV     R2,#0x3
   \   00001F   12....       LCALL   ?Subroutine22 & 0xFFFF
   2666              }
   2667            }
   2668          }
   \                     ??CrossCallReturnLabel_26:
   \   000022   02....       LJMP    ??Subroutine51_0 & 0xFFFF
   2669          
   2670          /*********************************************************************
   2671           * @fn          ZDO_ManytoOneFailureIndicationCB
   2672           *
   2673           * @brief       This function allows the next higher layer of a
   2674           *              concentrator to be notified of a many-to-one route
   2675           *              failure.
   2676           *
   2677           * @param       none
   2678           *
   2679           *
   2680           * @return      none
   2681           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2682          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2683          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2684            // By default, the concentrator automatically redo many-to-one route
   2685            // discovery to update all many-to-one routes in the network
   2686            // If you want anything processing other than the default,
   2687            // please replace the following code.
   2688          
   2689            RTG_MTORouteReq();
   \   000004                ; Setup parameters for call to function RTG_MTORouteReq
   \   000004   12....       LCALL   ??RTG_MTORouteReq?relay
   2690          }
   \   000007   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   2691          
   2692          /*********************************************************************
   2693           * @fn          ZDO_PollConfirmCB
   2694           *
   2695           * @brief       This function allows the next higher layer to be
   2696           *              notified of a Poll Confirm.
   2697           *
   2698           * @param       none
   2699           *
   2700           * @return      none
   2701           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2702          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2703          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2704            (void)status;  // Remove this line if this parameter is used.
   2705            return;
   \   000000   02....       LJMP    ?BRET
   2706          }
   2707          
   2708          /******************************************************************************
   2709           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2710           *
   2711           * @brief       Stub routine implemented by NHLE. NHLE should call
   2712           *              <AddrMgrWriteNV> when appropriate.
   2713           *
   2714           * @param       none
   2715           *
   2716           * @return      none
   2717           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2718          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2719          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2720          #if defined ( NV_RESTORE )
   2721            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   12....       LCALL   ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   000008   7003         JNZ     ??AddrMgrWriteNVRequest_0
   2722            {
   2723              // Trigger to save info into NV
   2724              ZDApp_NVUpdate();
   \   00000A                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00000A   12....       LCALL   ??ZDApp_NVUpdate?relay
   2725            }
   2726          #endif
   2727          }
   \                     ??AddrMgrWriteNVRequest_0:
   \   00000D   02....       LJMP    ??Subroutine50_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   7A00         MOV     R2,#0x0
   \   000002   7B02         MOV     R3,#0x2
   \   000004   90....       MOV     DPTR,#ZDAppTaskID
   \   000007   E0           MOVX    A,@DPTR
   \   000008   F9           MOV     R1,A
   \   000009   12....       LCALL   ??osal_get_timeoutEx?relay
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EA           MOV     A,R2
   \   00000F   45..         ORL     A,?V0 + 1
   \   000011   22           RET
   2728          
   2729          /*********************************************************************
   2730           * Call Back Functions from Security  - API
   2731           */
   2732          
   2733           /*********************************************************************
   2734           * @fn          ZDO_UpdateDeviceIndication
   2735           *
   2736           * @brief       This function notifies the "Trust Center" of a
   2737           *              network when a device joins or leaves the network.
   2738           *
   2739           * @param       extAddr - pointer to 64 bit address of new device
   2740           * @param       status  - 0 if a new device joined securely
   2741           *                      - 1 if a new device joined un-securely
   2742           *                      - 2 if a device left the network
   2743           *
   2744           * @return      true if newly joined device should be allowed to
   2745           *                                              remain on network
   2746           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2747          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2748          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2749            // can implement a network access policy based on the
   2750            // IEEE address of newly joining devices...
   2751            (void)extAddr;
   2752            (void)status;
   2753          
   2754            return ZSuccess;
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2755          }
   2756          
   2757          /*********************************************************************
   2758           * @fn          ZDApp_InMsgCB
   2759           *
   2760           * @brief       This function is called to pass up any message that is
   2761           *              not yet supported.  This allows for the developer to
   2762           *              support features themselves..
   2763           *
   2764           * @return      none
   2765           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2766          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2767          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2768            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   12....       LCALL   ??Subroutine55_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_109:
   \   00000F   F8           MOV     R0,A
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   F9           MOV     R1,A
   \   000013   5480         ANL     A,#0x80
   \   000015   7045         JNZ     ??ZDApp_InMsgCB_0
   2769            {
   2770              // Handle the response message
   2771            }
   2772            else
   2773            {
   2774              // Handle the request message by sending a generic "not supported".
   2775              // Device Announce doesn't have a response.
   2776              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000017   EE           MOV     A,R6
   \   000018   240B         ADD     A,#0xb
   \   00001A   12....       LCALL   ??Subroutine55_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_110:
   \   00001D   703D         JNZ     ??ZDApp_InMsgCB_0
   \   00001F   7413         MOV     A,#0x13
   \   000021   68           XRL     A,R0
   \   000022   7001         JNZ     ??ZDApp_InMsgCB_1
   \   000024   E9           MOV     A,R1
   \                     ??ZDApp_InMsgCB_1:
   \   000025   6035         JZ      ??ZDApp_InMsgCB_0
   2777              {
   2778                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2779                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   000027                ; Setup parameters for call to function ZDP_GenericRsp
   \   000027   E8           MOV     A,R0
   \   000028   F5..         MOV     ?V0 + 0,A
   \   00002A   E9           MOV     A,R1
   \   00002B   4480         ORL     A,#0x80
   \   00002D   F5..         MOV     ?V0 + 1,A
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000034   E4           CLR     A
   \   000035   F5..         MOV     ?V0 + 0,A
   \   000037   F5..         MOV     ?V0 + 1,A
   \   000039   78..         MOV     R0,#?V0 + 0
   \   00003B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003E   EE           MOV     A,R6
   \   00003F   240E         ADD     A,#0xe
   \   000041   12....       LCALL   ??Subroutine55_0 & 0xFFFF
   2780              }
   2781            }
   \                     ??CrossCallReturnLabel_111:
   \   000044   FD           MOV     R5,A
   \   000045   7C84         MOV     R4,#-0x7c
   \   000047   EE           MOV     A,R6
   \   000048   2402         ADD     A,#0x2
   \   00004A   0A           INC     R2
   \   00004B   0A           INC     R2
   \   00004C   EF           MOV     A,R7
   \   00004D   3400         ADDC    A,#0x0
   \   00004F   FB           MOV     R3,A
   \   000050   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_113:
   \   000053   F9           MOV     R1,A
   \   000054   12....       LCALL   ??ZDP_GenericRsp?relay
   \   000057   7404         MOV     A,#0x4
   \   000059   12....       LCALL   ?DEALLOC_XSTACK8
   2782          }
   \                     ??ZDApp_InMsgCB_0:
   \   00005C   02....       LJMP    ??Subroutine50_0 & 0xFFFF
   2783          
   2784          
   2785          /*********************************************************************
   2786           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2787           *
   2788           * @brief   Changes the Match Descriptor Response permission.
   2789           *
   2790           * @param   endpoint - endpoint to allow responses
   2791           * @param   action - true to allow responses, false to not
   2792           *
   2793           * @return  none
   2794           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2795          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2796          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   2797            // Store the action
   2798            afSetMatch( endpoint, action );
   \   000005                ; Setup parameters for call to function afSetMatch
   \   000005   12....       LCALL   ??afSetMatch?relay
   2799          }
   \   000008   02....       LJMP    ??Subroutine51_0 & 0xFFFF
   2800          
   2801          /*********************************************************************
   2802           * @fn      ZDApp_NetworkInit()
   2803           *
   2804           * @brief   Used to start the network joining process
   2805           *
   2806           * @param   delay - mSec delay to wait before starting
   2807           *
   2808           * @return  none
   2809           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2810          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2811          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2812            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   4B           ORL     A,R3
   \   000006   600B         JZ      ??ZDApp_NetworkInit_0
   2813            {
   2814              // Wait awhile before starting the device
   2815              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   000008                ; Setup parameters for call to function osal_start_timerEx
   \   000008   EA           MOV     A,R2
   \   000009   FC           MOV     R4,A
   \   00000A   EB           MOV     A,R3
   \   00000B   FD           MOV     R5,A
   \   00000C   7A01         MOV     R2,#0x1
   \   00000E   12....       LCALL   ??Subroutine45_0 & 0xFFFF
   2816            }
   \                     ??CrossCallReturnLabel_83:
   \   000011   8005         SJMP    ??CrossCallReturnLabel_65
   2817            else
   2818            {
   2819              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_0:
   \   000013                ; Setup parameters for call to function osal_set_event
   \   000013   7A01         MOV     R2,#0x1
   \   000015   12....       LCALL   ??Subroutine38_0 & 0xFFFF
   2820            }
   2821          }
   \                     ??CrossCallReturnLabel_65:
   \   000018   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   2822          
   2823          /*********************************************************************
   2824           * @fn      ZDApp_NwkStateUpdateCB()
   2825           *
   2826           * @brief   This function notifies that this device's network
   2827           *          state info has been changed.
   2828           *
   2829           * @param   none
   2830           *
   2831           * @return  none
   2832           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2833          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2834          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2835            // Notify to save info into NV
   2836            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   12....       LCALL   ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000008   7003         JNZ     ??ZDApp_NwkStateUpdateCB_0
   2837            {
   2838              // Trigger to save info into NV
   2839              ZDApp_NVUpdate();
   \   00000A                ; Setup parameters for call to function ZDApp_NVUpdate
   \   00000A   12....       LCALL   ??ZDApp_NVUpdate?relay
   2840            }
   2841          }
   \                     ??ZDApp_NwkStateUpdateCB_0:
   \   00000D   02....       LJMP    ??Subroutine50_0 & 0xFFFF
   2842          
   2843          /*********************************************************************
   2844           * @fn      ZDApp_NodeProfileSync()
   2845           *
   2846           * @brief   Sync node with stack profile.
   2847           *
   2848           * @param   stackProfile - stack profile of the network to join
   2849           *
   2850           * @return  none
   2851           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2852          void ZDApp_NodeProfileSync( uint8 stackProfile )
   \                     ZDApp_NodeProfileSync:
   2853          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   2854            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000007   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   501A         JNC     ??ZDApp_NodeProfileSync_0
   2855            {
   2856              if ( stackProfile != zgStackProfile )
   \   00000F   90....       MOV     DPTR,#zgStackProfile
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6E           XRL     A,R6
   \   000014   6013         JZ      ??ZDApp_NodeProfileSync_0
   2857              {
   2858                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000016   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   54F8         ANL     A,#0xf8
   \   00001C   4402         ORL     A,#0x2
   \   00001E   F0           MOVX    @DPTR,A
   2859                ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00001F   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000022   740C         MOV     A,#0xc
   \   000024   F0           MOVX    @DPTR,A
   2860                NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000025                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2861              }
   2862            }
   2863          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000029   02....       LJMP    ??Subroutine51_0 & 0xFFFF
   2864          
   2865          /*********************************************************************
   2866           * @fn      ZDApp_StartJoiningCycle()
   2867           *
   2868           * @brief   Starts the joining cycle of a device.  This will only
   2869           *          continue an already started (or stopped) joining cycle.
   2870           *
   2871           * @param   none
   2872           *
   2873           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2874           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2875          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2876          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2877            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2878            {
   2879              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   7401         MOV     A,#0x1
   \   000016   F0           MOVX    @DPTR,A
   2880              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2881          
   2882              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2883            }
   2884            else
   2885              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   2886          }
   2887          
   2888          /*********************************************************************
   2889           * @fn      ZDApp_StopJoiningCycle()
   2890           *
   2891           * @brief   Stops the joining or rejoining process of a device.
   2892           *
   2893           * @param   none
   2894           *
   2895           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2896           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2897          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2898          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2899            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2900            {
   2901              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   90....       MOV     DPTR,#continueJoining
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
   2902              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2903            }
   2904            else
   2905              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   2906          }
   2907          
   2908          /*********************************************************************
   2909           * @fn      ZDApp_AnnounceNewAddress()
   2910           *
   2911           * @brief   Send Device Announce and hold all transmissions for
   2912           *          new address timeout.
   2913           *
   2914           * @param   none
   2915           *
   2916           * @return  none
   2917           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2918          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2919          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2920          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2921            // Turn off data request hold
   2922            APSME_HoldDataRequests( 0 );
   \   000005                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B00         MOV     R3,#0x0
   \   000009   12....       LCALL   ??APSME_HoldDataRequests?relay
   2923          #endif
   2924          
   2925            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2926                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   00000C                ; Setup parameters for call to function NLME_GetExtAddr
   \   00000C   12....       LCALL   ??NLME_GetExtAddr?relay
   \   00000F   8A..         MOV     ?V0 + 0,R2
   \   000011   8B..         MOV     ?V0 + 1,R3
   \   000013   AE..         MOV     R6,?V0 + 0
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000018   75..00       MOV     ?V0 + 0,#0x0
   \   00001B   78..         MOV     R0,#?V0 + 0
   \   00001D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000020   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor + 2
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   EE           MOV     A,R6
   \   000026   FC           MOV     R4,A
   \   000027   AD..         MOV     R5,?V0 + 1
   \   000029   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   00002C   7401         MOV     A,#0x1
   \   00002E   12....       LCALL   ?DEALLOC_XSTACK8
   2927          
   2928          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2929            // Setup the timeout
   2930            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   \   000031                ; Setup parameters for call to function APSME_HoldDataRequests
   \   000031   7A00         MOV     R2,#0x0
   \   000033   7B00         MOV     R3,#0x0
   \   000035   12....       LCALL   ??APSME_HoldDataRequests?relay
   2931          #endif
   2932          }
   \   000038   02....       LJMP    ??Subroutine50_0 & 0xFFFF
   2933          
   2934          /*********************************************************************
   2935           * @fn          ZDApp_NVUpdate
   2936           *
   2937           * @brief       Set the NV Update Timer.
   2938           *
   2939           * @param       none
   2940           *
   2941           * @return      none
   2942           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2943          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2944          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2945          #if defined ( NV_RESTORE )
   2946            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   7CBC         MOV     R4,#-0x44
   \   000006   7D02         MOV     R5,#0x2
   \   000008   7A00         MOV     R2,#0x0
   \   00000A   7B02         MOV     R3,#0x2
   \   00000C   02....       LJMP    ?Subroutine2 & 0xFFFF
   2947          #endif
   2948          }
   2949          
   2950          /*********************************************************************
   2951           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2952           *
   2953           * @brief   Returns a PAN ID for the network layer to use during
   2954           *          a coordinator start and there is another network with
   2955           *          the intended PANID.
   2956           *
   2957           * @param   panid - the intended PAN ID
   2958           *
   2959           * @return  PANID to try
   2960           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2961          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2962          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2963            return ( panid + 1 );
   \   000000   EA           MOV     A,R2
   \   000001   2401         ADD     A,#0x1
   \   000003   0A           INC     R2
   \   000004   EB           MOV     A,R3
   \   000005   3400         ADDC    A,#0x0
   \   000007   FB           MOV     R3,A
   \   000008   02....       LJMP    ?BRET
   2964          }
   2965          
   2966          /*********************************************************************
   2967           * @fn          ZDO_SrcRtgIndCB
   2968           *
   2969           * @brief       This function notifies the ZDO available src route record received.
   2970           *
   2971           * @param       srcAddr - source address of the source route
   2972           * @param       relayCnt - number of devices in the relay list
   2973           * @param       relayList - relay list of the source route
   2974           *
   2975           * @return      none
   2976           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2977          void ZDO_SrcRtgIndCB (uint16 srcAddr, uint8 relayCnt, uint16* pRelayList )
   \                     ZDO_SrcRtgIndCB:
   2978          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   2979            zdoSrcRtg_t srcRtg;
   2980          
   2981            srcRtg.srcAddr = srcAddr;
   \   00000A   12....       LCALL   ?Subroutine9 & 0xFFFF
   2982            srcRtg.relayCnt = relayCnt;
   \                     ??CrossCallReturnLabel_128:
   \   00000D   7402         MOV     A,#0x2
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   E9           MOV     A,R1
   \   000013   F0           MOVX    @DPTR,A
   2983            srcRtg.pRelayList = pRelayList;
   \   000014   7403         MOV     A,#0x3
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   EC           MOV     A,R4
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   ED           MOV     A,R5
   \   00001D   F0           MOVX    @DPTR,A
   2984          
   2985            if( zdoCBFunc[ZDO_SRC_RTG_IND_CBID] != NULL )
   \   00001E   90....       MOV     DPTR,#zdoCBFunc
   \   000021   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000024   6013         JZ      ??ZDO_SrcRtgIndCB_0
   2986            {
   2987              zdoCBFunc[ZDO_SRC_RTG_IND_CBID]( (void*)&srcRtg );
   \   000026                ; Setup parameters for indirect call
   \   000026   85..82       MOV     DPL,?XSP + 0
   \   000029   85..83       MOV     DPH,?XSP + 1
   \   00002C   AA82         MOV     R2,DPL
   \   00002E   AB83         MOV     R3,DPH
   \   000030   90....       MOV     DPTR,#zdoCBFunc + 1
   \   000033   12....       LCALL   ??Subroutine48_0 & 0xFFFF
   2988            }
   \                     ??CrossCallReturnLabel_87:
   \   000036   12....       LCALL   ?CALL_IND
   2989          }
   \                     ??ZDO_SrcRtgIndCB_0:
   \   000039                REQUIRE ?Subroutine5
   \   000039                ; // Fall through to label ?Subroutine5
   2990          
   2991          /*********************************************************************
   2992           * @fn          ZDApp_InitZdoCBFunc
   2993           *
   2994           * @brief       Call this function to initialize zdoCBFunc[]
   2995           *
   2996           * @param       none
   2997           *
   2998           * @return      none
   2999           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3000          void ZDApp_InitZdoCBFunc( void )
   \                     ZDApp_InitZdoCBFunc:
   3001          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   3002            uint8 i;
   3003          
   3004            for ( i=0; i< MAX_ZDO_CB_FUNC; i++ )
   \   000004   78..         MOV     R0,#zdoCBFunc & 0xff
   \   000006   79..         MOV     R1,#(zdoCBFunc >> 8) & 0xff
   3005            {
   3006              zdoCBFunc[i] = NULL;
   \                     ??ZDApp_InitZdoCBFunc_0:
   \   000008   8882         MOV     DPL,R0
   \   00000A   8983         MOV     DPH,R1
   \   00000C   E4           CLR     A
   \   00000D   F0           MOVX    @DPTR,A
   \   00000E   A3           INC     DPTR
   \   00000F   F0           MOVX    @DPTR,A
   3007            }
   \   000010   E8           MOV     A,R0
   \   000011   2402         ADD     A,#0x2
   \   000013   08           INC     R0
   \   000014   08           INC     R0
   \   000015   E9           MOV     A,R1
   \   000016   3400         ADDC    A,#0x0
   \   000018   F9           MOV     R1,A
   \   000019   E8           MOV     A,R0
   \   00001A   B4..03       CJNE    A,#(zdoCBFunc + 14) & 0xff,??ZDApp_InitZdoCBFunc_1
   \   00001D   E9           MOV     A,R1
   \   00001E   64..         XRL     A,#((zdoCBFunc + 14) >> 8) & 0xff
   \                     ??ZDApp_InitZdoCBFunc_1:
   \   000020   70E6         JNZ     ??ZDApp_InitZdoCBFunc_0
   3008          }
   \   000022   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   3009          
   3010          /*********************************************************************
   3011           * @fn          ZDO_RegisterForZdoCB
   3012           *
   3013           * @brief       Call this function to register the higher layer (for
   3014           *              example, the Application layer or MT layer) with ZDO
   3015           *              callbacks to get notified of some ZDO indication like
   3016           *              existence of a concentrator or receipt of a source
   3017           *              route record.
   3018           *
   3019           * @param       indID - ZDO Indication ID
   3020           * @param       pFn   - Callback function pointer
   3021           *
   3022           * @return      ZSuccess - successful, ZInvalidParameter if not
   3023           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3024          ZStatus_t ZDO_RegisterForZdoCB( uint8 indID, pfnZdoCb pFn )
   \                     ZDO_RegisterForZdoCB:
   3025          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FC           MOV     R4,A
   3026            // Check the range of the indication ID
   3027            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   C3           CLR     C
   \   000007   9407         SUBB    A,#0x7
   \   000009   500B         JNC     ??ZDO_RegisterForZdoCB_0
   3028            {
   3029              zdoCBFunc[indID] = pFn;
   \   00000B   EC           MOV     A,R4
   \   00000C   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   00000F   12....       LCALL   ??Subroutine58_0 & 0xFFFF
   3030              return ZSuccess;
   \                     ??CrossCallReturnLabel_125:
   \   000012   7900         MOV     R1,#0x0
   \   000014   8002         SJMP    ??ZDO_RegisterForZdoCB_1
   3031            }
   3032          
   3033            return ZInvalidParameter;
   \                     ??ZDO_RegisterForZdoCB_0:
   \   000016   7902         MOV     R1,#0x2
   \                     ??ZDO_RegisterForZdoCB_1:
   \   000018   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   3034          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine30:
   \   000000   C3           CLR     C
   \   000001   33           RLC     A
   \   000002   F8           MOV     R0,A
   \   000003   E4           CLR     A
   \   000004   33           RLC     A
   \   000005   F9           MOV     R1,A
   \   000006   74..         MOV     A,#zdoCBFunc & 0xff
   \   000008   28           ADD     A,R0
   \   000009   F582         MOV     DPL,A
   \   00000B   74..         MOV     A,#(zdoCBFunc >> 8) & 0xff
   \   00000D   39           ADDC    A,R1
   \   00000E   F583         MOV     DPH,A
   \   000010   22           RET
   3035          
   3036          /*********************************************************************
   3037           * @fn          ZDO_DeregisterForZdoCB
   3038           *
   3039           * @brief       Call this function to de-register the higher layer (for
   3040           *              example, the Application layer or MT layer) with ZDO
   3041           *              callbacks to get notified of some ZDO indication like
   3042           *              existence of a concentrator or receipt of a source
   3043           *              route record.
   3044           *
   3045           * @param       indID - ZDO Indication ID
   3046           *
   3047           * @return      ZSuccess - successful, ZInvalidParameter if not
   3048           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   3049          ZStatus_t ZDO_DeregisterForZdoCB( uint8 indID )
   \                     ZDO_DeregisterForZdoCB:
   3050          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   E9           MOV     A,R1
   \   000005   FA           MOV     R2,A
   3051            // Check the range of the indication ID
   3052            if ( indID < MAX_ZDO_CB_FUNC )
   \   000006   C3           CLR     C
   \   000007   9407         SUBB    A,#0x7
   \   000009   500B         JNC     ??ZDO_DeregisterForZdoCB_0
   3053            {
   3054              zdoCBFunc[indID] = NULL;
   \   00000B   EA           MOV     A,R2
   \   00000C   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00000F   E4           CLR     A
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   F0           MOVX    @DPTR,A
   3055              return ZSuccess;
   \   000013   F9           MOV     R1,A
   \   000014   8002         SJMP    ??ZDO_DeregisterForZdoCB_1
   3056            }
   3057          
   3058            return ZInvalidParameter;
   \                     ??ZDO_DeregisterForZdoCB_0:
   \   000016   7902         MOV     R1,#0x2
   \                     ??ZDO_DeregisterForZdoCB_1:
   \   000018   02....       LJMP    ??Subroutine44_0 & 0xFFFF
   3059          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devStartMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....         DW ZDAppTaskID
   \   000003   0000         DW 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   5802         DW 600

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkDiscoveryReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkDiscoveryReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_JoinReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_JoinReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceConfigured?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceConfigured

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkDescListProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkDescListProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_beaconNotifyIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_beaconNotifyIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SrcRtgIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SrcRtgIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitZdoCBFunc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitZdoCBFunc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_RegisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_RegisterForZdoCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_DeregisterForZdoCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_DeregisterForZdoCB
   3060          
   3061          /*********************************************************************
   3062          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0     34
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDAppCheckForHoldKey               2      0      9
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     14
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     25
       -> APSME_HoldDataRequests        0      0     20
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> APSME_HoldDataRequests        0      0     20
     ZDApp_ChangeMatchDescRespPermission
                                        0      0      9
       -> afSetMatch                    0      0     18
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
       -> ZDApp_NVUpdate                4      0      0
     ZDApp_DeviceConfigured             0      0     16
       -> osal_nv_read                  0      0     32
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         0      0      9
       -> NLME_GetExtAddr               0      0     18
       -> ZDAppCheckForHoldKey          0      0     18
       -> ZDO_Init                      0      0     18
       -> afRegister                    0      0     18
       -> ZDApp_InitUserDesc            0      0     18
       -> ZDOInitDevice                 0      0     18
       -> ZDOInitDevice                 0      0     18
       -> HalLedBlink                   0      0     18
       -> ZDApp_InitZdoCBFunc           0      0     18
       -> ZDApp_RegisterCBs             0      0     18
     ZDApp_InitUserDesc                 0      0     40
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_InitZdoCBFunc                2      0      9
     ZDApp_JoinReq                      0      0     22
       -> ZDApp_NodeProfileSync         0      0     28
       -> NLME_JoinRequest              0      0     36
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     28
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlReset               0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlSet                 0      0     23
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             2      0     14
       -> ZDApp_LeaveCtrlReset          4      0      0
     ZDApp_LeaveReset                   0      0     23
       -> ZDApp_LeaveCtrlSet            0      0     18
       -> osal_start_timerEx            0      0     18
     ZDApp_LeaveUpdate                  0      0     41
       -> ZDSecMgrDeviceRemoveByExtAddr
                                        0      0     48
       -> ZDSecMgrAddrClear             0      0     48
       -> osal_memcpy                   0      0     54
       -> NLME_RemoveChild              0      0     48
       -> RTG_RemoveRtgEntry            0      0     48
       -> nwkNeighborRemove             0      0     48
       -> AddrMgrWriteNVRequest         0      0     48
     ZDApp_NVUpdate                     2      0     14
       -> osal_start_timerEx            4      0      0
     ZDApp_NetworkDiscoveryReq          0      0     12
       -> NLME_NetworkDiscoveryRequest
                                        0      0     24
     ZDApp_NetworkInit                  2      0     14
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     11
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     23
       -> NLME_SetBroadcastFilter       0      0     18
     ZDApp_NwkDescListProcessing        0      0     14
       -> nwk_getNwkDescList            0      0     28
       -> nwk_getNwkDescList            0      0     28
       -> nwk_ExtPANIDValid             0      0     28
       -> sAddrExtCmp                   0      0     28
     ZDApp_NwkStateUpdateCB             0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDApp_ProcessMsgCBs                0      0     54
       -> ZDO_ParseAddrRsp              0      0    108
       -> ZDO_UpdateAddrManager         0      0    108
       -> osal_mem_free                 0      0    108
       -> ZDO_ParseBindUnbindReq        0      0    108
       -> ZDO_ProcessBindUnbindReq      0      0    108
       -> ZDMatchSendState              0      0    108
       -> ZDO_ParseEndDeviceBindReq     0      0    108
       -> ZDO_MatchEndDeviceBind        0      0    108
       -> osal_mem_free                 0      0    108
       -> osal_mem_free                 0      0    108
     ZDApp_ProcessNetworkJoin           0      0     12
       -> osal_set_event                0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> osal_start_timerEx            0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_RestoreNwkKey           0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> nwkNeighborInitTable          0      0     24
       -> NLME_NwkDiscTerm              0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_set_event                0      0     24
     ZDApp_ProcessOSALMsg               2      0     11
       -> ZDP_IncomingData              4      0      0
       -> ZDApp_ProcessMsgCBs           4      0      0
       -> ZDApp_ProcessSecMsg           4      0      0
     ZDApp_ProcessSecEvent              0      0     20
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDSecMgrEvent                 0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
       -> ZDSecMgrSaveApsLinkKey        0      0     18
       -> ZDSecMgrSaveTCLinkKey         0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrEstablishKeyCfm       4      0      0
       -> ZDSecMgrUpdateDeviceInd       4      0      0
       -> ZDSecMgrRequestKeyInd         4      0      0
       -> ZDSecMgrAuthenticateInd       4      0      0
       -> ZDSecMgrAuthenticateCfm       4      0      0
     ZDApp_ReadNetworkRestoreState      0      0     23
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      9
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0     23
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
       -> ZDApp_RestoreNwkKey           0      0     18
     ZDApp_RestoreNwkKey                0      0     49
       -> osal_nv_read                  0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SaveNetworkStateEvt          2      0     11
       -> NLME_UpdateNV                 4      0      0
       -> zgWriteStartupOptions         4      0      0
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
       -> osal_memset                   0      0     66
     ZDApp_SecInit                      0      0     39
       -> ZDSecMgrInit                  0      0     50
       -> ZDSecMgrReadKeyFromNv         0      0     50
       -> SSP_UpdateNwkKey              0      0     50
       -> SSP_SwitchNwkKey              0      0     50
       -> osal_memset                   0      0     50
     ZDApp_SendEventMsg                 0      0      9
       -> ZDApp_SendMsg                 0      0     18
     ZDApp_SendMsg                      1      0     36
       -> osal_msg_allocate             0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_msg_send                 0      0     38
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     11
       -> osal_set_event                0      0     22
       -> ZDO_StartDevice               0      0     22
       -> ZDApp_ProcessOSALMsg          0      0     22
       -> osal_msg_deallocate           0      0     22
       -> osal_msg_receive              0      0     22
       -> ZDApp_NetworkStartEvt         0      0     22
       -> osal_pwrmgr_device            0      0     22
       -> osal_set_event                0      0     22
       -> ZDO_UpdateNwkStatus           0      0     22
       -> osal_start_timerEx            0      0     22
       -> ZDApp_SaveNetworkStateEvt     0      0     22
       -> zgWriteStartupOptions         0      0     22
       -> Onboard_soft_reset            0      0     22
       -> ZDApp_ProcessSecEvent         0      0     22
     ZDOInitDevice                      0      0     23
       -> zgInitItems                   0      0     28
       -> ZDConfig_InitDescriptors      0      0     28
       -> HalKeyRead                    0      0     28
       -> NLME_InitNV                   0      0     28
       -> NLME_SetDefaultNV             0      0     28
       -> ZDSecMgrClearNVKeyValues      0      0     28
       -> ZDAppDetermineDeviceType      0      0     28
       -> osal_rand                     0      0     28
       -> ZDApp_SecInit                 0      0     28
       -> ZDApp_LeaveCtrlInit           0      0     28
       -> ZDApp_LeaveCtrlStartup        0      0     28
       -> zgWriteStartupOptions         0      0     28
       -> osal_set_event                0      0     28
       -> ZDApp_ReadNetworkRestoreState
                                        0      0     28
       -> ZDApp_RestoreNetworkState     0      0     28
       -> ZDApp_NetworkInit             0      0     28
       -> NLME_SetBroadcastFilter       0      0     28
     ZDO_AddrChangeIndicationCB         0      0     14
       -> ZDApp_NVUpdate                0      0     28
       -> osal_set_event                0      0     28
       -> osal_msg_allocate             0      0     28
       -> osal_msg_send                 0      0     28
       -> ZDApp_AnnounceNewAddress      0      0     28
     ZDO_ConcentratorIndicationCB       1      0     14
     ZDO_DeregisterForZdoCB             2      0      0
     ZDO_JoinConfirmCB                  1      0     14
       -> HalLedSet                     0      0     28
       -> HalLedSet                     0      0     28
       -> ZDApp_NVUpdate                0      0     28
       -> HalLedSet                     0      0     28
       -> ZDApp_SendMsg                 0      0     28
     ZDO_JoinIndicationCB               0      0     10
       -> ZDApp_NVUpdate                0      0     18
       -> osal_start_timerEx            0      0     18
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> ZDApp_LeaveUpdate             0      0     20
     ZDO_LeaveInd                       1      0     14
       -> NLME_LeaveRsp                 0      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> NLME_GetCoordShortAddr        0      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> ZDApp_LeaveUpdate             0      0     28
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> RTG_MTORouteReq               4      0      0
     ZDO_NetworkDiscoveryConfirmCB      3      0      3
       -> ZDApp_SendMsg                 4      0      6
     ZDO_NetworkFormationConfirmCB      0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_PollConfirmCB                  0      0      0
     ZDO_RegisterForZdoCB               2      0      0
     ZDO_SrcRtgIndCB                    1      0     14
     ZDO_StartRouterConfirmCB           0      0      9
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> HalLedSet                     0      0     18
       -> osal_set_event                0      0     18
     ZDO_SyncIndicationCB               0      0      9
       -> nwkNeighborInitTable          0      0     18
       -> ZDApp_SendMsg                 0      0     18
     ZDO_UpdateDeviceIndication         0      0      0
     ZDO_beaconNotifyIndCB              1      0     14
       -> osal_mem_alloc                0      0     28
       -> osal_memset                   0      0     28
       -> sAddrExtCpy                   0      0     28
       -> osal_memset                   0      0     28


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     zdoCBFunc                                     14
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    88
     ??Subroutine51_0                               5
     ZDApp_SecInit                                131
     ??Subroutine57_0                               6
     ZDApp_event_loop                             246
     ?Subroutine15                                  2
     ??Subroutine38_0                              11
     ??Subroutine39_0                              14
     ??Subroutine47_0                               6
     ZDApp_ProcessSecEvent                        159
     ?Subroutine16                                  2
     ??Subroutine45_0                               2
     ??Subroutine46_0                               3
     ?Subroutine35                                  6
     ??Subroutine58_0                               6
     ZDOInitDevice                                199
     ?Subroutine1                                   2
     ??Subroutine42_0                               3
     ??Subroutine43_0                               5
     ?Subroutine9                                   6
     ZDApp_ReadNetworkRestoreState                 21
     ZDAppDetermineDeviceType                      74
     ??Subroutine44_0                               7
     ZDApp_NetworkStartEvt                         79
     ZDApp_DeviceAuthEvt                           66
     ?Subroutine8                                   5
     ?Subroutine21                                  9
     ??Subroutine52_0                               6
     ZDApp_SaveNetworkStateEvt                     19
     ZDApp_RestoreNetworkState                     94
     ?Subroutine12                                  6
     ZDApp_InitUserDesc                            89
     ?Subroutine27                                 32
     ?Subroutine31                                  8
     ??Subroutine49_0                               3
     ??Subroutine50_0                               5
     ZDAppCheckForHoldKey                          20
     ZDApp_ProcessOSALMsg                          70
     ??Subroutine48_0                               6
     ZDApp_ProcessMsgCBs                          261
     ?Subroutine18                                  2
     ??Subroutine40_0                              10
     ?Subroutine32                                  7
     ?Subroutine37                                  3
     ??Subroutine54_0                               5
     ?Subroutine28                                  3
     ??Subroutine55_0                               3
     ??Subroutine56_0                               5
     ZDApp_RegisterCBs                             48
     ?Subroutine17                                  2
     ??Subroutine41_0                               9
     ZDApp_ProcessSecMsg                           93
     ZDApp_ProcessNetworkJoin                     443
     ?Subroutine6                                   5
     ?Subroutine25                                 10
     ?Subroutine10                                 11
     ZDApp_SaveNwkKey                             109
     ?Subroutine7                                   4
     ZDApp_ResetNwkKey                             50
     ZDApp_RestoreNwkKey                          141
     ZDApp_ResetTimerStart                         14
     ?Subroutine2                                   3
     ZDApp_ResetTimerCancel                        18
     ZDApp_LeaveCtrlInit                           71
     ZDApp_LeaveCtrlSet                            22
     ?Subroutine3                                  35
     ZDApp_LeaveCtrlReset                          13
     ZDApp_LeaveCtrlBypass                         16
     ZDApp_LeaveCtrlStartup                        48
     ZDApp_LeaveReset                              20
     ZDApp_LeaveUpdate                            148
     ?Subroutine24                                  3
     ZDApp_NetworkDiscoveryReq                     11
     ZDApp_JoinReq                                 87
     ?Subroutine4                                   5
     ZDApp_DeviceConfigured                        80
     ZDApp_SendEventMsg                            16
     ?Subroutine22                                  9
     ZDApp_SendMsg                                 99
     ZDO_NetworkDiscoveryConfirmCB                 76
     ZDApp_NwkDescListProcessing                  263
     ?Subroutine20                                  6
     ??Subroutine53_0                               6
     ?Subroutine0                                   3
     ZDO_NetworkFormationConfirmCB                 34
     ?Subroutine33                                 19
     ZDO_beaconNotifyIndCB                        561
     ?Subroutine34                                  9
     ?Subroutine26                                  4
     ?Subroutine36                                  9
     ?Subroutine19                                 10
     ?Subroutine11                                 12
     ?Subroutine13                                 12
     ZDO_StartRouterConfirmCB                      34
     ZDO_JoinConfirmCB                            119
     ?Subroutine5                                   2
     ZDO_AddrChangeIndicationCB                    98
     ?Subroutine29                                 11
     ZDO_JoinIndicationCB                          41
     ZDO_ConcentratorIndicationCB                  58
     ?Subroutine14                                  4
     ZDO_LeaveCnf                                 101
     ZDO_LeaveInd                                 171
     ZDO_SyncIndicationCB                          37
     ZDO_ManytoOneFailureIndicationCB
                                                   10
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                         16
     ?Subroutine23                                 18
     ZDO_UpdateDeviceIndication                     5
     ZDApp_InMsgCB                                 95
     ZDApp_ChangeMatchDescRespPermission
                                                   11
     ZDApp_NetworkInit                             27
     ZDApp_NwkStateUpdateCB                        16
     ZDApp_NodeProfileSync                         44
     ZDApp_StartJoiningCycle                       39
     ZDApp_StopJoiningCycle                        31
     ZDApp_AnnounceNewAddress                      59
     ZDApp_NVUpdate                                15
     ZDApp_CoordStartPANIDConflictCB
                                                   11
     ZDO_SrcRtgIndCB                               57
     ZDApp_InitZdoCBFunc                           37
     ZDO_RegisterForZdoCB                          27
     ?Subroutine30                                 17
     ZDO_DeregisterForZdoCB                        27
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devStartMode>                1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_0                                   4
     __Constant_1                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlReset?relay                   6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_NetworkDiscoveryReq?relay              6
     ??ZDApp_JoinReq?relay                          6
     ??ZDApp_DeviceConfigured?relay                 6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDApp_NwkDescListProcessing?relay            6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_beaconNotifyIndCB?relay                  6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6
     ??ZDO_SrcRtgIndCB?relay                        6
     ??ZDApp_InitZdoCBFunc?relay                    6
     ??ZDO_RegisterForZdoCB?relay                   6
     ??ZDO_DeregisterForZdoCB?relay                 6

 
 5 728 bytes in segment BANKED_CODE
   390 bytes in segment BANK_RELAYS
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    54 bytes in segment XDATA_Z
 
 6 129 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
    65 bytes of XDATA memory

Errors: none
Warnings: none
